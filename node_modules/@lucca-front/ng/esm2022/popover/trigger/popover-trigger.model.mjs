import { isFakeMousedownFromScreenReader } from '@angular/cdk/a11y';
import { OverlayConfig, } from '@angular/cdk/overlay';
import { TemplatePortal } from '@angular/cdk/portal';
import { generateId } from '@lucca-front/ng/core';
import { Subject, Subscription, timer } from 'rxjs';
import { debounce, distinctUntilChanged, map } from 'rxjs/operators';
// tslint:disable-next-line: max-line-length
export class ALuPopoverTrigger {
    /** References the popover instance that the trigger is associated with. */
    get panel() {
        return this._panel;
    }
    set panel(p) {
        this._panel = p;
    }
    /** References the popover target instance that the trigger is associated with. */
    get target() {
        return this._target;
    }
    set target(t) {
        this._target = t;
    }
    get triggerEvent() {
        return this._triggerEvent;
    }
    set triggerEvent(te) {
        this._triggerEvent = te;
        if (te === 'hover' || te === 'focus') {
            if (this._hoveredSubscription) {
                this._hoveredSubscription.unsubscribe();
            }
            this._hoveredSubscription = this._hovered$
                .pipe(distinctUntilChanged(), debounce((h) => (h ? timer(this.enterDelay) : timer(this.leaveDelay))))
                .subscribe((h) => (h ? this.openPopover() : this.closePopover()));
        }
    }
    get enterDelay() {
        return this._enterDelay;
    }
    set enterDelay(d) {
        this._enterDelay = d;
    }
    get leaveDelay() {
        return this._leaveDelay;
    }
    set leaveDelay(d) {
        this._leaveDelay = d;
    }
    get disabled() {
        return this._disabled;
    }
    set disabled(d) {
        this._disabled = d;
    }
    get whenEllipsis() {
        return this._whenEllipsis;
    }
    set whenEllipsis(we) {
        this._whenEllipsis = we;
    }
    constructor(_overlay, _elementRef, _viewContainerRef) {
        this._overlay = _overlay;
        this._elementRef = _elementRef;
        this._viewContainerRef = _viewContainerRef;
        this._overlayRef = null;
        this._popoverOpen = false;
        this._hovered$ = new Subject();
        // tracking input type is necessary so it's possible to only auto-focus
        // the first item of the list when the popover is opened via the keyboard
        this._openedByMouse = false;
        this._triggerEvent = 'click';
        this._enterDelay = 50;
        this._leaveDelay = 50;
        this._disabled = false;
        this._whenEllipsis = false;
        this._triggerId = `popoverTrigger_${generateId()}`;
        this._panelId = `popoverPanel_${generateId()}`;
    }
    onClick() {
        if (this.triggerEvent === 'click' && !this.disabled) {
            this.togglePopover();
        }
    }
    onMouseEnter() {
        if (this.triggerEvent === 'hover' || this.triggerEvent === 'focus') {
            this._hovered$.next(true);
        }
    }
    onMouseLeave() {
        if (this.triggerEvent === 'hover' || this.triggerEvent === 'focus') {
            this._hovered$.next(false);
        }
    }
    onFocus() {
        if (this.triggerEvent === 'hover' || this.triggerEvent === 'focus') {
            this.openPopover();
        }
    }
    onBlur() {
        if (this.triggerEvent === 'hover' || this.triggerEvent === 'focus') {
            this.closePopover();
        }
    }
    /** Toggles the popover between the open and closed states. */
    togglePopover() {
        return this._popoverOpen ? this.closePopover() : this.openPopover();
    }
    /** Opens the popover. */
    openPopover() {
        if (!this._popoverOpen && !this._disabled && (!this._whenEllipsis || this._hasEllipsis())) {
            this._createOverlay();
            this._attachPortalToOverlay();
            /** Only subscribe to overlay detachments if trigger event is hover or focus */
            if (this.triggerEvent === 'hover' || this.triggerEvent === 'focus') {
                this._subscribeToOverlayDetachments();
            }
            /** Only subscribe to backdrop if trigger event is click */
            if (this.triggerEvent === 'click') {
                this._subscribeToBackdrop();
            }
            /** Only subscribe to mouse enter/leave of the panel if trigger = hover */
            this._initPopover();
            this._emitOpen();
        }
    }
    /** Closes the popover. */
    closePopover() {
        if (this._overlayRef) {
            /** Overlay can still be attached if close has been triggered by mouse leave. */
            if (this._overlayRef.hasAttached()) {
                this._overlayRef.detach();
            }
            /** unsubscribe to backdrop click if it was defined */
            if (this._backdropSubscription) {
                // if (this.popover.triggerEvent === 'click') {
                this._backdropSubscription.unsubscribe();
            }
            this._resetPopover();
            this._emitClose();
        }
    }
    /** Removes the popover from the DOM. */
    destroyPopover() {
        if (this._overlayRef) {
            this._overlayRef.dispose();
            this._overlayRef = null;
            this._cleanUpSubscriptions();
        }
    }
    /** Focuses the popover trigger. */
    focus() {
        this._elementRef.nativeElement.focus();
    }
    _handleMousedown(event) {
        if (!isFakeMousedownFromScreenReader(event)) {
            this._openedByMouse = true;
        }
    }
    /** The text direction of the containing app. */
    get dir() {
        // return this._dir && this._dir.value === 'rtl' ? 'rtl' : 'ltr';
        return 'ltr';
    }
    /** Return if the popover main positionning is vertical */
    get isVerticallyPositionned() {
        const position = this.target.position;
        return position === 'below' || position === 'above';
    }
    _attachPortalToOverlay() {
        this._overlayRef.attach(this._portal);
    }
    _getPanelScrollStrategy() {
        return this.panel.scrollStrategy;
    }
    /**
     * This method ensures that the popover
     */
    _subscribeToPanelEvents() {
        if (this._overlayRef) {
            this._panelEventsSubscriptions = new Subscription();
            if (this.triggerEvent === 'hover' || this.triggerEvent === 'focus') {
                this._panelEventsSubscriptions.add(this.panel.hovered.subscribe((hovered) => {
                    this._hovered$.next(hovered);
                }));
            }
            this._panelEventsSubscriptions.add(this.panel.close.subscribe(() => {
                this.closePopover();
            }));
            this._panelEventsSubscriptions.add(this.panel.open.subscribe(() => {
                this.openPopover();
            }));
        }
    }
    /**
     * This method ensures that the popover closes when the overlay has been detached
     * Detach can occur if we scroll while popover is opened
     */
    _subscribeToOverlayDetachments() {
        if (this._overlayRef) {
            this._overlayDetachmentsSubscription = this._overlayRef.detachments().subscribe(() => {
                this._hovered$.next(false);
            });
        }
    }
    /**
     * This method ensures that the popover closes when the overlay backdrop is clicked.
     * We do not use first() here because doing so would not catch clicks from within
     * the popover, and it would fail to unsubscribe properly. Instead, we unsubscribe
     * explicitly when the popover is closed or destroyed.
     */
    _subscribeToBackdrop() {
        if (this._overlayRef) {
            this._backdropSubscription = this._overlayRef.backdropClick().subscribe(() => {
                this.closePopover();
            });
        }
    }
    /**
     * This method sets the popover state to open and focuses the first item if
     * the popover was opened via the keyboard.
     */
    _initPopover() {
        this._setIsPopoverOpen(true);
        this.panel.panelId = this._panelId;
        this.panel.triggerId = this._triggerId;
        this.panel.keydownEvents$ = this._overlayRef.keydownEvents();
        this._subscribeToPanelEvents();
    }
    /**
     * This method resets the popover when it's closed, most importantly restoring
     * focus to the popover trigger if the popover was opened via the keyboard.
     */
    _resetPopover() {
        this._setIsPopoverOpen(false);
        // Focus only needs to be reset to the host element if the popover was opened
        // by the keyboard and manually shifted to the first popover item.
        if (!this._openedByMouse && this.triggerEvent === 'click') {
            this.focus();
        }
        this._openedByMouse = false;
    }
    /** set state rather than toggle to support triggers sharing a popover */
    _setIsPopoverOpen(isOpen) {
        this._popoverOpen = isOpen;
        // tell the panel it's opening/closing
        isOpen ? this.panel.onOpen() : this.panel.onClose();
    }
    /**
     *  This method checks that a valid instance of MdPopover has been passed into
     *  mdPopoverTriggerFor. If not, an exception is thrown.
     */
    _checkPanel() {
        if (!this.panel) {
            throw Error(`lu-popover-trigger: must pass in a lu-popover instance.
      Example:
      <lu-popover #popover="LuPopover"></lu-popover>
      <button type="button" [luPopover]="popover"></button>`);
        }
    }
    _checkTarget() {
        if (!this.target) {
            throw Error(`lu-popover-trigger: must pass in a popover target instance.`);
        }
    }
    /**
     *  This method creates the overlay from the provided popover's template and saves its
     *  OverlayRef so that it can be attached to the DOM when openPopover is called.
     */
    _createOverlay() {
        if (!this._overlayRef) {
            this._portal = new TemplatePortal(this.panel.templateRef, this._viewContainerRef);
            const config = this._getOverlayConfig();
            this._subscribeToPositions(config.positionStrategy);
            this._overlayRef = this._overlay.create(config);
        }
        return this._overlayRef;
    }
    /**
     * This method builds the configuration object needed to create the overlay, the OverlayConfig.
     * @returns OverlayConfig
     */
    _getOverlayConfig() {
        const overlayState = new OverlayConfig();
        overlayState.positionStrategy = this._getPosition();
        /** Display overlay backdrop if trigger event is click */
        if (this.triggerEvent === 'click') {
            overlayState.hasBackdrop = true;
            overlayState.backdropClass = 'cdk-overlay-transparent-backdrop';
        }
        overlayState.direction = this.dir;
        const scrollStrategy = this._getPanelScrollStrategy();
        switch (scrollStrategy) {
            case 'block':
                overlayState.scrollStrategy = this._overlay.scrollStrategies.block();
                break;
            case 'close':
                overlayState.scrollStrategy = this._overlay.scrollStrategies.close();
                break;
            default:
                overlayState.scrollStrategy = this._overlay.scrollStrategies.reposition();
                break;
        }
        return overlayState;
    }
    /**
     * Listens to changes in the position of the overlay and sets the correct classes
     * on the popover based on the new position. This ensures the animation origin is always
     * correct, even if a fallback position is used for the overlay.
     */
    _subscribeToPositions(position) {
        this._positionSubscription = position.positionChanges
            .pipe(map((c) => c.connectionPair), distinctUntilChanged())
            .subscribe((connectionPair) => {
            this.panel.setPositionClasses(connectionPair.overlayX, connectionPair.overlayY);
        });
    }
    /**
     * This method builds the position strategy for the overlay, so the popover is properly connected
     * to the trigger.
     * @returns FlexibleConnectedPositionStrategy
     */
    _getPosition() {
        /**
         * For overriding position element, when LuPopoverTargetAt has a valid element reference.
         * Useful for sticking popover to parent element and offsetting arrow to trigger element.
         * If undefined defaults to the trigger element reference.
         */
        const element = this.target.elementRef;
        // if (typeof this.targetElement !== 'undefined' && this.popover) {
        // 	this.popover.containerPositioning = true;
        // 	element = this.targetElement._elementRef;
        // }
        const connectionPosition = {
            originX: 'start',
            originY: 'top',
        };
        // Position
        const position = this.target.position;
        const overlap = this.target.overlap;
        if (position === 'above') {
            connectionPosition.originY = overlap ? 'bottom' : 'top';
        }
        else if (position === 'below') {
            connectionPosition.originY = overlap ? 'top' : 'bottom';
        }
        else if (position === 'before') {
            connectionPosition.originX = overlap ? 'end' : 'start';
        }
        else if (position === 'after') {
            connectionPosition.originX = overlap ? 'start' : 'end';
        }
        // Alignment
        const alignment = this.target.alignment;
        if (this.isVerticallyPositionned) {
            if (alignment === 'left') {
                connectionPosition.originX = 'start';
            }
            else if (alignment === 'right') {
                connectionPosition.originX = 'end';
            }
            else {
                connectionPosition.originX = 'center';
            }
        }
        else {
            if (alignment === 'top') {
                connectionPosition.originY = 'top';
            }
            else if (alignment === 'bottom') {
                connectionPosition.originY = 'bottom';
            }
            else {
                connectionPosition.originY = 'center';
            }
        }
        const overlayPosition = {
            overlayX: 'start',
            overlayY: 'top',
        };
        if (overlap) {
            overlayPosition.overlayX = connectionPosition.originX;
            overlayPosition.overlayY = connectionPosition.originY;
        }
        else if (this.isVerticallyPositionned) {
            overlayPosition.overlayX = connectionPosition.originX;
            overlayPosition.overlayY = position === 'above' ? 'bottom' : 'top';
        }
        else {
            overlayPosition.overlayX = position === 'before' ? 'end' : 'start';
            overlayPosition.overlayY = connectionPosition.originY;
        }
        return this._overlay
            .position()
            .flexibleConnectedTo(element)
            .withPositions([
            {
                originX: connectionPosition.originX,
                originY: connectionPosition.originY,
                overlayX: overlayPosition.overlayX,
                overlayY: overlayPosition.overlayY,
            },
            {
                originX: connectionPosition.originX,
                originY: this._invertVerticalPos(connectionPosition.originY),
                overlayX: overlayPosition.overlayX,
                overlayY: this._invertVerticalPos(overlayPosition.overlayY),
            },
            {
                originX: this._invertHorizontalPos(connectionPosition.originX),
                originY: connectionPosition.originY,
                overlayX: this._invertHorizontalPos(overlayPosition.overlayX),
                overlayY: overlayPosition.overlayY,
            },
            {
                originX: this._invertHorizontalPos(connectionPosition.originX),
                originY: this._invertVerticalPos(connectionPosition.originY),
                overlayX: this._invertHorizontalPos(overlayPosition.overlayX),
                overlayY: this._invertVerticalPos(overlayPosition.overlayY),
            },
        ])
            .withDefaultOffsetX(this.target.offsetX)
            .withDefaultOffsetY(this.target.offsetY);
    }
    _invertVerticalPos(y) {
        if (y === 'top') {
            y = 'bottom';
        }
        else if (y === 'bottom') {
            y = 'top';
        }
        return y;
    }
    _invertHorizontalPos(x) {
        if (x === 'end') {
            x = 'start';
        }
        else if (x === 'start') {
            x = 'end';
        }
        return x;
    }
    _cleanUpSubscriptions() {
        if (this._backdropSubscription) {
            this._backdropSubscription.unsubscribe();
        }
        if (this._positionSubscription) {
            this._positionSubscription.unsubscribe();
        }
        if (this._hoveredSubscription) {
            this._hoveredSubscription.unsubscribe();
        }
        if (this._panelEventsSubscriptions) {
            this._panelEventsSubscriptions.unsubscribe();
        }
        if (this._overlayDetachmentsSubscription) {
            this._overlayDetachmentsSubscription.unsubscribe();
        }
    }
    _hasEllipsis() {
        if (!(this._elementRef.nativeElement instanceof HTMLElement)) {
            return false;
        }
        const { scrollWidth, scrollHeight, clientWidth, clientHeight } = this._elementRef.nativeElement;
        const textClampedByWidth = scrollWidth > clientWidth;
        const textClampedByHeight = scrollHeight > clientHeight;
        return textClampedByWidth || textClampedByHeight;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9wb3Zlci10cmlnZ2VyLm1vZGVsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcGFja2FnZXMvbmcvcG9wb3Zlci90cmlnZ2VyL3BvcG92ZXItdHJpZ2dlci5tb2RlbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsK0JBQStCLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUVwRSxPQUFPLEVBS04sYUFBYSxHQUliLE1BQU0sc0JBQXNCLENBQUM7QUFDOUIsT0FBTyxFQUFtQixjQUFjLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUV0RSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDbEQsT0FBTyxFQUFjLE9BQU8sRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ2hFLE9BQU8sRUFBRSxRQUFRLEVBQUUsb0JBQW9CLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFtQ3JFLDRDQUE0QztBQUM1QyxNQUFNLE9BQWdCLGlCQUFpQjtJQW9CdEMsMkVBQTJFO0lBQzNFLElBQUksS0FBSztRQUNSLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUNwQixDQUFDO0lBQ0QsSUFBSSxLQUFLLENBQUMsQ0FBUztRQUNsQixJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztJQUNqQixDQUFDO0lBR0Qsa0ZBQWtGO0lBQ2xGLElBQUksTUFBTTtRQUNULE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQztJQUNyQixDQUFDO0lBQ0QsSUFBSSxNQUFNLENBQUMsQ0FBVTtRQUNwQixJQUFJLENBQUMsT0FBTyxHQUFHLENBQUMsQ0FBQztJQUNsQixDQUFDO0lBR0QsSUFBSSxZQUFZO1FBQ2YsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDO0lBQzNCLENBQUM7SUFDRCxJQUFJLFlBQVksQ0FBQyxFQUF5QjtRQUN6QyxJQUFJLENBQUMsYUFBYSxHQUFHLEVB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UUFDRCxJQUFJLElBQUksQ0FBQyx5QkFBeUIsRUFBRTtZQUNuQyxJQUFJLENBQUMseUJBQXlCLENBQUMsV0FBVyxFQUFFLENBQUM7U0FDN0M7UUFDRCxJQUFJLElBQUksQ0FBQywrQkFBK0IsRUFBRTtZQUN6QyxJQUFJLENBQUMsK0JBQStCLENBQUMsV0FBVyxFQUFFLENBQUM7U0FDbkQ7SUFDRixDQUFDO0lBRVMsWUFBWTtRQUNyQixJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsWUFBWSxXQUFXLENBQUMsRUFBRTtZQUM3RCxPQUFPLEtBQUssQ0FBQztTQUNiO1FBRUQsTUFBTSxFQUFFLFdBQVcsRUFBRSxZQUFZLEVBQUUsV0FBVyxFQUFFLFlBQVksRUFBRSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDO1FBRWhHLE1BQU0sa0JBQWtCLEdBQUcsV0FBVyxHQUFHLFdBQVcsQ0FBQztRQUNyRCxNQUFNLG1CQUFtQixHQUFHLFlBQVksR0FBRyxZQUFZLENBQUM7UUFFeEQsT0FBTyxrQkFBa0IsSUFBSSxtQkFBbUIsQ0FBQztJQUNsRCxDQUFDO0NBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpc0Zha2VNb3VzZWRvd25Gcm9tU2NyZWVuUmVhZGVyIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2ExMXknO1xuaW1wb3J0IHsgRGlyZWN0aW9uIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2JpZGknO1xuaW1wb3J0IHtcblx0RmxleGlibGVDb25uZWN0ZWRQb3NpdGlvblN0cmF0ZWd5LFxuXHRIb3Jpem9udGFsQ29ubmVjdGlvblBvcyxcblx0T3JpZ2luQ29ubmVjdGlvblBvc2l0aW9uLFxuXHRPdmVybGF5LFxuXHRPdmVybGF5Q29uZmlnLFxuXHRPdmVybGF5Q29ubmVjdGlvblBvc2l0aW9uLFxuXHRPdmVybGF5UmVmLFxuXHRWZXJ0aWNhbENvbm5lY3Rpb25Qb3MsXG59IGZyb20gJ0Bhbmd1bGFyL2Nkay9vdmVybGF5JztcbmltcG9ydCB7IENvbXBvbmVudFBvcnRhbCwgVGVtcGxhdGVQb3J0YWwgfSBmcm9tICdAYW5ndWxhci9jZGsvcG9ydGFsJztcbmltcG9ydCB7IEVsZW1lbnRSZWYsIFZpZXdDb250YWluZXJSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGdlbmVyYXRlSWQgfSBmcm9tICdAbHVjY2EtZnJvbnQvbmcvY29yZSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJqZWN0LCBTdWJzY3JpcHRpb24sIHRpbWVyIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBkZWJvdW5jZSwgZGlzdGluY3RVbnRpbENoYW5nZWQsIG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IElMdVBvcG92ZXJQYW5lbCwgTHVQb3BvdmVyU2Nyb2xsU3RyYXRlZ3kgfSBmcm9tICcuLi9wYW5lbC9pbmRleCc7XG5pbXBvcnQgeyBJTHVQb3BvdmVyVGFyZ2V0IH0gZnJvbSAnLi4vdGFyZ2V0L2luZGV4JztcblxuZXhwb3J0IHR5cGUgTHVQb3BvdmVyVHJpZ2dlckV2ZW50ID0gJ2NsaWNrJyB8ICdob3ZlcicgfCAnbm9uZScgfCAnZm9jdXMnO1xuXG4vKipcbiAqIGNvbXBvbmVudCB0aGF0IHdpbGwgZGVjaWRlIHdoZW4gdG8gc2hvdyB0aGUgcG9wb3ZlciBhbmQgYXR0YWNoIGl0IHRvIHRoZSB0YXJnZXRcbiAqL1xuZXhwb3J0IGRlY2xhcmUgaW50ZXJmYWNlIElMdVBvcG92ZXJUcmlnZ2VyPFRQYW5lbCBleHRlbmRzIElMdVBvcG92ZXJQYW5lbCA9IElMdVBvcG92ZXJQYW5lbCwgVFRhcmdldCBleHRlbmRzIElMdVBvcG92ZXJUYXJnZXQgPSBJTHVQb3BvdmVyVGFyZ2V0PiB7XG5cdC8qKiB0aGUgcG9wb3ZlciBwYW5lbCB0byBkaXNwbGF5ICovXG5cdHBhbmVsOiBUUGFuZWw7XG5cdC8qKiB0aGUgcG9wb3ZlciB0YXJnZXQgdG8gYXR0YWNoIHRoZSBwYW5lbCAqL1xuXHR0YXJnZXQ6IFRUYXJnZXQ7XG5cblx0LyoqIHdoZW4gdG8gZGlzcGxheSB0aGUgcG9wb3ZlciAqL1xuXHR0cmlnZ2VyRXZlbnQ6IEx1UG9wb3ZlclRyaWdnZXJFdmVudDtcblx0LyoqIGRlbGF5IGJlZm9yZSBwb3BvdmVyIGFwcGFyaXRpb24gd2hlbiB0cmlnZ2VyIGlzICdob3ZlcicgKi9cblx0ZW50ZXJEZWxheTogbnVtYmVyO1xuXHQvKiogZGVsYXkgYmVmb3JlIHBvcG92ZXIgZGlzcGFyaXRpb24gd2hlbiB0cmlnZ2VyIGlzICdob3ZlcicgKi9cblx0bGVhdmVEZWxheTogbnVtYmVyO1xuXG5cdC8qKiBkaXNhYmxlIHBvcG92ZXIgYXBwYXJpdGlvbiAqL1xuXHRkaXNhYmxlZDogYm9vbGVhbjtcblx0LyoqIEV2ZW50IGVtaXR0ZWQgd2hlbiB0aGUgYXNzb2NpYXRlZCBwb3BvdmVyIGlzIG9wZW5lZC4gKi9cblx0b25PcGVuOiBPYnNlcnZhYmxlPHZvaWQ+O1xuXHQvKiogRXZlbnQgZW1pdHRlZCB3aGVuIHRoZSBhc3NvY2lhdGVkIHBvcG92ZXIgaXMgY2xvc2VkLiAqL1xuXHRvbkNsb3NlOiBPYnNlcnZhYmxlPHZvaWQ+O1xuXG5cdG9wZW5Qb3BvdmVyKCk7XG5cdGNsb3NlUG9wb3ZlcigpO1xuXHR0b2dnbGVQb3BvdmVyKCk7XG5cdGRlc3Ryb3lQb3BvdmVyKCk7XG59XG5cbi8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogbWF4LWxpbmUtbGVuZ3RoXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQUx1UG9wb3ZlclRyaWdnZXI8VFBhbmVsIGV4dGVuZHMgSUx1UG9wb3ZlclBhbmVsID0gSUx1UG9wb3ZlclBhbmVsLCBUVGFyZ2V0IGV4dGVuZHMgSUx1UG9wb3ZlclRhcmdldCA9IElMdVBvcG92ZXJUYXJnZXQ+IGltcGxlbWVudHMgSUx1UG9wb3ZlclRyaWdnZXI8VFBhbmVsLCBUVGFyZ2V0PiB7XG5cdHByb3RlY3RlZCBfcG9ydGFsOiBUZW1wbGF0ZVBvcnRhbDx1bmtub3duPiB8IENvbXBvbmVudFBvcnRhbDxUUGFuZWw+O1xuXHRwcm90ZWN0ZWQgX292ZXJsYXlSZWY6IE92ZXJsYXlSZWYgfCBudWxsID0gbnVsbDtcblx0cHJvdGVjdGVkIF9wb3BvdmVyT3BlbiA9IGZhbHNlO1xuXHQvLyBwcm90ZWN0ZWQgX2hhbHQgPSBmYWxzZTtcblx0cHJvdGVjdGVkIF9iYWNrZHJvcFN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuXHRwcm90ZWN0ZWQgX3Bvc2l0aW9uU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XG5cblx0cHJvdGVjdGVkIF9tb3VzZW92ZXJUaW1lcjogdW5rbm93bjtcblxuXHRwcm90ZWN0ZWQgX2hvdmVyZWQkID0gbmV3IFN1YmplY3QoKTtcblx0cHJvdGVjdGVkIF9ob3ZlcmVkU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XG5cdHByb3RlY3RlZCBfcGFuZWxFdmVudHNTdWJzY3JpcHRpb25zOiBTdWJzY3JpcHRpb247XG5cdHByb3RlY3RlZCBfb3ZlcmxheURldGFjaG1lbnRzU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XG5cblx0Ly8gdHJhY2tpbmcgaW5wdXQgdHlwZSBpcyBuZWNlc3Nhcnkgc28gaXQncyBwb3NzaWJsZSB0byBvbmx5IGF1dG8tZm9jdXNcblx0Ly8gdGhlIGZpcnN0IGl0ZW0gb2YgdGhlIGxpc3Qgd2hlbiB0aGUgcG9wb3ZlciBpcyBvcGVuZWQgdmlhIHRoZSBrZXlib2FyZFxuXHRwcm90ZWN0ZWQgX29wZW5lZEJ5TW91c2UgPSBmYWxzZTtcblxuXHRwcm90ZWN0ZWQgX3BhbmVsOiBUUGFuZWw7XG5cdC8qKiBSZWZlcmVuY2VzIHRoZSBwb3BvdmVyIGluc3RhbmNlIHRoYXQgdGhlIHRyaWdnZXIgaXMgYXNzb2NpYXRlZCB3aXRoLiAqL1xuXHRnZXQgcGFuZWwoKSB7XG5cdFx0cmV0dXJuIHRoaXMuX3BhbmVsO1xuXHR9XG5cdHNldCBwYW5lbChwOiBUUGFuZWwpIHtcblx0XHR0aGlzLl9wYW5lbCA9IHA7XG5cdH1cblxuXHRwcm90ZWN0ZWQgX3RhcmdldDogVFRhcmdldDtcblx0LyoqIFJlZmVyZW5jZXMgdGhlIHBvcG92ZXIgdGFyZ2V0IGluc3RhbmNlIHRoYXQgdGhlIHRyaWdnZXIgaXMgYXNzb2NpYXRlZCB3aXRoLiAqL1xuXHRnZXQgdGFyZ2V0KCkge1xuXHRcdHJldHVybiB0aGlzLl90YXJnZXQ7XG5cdH1cblx0c2V0IHRhcmdldCh0OiBUVGFyZ2V0KSB7XG5cdFx0dGhpcy5fdGFyZ2V0ID0gdDtcblx0fVxuXG5cdHByb3RlY3RlZCBfdHJpZ2dlckV2ZW50OiBMdVBvcG92ZXJUcmlnZ2VyRXZlbnQgPSAnY2xpY2snO1xuXHRnZXQgdHJpZ2dlckV2ZW50KCkge1xuXHRcdHJldHVybiB0aGlzLl90cmlnZ2VyRXZlbnQ7XG5cdH1cblx0c2V0IHRyaWdnZXJFdmVudCh0ZTogTHVQb3BvdmVyVHJpZ2dlckV2ZW50KSB7XG5cdFx0dGhpcy5fdHJpZ2dlckV2ZW50ID0gdGU7XG5cdFx0aWYgKHRlID09PSAnaG92ZXInIHx8IHRlID09PSAnZm9jdXMnKSB7XG5cdFx0XHRpZiAodGhpcy5faG92ZXJlZFN1YnNjcmlwdGlvbikge1xuXHRcdFx0XHR0aGlzLl9ob3ZlcmVkU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG5cdFx0XHR9XG5cdFx0XHR0aGlzLl9ob3ZlcmVkU3Vic2NyaXB0aW9uID0gdGhpcy5faG92ZXJlZCRcblx0XHRcdFx0LnBpcGUoXG5cdFx0XHRcdFx0ZGlzdGluY3RVbnRpbENoYW5nZWQoKSxcblx0XHRcdFx0XHRkZWJvdW5jZSgoaCkgPT4gKGggPyB0aW1lcih0aGlzLmVudGVyRGVsYXkpIDogdGltZXIodGhpcy5sZWF2ZURlbGF5KSkpLFxuXHRcdFx0XHQpXG5cdFx0XHRcdC5zdWJzY3JpYmUoKGgpID0+IChoID8gdGhpcy5vcGVuUG9wb3ZlcigpIDogdGhpcy5jbG9zZVBvcG92ZXIoKSkpO1xuXHRcdH1cblx0fVxuXHRwcm90ZWN0ZWQgX2VudGVyRGVsYXkgPSA1MDtcblx0Z2V0IGVudGVyRGVsYXkoKSB7XG5cdFx0cmV0dXJuIHRoaXMuX2VudGVyRGVsYXk7XG5cdH1cblx0c2V0IGVudGVyRGVsYXkoZDogbnVtYmVyKSB7XG5cdFx0dGhpcy5fZW50ZXJEZWxheSA9IGQ7XG5cdH1cblx0cHJvdGVjdGVkIF9sZWF2ZURlbGF5ID0gNTA7XG5cdGdldCBsZWF2ZURlbGF5KCkge1xuXHRcdHJldHVybiB0aGlzLl9sZWF2ZURlbGF5O1xuXHR9XG5cdHNldCBsZWF2ZURlbGF5KGQ6IG51bWJlcikge1xuXHRcdHRoaXMuX2xlYXZlRGVsYXkgPSBkO1xuXHR9XG5cblx0cHJvdGVjdGVkIF9kaXNhYmxlZCA9IGZhbHNlO1xuXHRnZXQgZGlzYWJsZWQoKSB7XG5cdFx0cmV0dXJuIHRoaXMuX2Rpc2FibGVkO1xuXHR9XG5cdHNldCBkaXNhYmxlZChkOiBib29sZWFuKSB7XG5cdFx0dGhpcy5fZGlzYWJsZWQgPSBkO1xuXHR9XG5cblx0cHJvdGVjdGVkIF93aGVuRWxsaXBzaXMgPSBmYWxzZTtcblx0Z2V0IHdoZW5FbGxpcHNpcygpIHtcblx0XHRyZXR1cm4gdGhpcy5fd2hlbkVsbGlwc2lzO1xuXHR9XG5cdHNldCB3aGVuRWxsaXBzaXMod2U6IGJvb2xlYW4pIHtcblx0XHR0aGlzLl93aGVuRWxsaXBzaXMgPSB3ZTtcblx0fVxuXG5cdHByb3RlY3RlZCBfdHJpZ2dlcklkOiBzdHJpbmc7XG5cdHByb3RlY3RlZCBfcGFuZWxJZDogc3RyaW5nO1xuXG5cdC8qKiBFdmVudCBlbWl0dGVkIHdoZW4gdGhlIGFzc29jaWF0ZWQgcG9wb3ZlciBpcyBvcGVuZWQuICovXG5cdGFic3RyYWN0IG9uT3BlbjogT2JzZXJ2YWJsZTx2b2lkPjtcblx0LyoqIEV2ZW50IGVtaXR0ZWQgd2hlbiB0aGUgYXNzb2NpYXRlZCBwb3BvdmVyIGlzIGNsb3NlZC4gKi9cblx0YWJzdHJhY3Qgb25DbG9zZTogT2JzZXJ2YWJsZTx2b2lkPjtcblxuXHRwcm90ZWN0ZWQgYWJzdHJhY3QgX2VtaXRPcGVuKCk6IHZvaWQ7XG5cdHByb3RlY3RlZCBhYnN0cmFjdCBfZW1pdENsb3NlKCk6IHZvaWQ7XG5cblx0Y29uc3RydWN0b3IocHJvdGVjdGVkIF9vdmVybGF5OiBPdmVybGF5LCBwcm90ZWN0ZWQgX2VsZW1lbnRSZWY6IEVsZW1lbnRSZWY8SFRNTEVsZW1lbnQ+LCBwcm90ZWN0ZWQgX3ZpZXdDb250YWluZXJSZWY6IFZpZXdDb250YWluZXJSZWYpIHtcblx0XHR0aGlzLl90cmlnZ2VySWQgPSBgcG9wb3ZlclRyaWdnZXJfJHtnZW5lcmF0ZUlkKCl9YDtcblx0XHR0aGlzLl9wYW5lbElkID0gYHBvcG92ZXJQYW5lbF8ke2dlbmVyYXRlSWQoKX1gO1xuXHR9XG5cblx0b25DbGljaygpIHtcblx0XHRpZiAodGhpcy50cmlnZ2VyRXZlbnQgPT09ICdjbGljaycgJiYgIXRoaXMuZGlzYWJsZWQpIHtcblx0XHRcdHRoaXMudG9nZ2xlUG9wb3ZlcigpO1xuXHRcdH1cblx0fVxuXG5cdG9uTW91c2VFbnRlcigpIHtcblx0XHRpZiAodGhpcy50cmlnZ2VyRXZlbnQgPT09ICdob3ZlcicgfHwgdGhpcy50cmlnZ2VyRXZlbnQgPT09ICdmb2N1cycpIHtcblx0XHRcdHRoaXMuX2hvdmVyZWQkLm5leHQodHJ1ZSk7XG5cdFx0fVxuXHR9XG5cblx0b25Nb3VzZUxlYXZlKCkge1xuXHRcdGlmICh0aGlzLnRyaWdnZXJFdmVudCA9PT0gJ2hvdmVyJyB8fCB0aGlzLnRyaWdnZXJFdmVudCA9PT0gJ2ZvY3VzJykge1xuXHRcdFx0dGhpcy5faG92ZXJlZCQubmV4dChmYWxzZSk7XG5cdFx0fVxuXHR9XG5cdG9uRm9jdXMoKSB7XG5cdFx0aWYgKHRoaXMudHJpZ2dlckV2ZW50ID09PSAnaG92ZXInIHx8IHRoaXMudHJpZ2dlckV2ZW50ID09PSAnZm9jdXMnKSB7XG5cdFx0XHR0aGlzLm9wZW5Qb3BvdmVyKCk7XG5cdFx0fVxuXHR9XG5cdG9uQmx1cigpIHtcblx0XHRpZiAodGhpcy50cmlnZ2VyRXZlbnQgPT09ICdob3ZlcicgfHwgdGhpcy50cmlnZ2VyRXZlbnQgPT09ICdmb2N1cycpIHtcblx0XHRcdHRoaXMuY2xvc2VQb3BvdmVyKCk7XG5cdFx0fVxuXHR9XG5cblx0LyoqIFRvZ2dsZXMgdGhlIHBvcG92ZXIgYmV0d2VlbiB0aGUgb3BlbiBhbmQgY2xvc2VkIHN0YXRlcy4gKi9cblx0dG9nZ2xlUG9wb3ZlcigpOiB2b2lkIHtcblx0XHRyZXR1cm4gdGhpcy5fcG9wb3Zlck9wZW4gPyB0aGlzLmNsb3NlUG9wb3ZlcigpIDogdGhpcy5vcGVuUG9wb3ZlcigpO1xuXHR9XG5cblx0LyoqIE9wZW5zIHRoZSBwb3BvdmVyLiAqL1xuXHRvcGVuUG9wb3ZlcigpOiB2b2lkIHtcblx0XHRpZiAoIXRoaXMuX3BvcG92ZXJPcGVuICYmICF0aGlzLl9kaXNhYmxlZCAmJiAoIXRoaXMuX3doZW5FbGxpcHNpcyB8fCB0aGlzLl9oYXNFbGxpcHNpcygpKSkge1xuXHRcdFx0dGhpcy5fY3JlYXRlT3ZlcmxheSgpO1xuXHRcdFx0dGhpcy5fYXR0YWNoUG9ydGFsVG9PdmVybGF5KCk7XG5cblx0XHRcdC8qKiBPbmx5IHN1YnNjcmliZSB0byBvdmVybGF5IGRldGFjaG1lbnRzIGlmIHRyaWdnZXIgZXZlbnQgaXMgaG92ZXIgb3IgZm9jdXMgKi9cblx0XHRcdGlmICh0aGlzLnRyaWdnZXJFdmVudCA9PT0gJ2hvdmVyJyB8fCB0aGlzLnRyaWdnZXJFdmVudCA9PT0gJ2ZvY3VzJykge1xuXHRcdFx0XHR0aGlzLl9zdWJzY3JpYmVUb092ZXJsYXlEZXRhY2htZW50cygpO1xuXHRcdFx0fVxuXG5cdFx0XHQvKiogT25seSBzdWJzY3JpYmUgdG8gYmFja2Ryb3AgaWYgdHJpZ2dlciBldmVudCBpcyBjbGljayAqL1xuXHRcdFx0aWYgKHRoaXMudHJpZ2dlckV2ZW50ID09PSAnY2xpY2snKSB7XG5cdFx0XHRcdHRoaXMuX3N1YnNjcmliZVRvQmFja2Ryb3AoKTtcblx0XHRcdH1cblxuXHRcdFx0LyoqIE9ubHkgc3Vic2NyaWJlIHRvIG1vdXNlIGVudGVyL2xlYXZlIG9mIHRoZSBwYW5lbCBpZiB0cmlnZ2VyID0gaG92ZXIgKi9cblxuXHRcdFx0dGhpcy5faW5pdFBvcG92ZXIoKTtcblx0XHRcdHRoaXMuX2VtaXRPcGVuKCk7XG5cdFx0fVxuXHR9XG5cblx0LyoqIENsb3NlcyB0aGUgcG9wb3Zlci4gKi9cblx0Y2xvc2VQb3BvdmVyKCk6IHZvaWQge1xuXHRcdGlmICh0aGlzLl9vdmVybGF5UmVmKSB7XG5cdFx0XHQvKiogT3ZlcmxheSBjYW4gc3RpbGwgYmUgYXR0YWNoZWQgaWYgY2xvc2UgaGFzIGJlZW4gdHJpZ2dlcmVkIGJ5IG1vdXNlIGxlYXZlLiAqL1xuXHRcdFx0aWYgKHRoaXMuX292ZXJsYXlSZWYuaGFzQXR0YWNoZWQoKSkge1xuXHRcdFx0XHR0aGlzLl9vdmVybGF5UmVmLmRldGFjaCgpO1xuXHRcdFx0fVxuXG5cdFx0XHQvKiogdW5zdWJzY3JpYmUgdG8gYmFja2Ryb3AgY2xpY2sgaWYgaXQgd2FzIGRlZmluZWQgKi9cblx0XHRcdGlmICh0aGlzLl9iYWNrZHJvcFN1YnNjcmlwdGlvbikge1xuXHRcdFx0XHQvLyBpZiAodGhpcy5wb3BvdmVyLnRyaWdnZXJFdmVudCA9PT0gJ2NsaWNrJykge1xuXHRcdFx0XHR0aGlzLl9iYWNrZHJvcFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLl9yZXNldFBvcG92ZXIoKTtcblx0XHRcdHRoaXMuX2VtaXRDbG9zZSgpO1xuXHRcdH1cblx0fVxuXG5cdC8qKiBSZW1vdmVzIHRoZSBwb3BvdmVyIGZyb20gdGhlIERPTS4gKi9cblx0ZGVzdHJveVBvcG92ZXIoKTogdm9pZCB7XG5cdFx0aWYgKHRoaXMuX292ZXJsYXlSZWYpIHtcblx0XHRcdHRoaXMuX292ZXJsYXlSZWYuZGlzcG9zZSgpO1xuXHRcdFx0dGhpcy5fb3ZlcmxheVJlZiA9IG51bGw7XG5cdFx0XHR0aGlzLl9jbGVhblVwU3Vic2NyaXB0aW9ucygpO1xuXHRcdH1cblx0fVxuXG5cdC8qKiBGb2N1c2VzIHRoZSBwb3BvdmVyIHRyaWdnZXIuICovXG5cdGZvY3VzKCkge1xuXHRcdHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuXHR9XG5cblx0X2hhbmRsZU1vdXNlZG93bihldmVudDogTW91c2VFdmVudCk6IHZvaWQge1xuXHRcdGlmICghaXNGYWtlTW91c2Vkb3duRnJvbVNjcmVlblJlYWRlcihldmVudCkpIHtcblx0XHRcdHRoaXMuX29wZW5lZEJ5TW91c2UgPSB0cnVlO1xuXHRcdH1cblx0fVxuXG5cdC8qKiBUaGUgdGV4dCBkaXJlY3Rpb24gb2YgdGhlIGNvbnRhaW5pbmcgYXBwLiAqL1xuXHRnZXQgZGlyKCk6IERpcmVjdGlvbiB7XG5cdFx0Ly8gcmV0dXJuIHRoaXMuX2RpciAmJiB0aGlzLl9kaXIudmFsdWUgPT09ICdydGwnID8gJ3J0bCcgOiAnbHRyJztcblx0XHRyZXR1cm4gJ2x0cic7XG5cdH1cblxuXHQvKiogUmV0dXJuIGlmIHRoZSBwb3BvdmVyIG1haW4gcG9zaXRpb25uaW5nIGlzIHZlcnRpY2FsICovXG5cdGdldCBpc1ZlcnRpY2FsbHlQb3NpdGlvbm5lZCgpOiBib29sZWFuIHtcblx0XHRjb25zdCBwb3NpdGlvbiA9IHRoaXMudGFyZ2V0LnBvc2l0aW9uO1xuXHRcdHJldHVybiBwb3NpdGlvbiA9PT0gJ2JlbG93JyB8fCBwb3NpdGlvbiA9PT0gJ2Fib3ZlJztcblx0fVxuXG5cdHByb3RlY3RlZCBfYXR0YWNoUG9ydGFsVG9PdmVybGF5KCk6IHZvaWQge1xuXHRcdHRoaXMuX292ZXJsYXlSZWYuYXR0YWNoKHRoaXMuX3BvcnRhbCk7XG5cdH1cblxuXHRwcm90ZWN0ZWQgX2dldFBhbmVsU2Nyb2xsU3RyYXRlZ3koKTogTHVQb3BvdmVyU2Nyb2xsU3RyYXRlZ3kge1xuXHRcdHJldHVybiB0aGlzLnBhbmVsLnNjcm9sbFN0cmF0ZWd5O1xuXHR9XG5cblx0LyoqXG5cdCAqIFRoaXMgbWV0aG9kIGVuc3VyZXMgdGhhdCB0aGUgcG9wb3ZlclxuXHQgKi9cblx0cHJvdGVjdGVkIF9zdWJzY3JpYmVUb1BhbmVsRXZlbnRzKCk6IHZvaWQge1xuXHRcdGlmICh0aGlzLl9vdmVybGF5UmVmKSB7XG5cdFx0XHR0aGlzLl9wYW5lbEV2ZW50c1N1YnNjcmlwdGlvbnMgPSBuZXcgU3Vic2NyaXB0aW9uKCk7XG5cdFx0XHRpZiAodGhpcy50cmlnZ2VyRXZlbnQgPT09ICdob3ZlcicgfHwgdGhpcy50cmlnZ2VyRXZlbnQgPT09ICdmb2N1cycpIHtcblx0XHRcdFx0dGhpcy5fcGFuZWxFdmVudHNTdWJzY3JpcHRpb25zLmFkZChcblx0XHRcdFx0XHR0aGlzLnBhbmVsLmhvdmVyZWQuc3Vic2NyaWJlKChob3ZlcmVkKSA9PiB7XG5cdFx0XHRcdFx0XHR0aGlzLl9ob3ZlcmVkJC5uZXh0KGhvdmVyZWQpO1xuXHRcdFx0XHRcdH0pLFxuXHRcdFx0XHQpO1xuXHRcdFx0fVxuXHRcdFx0dGhpcy5fcGFuZWxFdmVudHNTdWJzY3JpcHRpb25zLmFkZChcblx0XHRcdFx0dGhpcy5wYW5lbC5jbG9zZS5zdWJzY3JpYmUoKCkgPT4ge1xuXHRcdFx0XHRcdHRoaXMuY2xvc2VQb3BvdmVyKCk7XG5cdFx0XHRcdH0pLFxuXHRcdFx0KTtcblx0XHRcdHRoaXMuX3BhbmVsRXZlbnRzU3Vic2NyaXB0aW9ucy5hZGQoXG5cdFx0XHRcdHRoaXMucGFuZWwub3Blbi5zdWJzY3JpYmUoKCkgPT4ge1xuXHRcdFx0XHRcdHRoaXMub3BlblBvcG92ZXIoKTtcblx0XHRcdFx0fSksXG5cdFx0XHQpO1xuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBUaGlzIG1ldGhvZCBlbnN1cmVzIHRoYXQgdGhlIHBvcG92ZXIgY2xvc2VzIHdoZW4gdGhlIG92ZXJsYXkgaGFzIGJlZW4gZGV0YWNoZWRcblx0ICogRGV0YWNoIGNhbiBvY2N1ciBpZiB3ZSBzY3JvbGwgd2hpbGUgcG9wb3ZlciBpcyBvcGVuZWRcblx0ICovXG5cdHByb3RlY3RlZCBfc3Vic2NyaWJlVG9PdmVybGF5RGV0YWNobWVudHMoKTogdm9pZCB7XG5cdFx0aWYgKHRoaXMuX292ZXJsYXlSZWYpIHtcblx0XHRcdHRoaXMuX292ZXJsYXlEZXRhY2htZW50c1N1YnNjcmlwdGlvbiA9IHRoaXMuX292ZXJsYXlSZWYuZGV0YWNobWVudHMoKS5zdWJzY3JpYmUoKCkgPT4ge1xuXHRcdFx0XHR0aGlzLl9ob3ZlcmVkJC5uZXh0KGZhbHNlKTtcblx0XHRcdH0pO1xuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBUaGlzIG1ldGhvZCBlbnN1cmVzIHRoYXQgdGhlIHBvcG92ZXIgY2xvc2VzIHdoZW4gdGhlIG92ZXJsYXkgYmFja2Ryb3AgaXMgY2xpY2tlZC5cblx0ICogV2UgZG8gbm90IHVzZSBmaXJzdCgpIGhlcmUgYmVjYXVzZSBkb2luZyBzbyB3b3VsZCBub3QgY2F0Y2ggY2xpY2tzIGZyb20gd2l0aGluXG5cdCAqIHRoZSBwb3BvdmVyLCBhbmQgaXQgd291bGQgZmFpbCB0byB1bnN1YnNjcmliZSBwcm9wZXJseS4gSW5zdGVhZCwgd2UgdW5zdWJzY3JpYmVcblx0ICogZXhwbGljaXRseSB3aGVuIHRoZSBwb3BvdmVyIGlzIGNsb3NlZCBvciBkZXN0cm95ZWQuXG5cdCAqL1xuXHRwcm90ZWN0ZWQgX3N1YnNjcmliZVRvQmFja2Ryb3AoKTogdm9pZCB7XG5cdFx0aWYgKHRoaXMuX292ZXJsYXlSZWYpIHtcblx0XHRcdHRoaXMuX2JhY2tkcm9wU3Vic2NyaXB0aW9uID0gdGhpcy5fb3ZlcmxheVJlZi5iYWNrZHJvcENsaWNrKCkuc3Vic2NyaWJlKCgpID0+IHtcblx0XHRcdFx0dGhpcy5jbG9zZVBvcG92ZXIoKTtcblx0XHRcdH0pO1xuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBUaGlzIG1ldGhvZCBzZXRzIHRoZSBwb3BvdmVyIHN0YXRlIHRvIG9wZW4gYW5kIGZvY3VzZXMgdGhlIGZpcnN0IGl0ZW0gaWZcblx0ICogdGhlIHBvcG92ZXIgd2FzIG9wZW5lZCB2aWEgdGhlIGtleWJvYXJkLlxuXHQgKi9cblx0cHJvdGVjdGVkIF9pbml0UG9wb3ZlcigpOiB2b2lkIHtcblx0XHR0aGlzLl9zZXRJc1BvcG92ZXJPcGVuKHRydWUpO1xuXHRcdHRoaXMucGFuZWwucGFuZWxJZCA9IHRoaXMuX3BhbmVsSWQ7XG5cdFx0dGhpcy5wYW5lbC50cmlnZ2VySWQgPSB0aGlzLl90cmlnZ2VySWQ7XG5cdFx0dGhpcy5wYW5lbC5rZXlkb3duRXZlbnRzJCA9IHRoaXMuX292ZXJsYXlSZWYua2V5ZG93bkV2ZW50cygpO1xuXHRcdHRoaXMuX3N1YnNjcmliZVRvUGFuZWxFdmVudHMoKTtcblx0fVxuXG5cdC8qKlxuXHQgKiBUaGlzIG1ldGhvZCByZXNldHMgdGhlIHBvcG92ZXIgd2hlbiBpdCdzIGNsb3NlZCwgbW9zdCBpbXBvcnRhbnRseSByZXN0b3Jpbmdcblx0ICogZm9jdXMgdG8gdGhlIHBvcG92ZXIgdHJpZ2dlciBpZiB0aGUgcG9wb3ZlciB3YXMgb3BlbmVkIHZpYSB0aGUga2V5Ym9hcmQuXG5cdCAqL1xuXHRwcm90ZWN0ZWQgX3Jlc2V0UG9wb3ZlcigpOiB2b2lkIHtcblx0XHR0aGlzLl9zZXRJc1BvcG92ZXJPcGVuKGZhbHNlKTtcblxuXHRcdC8vIEZvY3VzIG9ubHkgbmVlZHMgdG8gYmUgcmVzZXQgdG8gdGhlIGhvc3QgZWxlbWVudCBpZiB0aGUgcG9wb3ZlciB3YXMgb3BlbmVkXG5cdFx0Ly8gYnkgdGhlIGtleWJvYXJkIGFuZCBtYW51YWxseSBzaGlmdGVkIHRvIHRoZSBmaXJzdCBwb3BvdmVyIGl0ZW0uXG5cdFx0aWYgKCF0aGlzLl9vcGVuZWRCeU1vdXNlICYmIHRoaXMudHJpZ2dlckV2ZW50ID09PSAnY2xpY2snKSB7XG5cdFx0XHR0aGlzLmZvY3VzKCk7XG5cdFx0fVxuXHRcdHRoaXMuX29wZW5lZEJ5TW91c2UgPSBmYWxzZTtcblx0fVxuXG5cdC8qKiBzZXQgc3RhdGUgcmF0aGVyIHRoYW4gdG9nZ2xlIHRvIHN1cHBvcnQgdHJpZ2dlcnMgc2hhcmluZyBhIHBvcG92ZXIgKi9cblx0cHJvdGVjdGVkIF9zZXRJc1BvcG92ZXJPcGVuKGlzT3BlbjogYm9vbGVhbik6IHZvaWQge1xuXHRcdHRoaXMuX3BvcG92ZXJPcGVuID0gaXNPcGVuO1xuXHRcdC8vIHRlbGwgdGhlIHBhbmVsIGl0J3Mgb3BlbmluZy9jbG9zaW5nXG5cdFx0aXNPcGVuID8gdGhpcy5wYW5lbC5vbk9wZW4oKSA6IHRoaXMucGFuZWwub25DbG9zZSgpO1xuXHR9XG5cblx0LyoqXG5cdCAqICBUaGlzIG1ldGhvZCBjaGVja3MgdGhhdCBhIHZhbGlkIGluc3RhbmNlIG9mIE1kUG9wb3ZlciBoYXMgYmVlbiBwYXNzZWQgaW50b1xuXHQgKiAgbWRQb3BvdmVyVHJpZ2dlckZvci4gSWYgbm90LCBhbiBleGNlcHRpb24gaXMgdGhyb3duLlxuXHQgKi9cblx0cHJvdGVjdGVkIF9jaGVja1BhbmVsKCkge1xuXHRcdGlmICghdGhpcy5wYW5lbCkge1xuXHRcdFx0dGhyb3cgRXJyb3IoYGx1LXBvcG92ZXItdHJpZ2dlcjogbXVzdCBwYXNzIGluIGEgbHUtcG9wb3ZlciBpbnN0YW5jZS5cbiAgICAgIEV4YW1wbGU6XG4gICAgICA8bHUtcG9wb3ZlciAjcG9wb3Zlcj1cIkx1UG9wb3ZlclwiPjwvbHUtcG9wb3Zlcj5cbiAgICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiIFtsdVBvcG92ZXJdPVwicG9wb3ZlclwiPjwvYnV0dG9uPmApO1xuXHRcdH1cblx0fVxuXHRwcm90ZWN0ZWQgX2NoZWNrVGFyZ2V0KCkge1xuXHRcdGlmICghdGhpcy50YXJnZXQpIHtcblx0XHRcdHRocm93IEVycm9yKGBsdS1wb3BvdmVyLXRyaWdnZXI6IG11c3QgcGFzcyBpbiBhIHBvcG92ZXIgdGFyZ2V0IGluc3RhbmNlLmApO1xuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiAgVGhpcyBtZXRob2QgY3JlYXRlcyB0aGUgb3ZlcmxheSBmcm9tIHRoZSBwcm92aWRlZCBwb3BvdmVyJ3MgdGVtcGxhdGUgYW5kIHNhdmVzIGl0c1xuXHQgKiAgT3ZlcmxheVJlZiBzbyB0aGF0IGl0IGNhbiBiZSBhdHRhY2hlZCB0byB0aGUgRE9NIHdoZW4gb3BlblBvcG92ZXIgaXMgY2FsbGVkLlxuXHQgKi9cblx0cHJvdGVjdGVkIF9jcmVhdGVPdmVybGF5KCk6IE92ZXJsYXlSZWYge1xuXHRcdGlmICghdGhpcy5fb3ZlcmxheVJlZikge1xuXHRcdFx0dGhpcy5fcG9ydGFsID0gbmV3IFRlbXBsYXRlUG9ydGFsKHRoaXMucGFuZWwudGVtcGxhdGVSZWYsIHRoaXMuX3ZpZXdDb250YWluZXJSZWYpO1xuXHRcdFx0Y29uc3QgY29uZmlnID0gdGhpcy5fZ2V0T3ZlcmxheUNvbmZpZygpO1xuXHRcdFx0dGhpcy5fc3Vic2NyaWJlVG9Qb3NpdGlvbnMoY29uZmlnLnBvc2l0aW9uU3RyYXRlZ3kgYXMgRmxleGlibGVDb25uZWN0ZWRQb3NpdGlvblN0cmF0ZWd5KTtcblx0XHRcdHRoaXMuX292ZXJsYXlSZWYgPSB0aGlzLl9vdmVybGF5LmNyZWF0ZShjb25maWcpO1xuXHRcdH1cblxuXHRcdHJldHVybiB0aGlzLl9vdmVybGF5UmVmO1xuXHR9XG5cblx0LyoqXG5cdCAqIFRoaXMgbWV0aG9kIGJ1aWxkcyB0aGUgY29uZmlndXJhdGlvbiBvYmplY3QgbmVlZGVkIHRvIGNyZWF0ZSB0aGUgb3ZlcmxheSwgdGhlIE92ZXJsYXlDb25maWcuXG5cdCAqIEByZXR1cm5zIE92ZXJsYXlDb25maWdcblx0ICovXG5cdHByb3RlY3RlZCBfZ2V0T3ZlcmxheUNvbmZpZygpOiBPdmVybGF5Q29uZmlnIHtcblx0XHRjb25zdCBvdmVybGF5U3RhdGUgPSBuZXcgT3ZlcmxheUNvbmZpZygpO1xuXHRcdG92ZXJsYXlTdGF0ZS5wb3NpdGlvblN0cmF0ZWd5ID0gdGhpcy5fZ2V0UG9zaXRpb24oKTtcblx0XHQvKiogRGlzcGxheSBvdmVybGF5IGJhY2tkcm9wIGlmIHRyaWdnZXIgZXZlbnQgaXMgY2xpY2sgKi9cblx0XHRpZiAodGhpcy50cmlnZ2VyRXZlbnQgPT09ICdjbGljaycpIHtcblx0XHRcdG92ZXJsYXlTdGF0ZS5oYXNCYWNrZHJvcCA9IHRydWU7XG5cdFx0XHRvdmVybGF5U3RhdGUuYmFja2Ryb3BDbGFzcyA9ICdjZGstb3ZlcmxheS10cmFuc3BhcmVudC1iYWNrZHJvcCc7XG5cdFx0fVxuXG5cdFx0b3ZlcmxheVN0YXRlLmRpcmVjdGlvbiA9IHRoaXMuZGlyO1xuXHRcdGNvbnN0IHNjcm9sbFN0cmF0ZWd5ID0gdGhpcy5fZ2V0UGFuZWxTY3JvbGxTdHJhdGVneSgpO1xuXHRcdHN3aXRjaCAoc2Nyb2xsU3RyYXRlZ3kpIHtcblx0XHRcdGNhc2UgJ2Jsb2NrJzpcblx0XHRcdFx0b3ZlcmxheVN0YXRlLnNjcm9sbFN0cmF0ZWd5ID0gdGhpcy5fb3ZlcmxheS5zY3JvbGxTdHJhdGVnaWVzLmJsb2NrKCk7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlICdjbG9zZSc6XG5cdFx0XHRcdG92ZXJsYXlTdGF0ZS5zY3JvbGxTdHJhdGVneSA9IHRoaXMuX292ZXJsYXkuc2Nyb2xsU3RyYXRlZ2llcy5jbG9zZSgpO1xuXHRcdFx0XHRicmVhaztcblxuXHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0b3ZlcmxheVN0YXRlLnNjcm9sbFN0cmF0ZWd5ID0gdGhpcy5fb3ZlcmxheS5zY3JvbGxTdHJhdGVnaWVzLnJlcG9zaXRpb24oKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXHRcdHJldHVybiBvdmVybGF5U3RhdGU7XG5cdH1cblxuXHQvKipcblx0ICogTGlzdGVucyB0byBjaGFuZ2VzIGluIHRoZSBwb3NpdGlvbiBvZiB0aGUgb3ZlcmxheSBhbmQgc2V0cyB0aGUgY29ycmVjdCBjbGFzc2VzXG5cdCAqIG9uIHRoZSBwb3BvdmVyIGJhc2VkIG9uIHRoZSBuZXcgcG9zaXRpb24uIFRoaXMgZW5zdXJlcyB0aGUgYW5pbWF0aW9uIG9yaWdpbiBpcyBhbHdheXNcblx0ICogY29ycmVjdCwgZXZlbiBpZiBhIGZhbGxiYWNrIHBvc2l0aW9uIGlzIHVzZWQgZm9yIHRoZSBvdmVybGF5LlxuXHQgKi9cblx0cHJvdGVjdGVkIF9zdWJzY3JpYmVUb1Bvc2l0aW9ucyhwb3NpdGlvbjogRmxleGlibGVDb25uZWN0ZWRQb3NpdGlvblN0cmF0ZWd5KTogdm9pZCB7XG5cdFx0dGhpcy5fcG9zaXRpb25TdWJzY3JpcHRpb24gPSBwb3NpdGlvbi5wb3NpdGlvbkNoYW5nZXNcblx0XHRcdC5waXBlKFxuXHRcdFx0XHRtYXAoKGMpID0+IGMuY29ubmVjdGlvblBhaXIpLFxuXHRcdFx0XHRkaXN0aW5jdFVudGlsQ2hhbmdlZCgpLFxuXHRcdFx0KVxuXHRcdFx0LnN1YnNjcmliZSgoY29ubmVjdGlvblBhaXIpID0+IHtcblx0XHRcdFx0dGhpcy5wYW5lbC5zZXRQb3NpdGlvbkNsYXNzZXMoY29ubmVjdGlvblBhaXIub3ZlcmxheVgsIGNvbm5lY3Rpb25QYWlyLm92ZXJsYXlZKTtcblx0XHRcdH0pO1xuXHR9XG5cblx0LyoqXG5cdCAqIFRoaXMgbWV0aG9kIGJ1aWxkcyB0aGUgcG9zaXRpb24gc3RyYXRlZ3kgZm9yIHRoZSBvdmVybGF5LCBzbyB0aGUgcG9wb3ZlciBpcyBwcm9wZXJseSBjb25uZWN0ZWRcblx0ICogdG8gdGhlIHRyaWdnZXIuXG5cdCAqIEByZXR1cm5zIEZsZXhpYmxlQ29ubmVjdGVkUG9zaXRpb25TdHJhdGVneVxuXHQgKi9cblx0cHJvdGVjdGVkIF9nZXRQb3NpdGlvbigpOiBGbGV4aWJsZUNvbm5lY3RlZFBvc2l0aW9uU3RyYXRlZ3kge1xuXHRcdC8qKlxuXHRcdCAqIEZvciBvdmVycmlkaW5nIHBvc2l0aW9uIGVsZW1lbnQsIHdoZW4gTHVQb3BvdmVyVGFyZ2V0QXQgaGFzIGEgdmFsaWQgZWxlbWVudCByZWZlcmVuY2UuXG5cdFx0ICogVXNlZnVsIGZvciBzdGlja2luZyBwb3BvdmVyIHRvIHBhcmVudCBlbGVtZW50IGFuZCBvZmZzZXR0aW5nIGFycm93IHRvIHRyaWdnZXIgZWxlbWVudC5cblx0XHQgKiBJZiB1bmRlZmluZWQgZGVmYXVsdHMgdG8gdGhlIHRyaWdnZXIgZWxlbWVudCByZWZlcmVuY2UuXG5cdFx0ICovXG5cdFx0Y29uc3QgZWxlbWVudCA9IHRoaXMudGFyZ2V0LmVsZW1lbnRSZWY7XG5cdFx0Ly8gaWYgKHR5cGVvZiB0aGlzLnRhcmdldEVsZW1lbnQgIT09ICd1bmRlZmluZWQnICYmIHRoaXMucG9wb3Zlcikge1xuXHRcdC8vIFx0dGhpcy5wb3BvdmVyLmNvbnRhaW5lclBvc2l0aW9uaW5nID0gdHJ1ZTtcblx0XHQvLyBcdGVsZW1lbnQgPSB0aGlzLnRhcmdldEVsZW1lbnQuX2VsZW1lbnRSZWY7XG5cdFx0Ly8gfVxuXG5cdFx0Y29uc3QgY29ubmVjdGlvblBvc2l0aW9uOiBPcmlnaW5Db25uZWN0aW9uUG9zaXRpb24gPSB7XG5cdFx0XHRvcmlnaW5YOiAnc3RhcnQnLFxuXHRcdFx0b3JpZ2luWTogJ3RvcCcsXG5cdFx0fTtcblxuXHRcdC8vIFBvc2l0aW9uXG5cdFx0Y29uc3QgcG9zaXRpb24gPSB0aGlzLnRhcmdldC5wb3NpdGlvbjtcblx0XHRjb25zdCBvdmVybGFwID0gdGhpcy50YXJnZXQub3ZlcmxhcDtcblx0XHRpZiAocG9zaXRpb24gPT09ICdhYm92ZScpIHtcblx0XHRcdGNvbm5lY3Rpb25Qb3NpdGlvbi5vcmlnaW5ZID0gb3ZlcmxhcCA/ICdib3R0b20nIDogJ3RvcCc7XG5cdFx0fSBlbHNlIGlmIChwb3NpdGlvbiA9PT0gJ2JlbG93Jykge1xuXHRcdFx0Y29ubmVjdGlvblBvc2l0aW9uLm9yaWdpblkgPSBvdmVybGFwID8gJ3RvcCcgOiAnYm90dG9tJztcblx0XHR9IGVsc2UgaWYgKHBvc2l0aW9uID09PSAnYmVmb3JlJykge1xuXHRcdFx0Y29ubmVjdGlvblBvc2l0aW9uLm9yaWdpblggPSBvdmVybGFwID8gJ2VuZCcgOiAnc3RhcnQnO1xuXHRcdH0gZWxzZSBpZiAocG9zaXRpb24gPT09ICdhZnRlcicpIHtcblx0XHRcdGNvbm5lY3Rpb25Qb3NpdGlvbi5vcmlnaW5YID0gb3ZlcmxhcCA/ICdzdGFydCcgOiAnZW5kJztcblx0XHR9XG5cblx0XHQvLyBBbGlnbm1lbnRcblx0XHRjb25zdCBhbGlnbm1lbnQgPSB0aGlzLnRhcmdldC5hbGlnbm1lbnQ7XG5cdFx0aWYgKHRoaXMuaXNWZXJ0aWNhbGx5UG9zaXRpb25uZWQpIHtcblx0XHRcdGlmIChhbGlnbm1lbnQgPT09ICdsZWZ0Jykge1xuXHRcdFx0XHRjb25uZWN0aW9uUG9zaXRpb24ub3JpZ2luWCA9ICdzdGFydCc7XG5cdFx0XHR9IGVsc2UgaWYgKGFsaWdubWVudCA9PT0gJ3JpZ2h0Jykge1xuXHRcdFx0XHRjb25uZWN0aW9uUG9zaXRpb24ub3JpZ2luWCA9ICdlbmQnO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29ubmVjdGlvblBvc2l0aW9uLm9yaWdpblggPSAnY2VudGVyJztcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0aWYgKGFsaWdubWVudCA9PT0gJ3RvcCcpIHtcblx0XHRcdFx0Y29ubmVjdGlvblBvc2l0aW9uLm9yaWdpblkgPSAndG9wJztcblx0XHRcdH0gZWxzZSBpZiAoYWxpZ25tZW50ID09PSAnYm90dG9tJykge1xuXHRcdFx0XHRjb25uZWN0aW9uUG9zaXRpb24ub3JpZ2luWSA9ICdib3R0b20nO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Y29ubmVjdGlvblBvc2l0aW9uLm9yaWdpblkgPSAnY2VudGVyJztcblx0XHRcdH1cblx0XHR9XG5cblx0XHRjb25zdCBvdmVybGF5UG9zaXRpb246IE92ZXJsYXlDb25uZWN0aW9uUG9zaXRpb24gPSB7XG5cdFx0XHRvdmVybGF5WDogJ3N0YXJ0Jyxcblx0XHRcdG92ZXJsYXlZOiAndG9wJyxcblx0XHR9O1xuXG5cdFx0aWYgKG92ZXJsYXApIHtcblx0XHRcdG92ZXJsYXlQb3NpdGlvbi5vdmVybGF5WCA9IGNvbm5lY3Rpb25Qb3NpdGlvbi5vcmlnaW5YO1xuXHRcdFx0b3ZlcmxheVBvc2l0aW9uLm92ZXJsYXlZID0gY29ubmVjdGlvblBvc2l0aW9uLm9yaWdpblk7XG5cdFx0fSBlbHNlIGlmICh0aGlzLmlzVmVydGljYWxseVBvc2l0aW9ubmVkKSB7XG5cdFx0XHRvdmVybGF5UG9zaXRpb24ub3ZlcmxheVggPSBjb25uZWN0aW9uUG9zaXRpb24ub3JpZ2luWDtcblx0XHRcdG92ZXJsYXlQb3NpdGlvbi5vdmVybGF5WSA9IHBvc2l0aW9uID09PSAnYWJvdmUnID8gJ2JvdHRvbScgOiAndG9wJztcblx0XHR9IGVsc2Uge1xuXHRcdFx0b3ZlcmxheVBvc2l0aW9uLm92ZXJsYXlYID0gcG9zaXRpb24gPT09ICdiZWZvcmUnID8gJ2VuZCcgOiAnc3RhcnQnO1xuXHRcdFx0b3ZlcmxheVBvc2l0aW9uLm92ZXJsYXlZID0gY29ubmVjdGlvblBvc2l0aW9uLm9yaWdpblk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXMuX292ZXJsYXlcblx0XHRcdC5wb3NpdGlvbigpXG5cdFx0XHQuZmxleGlibGVDb25uZWN0ZWRUbyhlbGVtZW50KVxuXHRcdFx0LndpdGhQb3NpdGlvbnMoW1xuXHRcdFx0XHR7XG5cdFx0XHRcdFx0b3JpZ2luWDogY29ubmVjdGlvblBvc2l0aW9uLm9yaWdpblgsXG5cdFx0XHRcdFx0b3JpZ2luWTogY29ubmVjdGlvblBvc2l0aW9uLm9yaWdpblksXG5cdFx0XHRcdFx0b3ZlcmxheVg6IG92ZXJsYXlQb3NpdGlvbi5vdmVybGF5WCxcblx0XHRcdFx0XHRvdmVybGF5WTogb3ZlcmxheVBvc2l0aW9uLm92ZXJsYXlZLFxuXHRcdFx0XHR9LFxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0b3JpZ2luWDogY29ubmVjdGlvblBvc2l0aW9uLm9yaWdpblgsXG5cdFx0XHRcdFx0b3JpZ2luWTogdGhpcy5faW52ZXJ0VmVydGljYWxQb3MoY29ubmVjdGlvblBvc2l0aW9uLm9yaWdpblkpLFxuXHRcdFx0XHRcdG92ZXJsYXlYOiBvdmVybGF5UG9zaXRpb24ub3ZlcmxheVgsXG5cdFx0XHRcdFx0b3ZlcmxheVk6IHRoaXMuX2ludmVydFZlcnRpY2FsUG9zKG92ZXJsYXlQb3NpdGlvbi5vdmVybGF5WSksXG5cdFx0XHRcdH0sXG5cdFx0XHRcdHtcblx0XHRcdFx0XHRvcmlnaW5YOiB0aGlzLl9pbnZlcnRIb3Jpem9udGFsUG9zKGNvbm5lY3Rpb25Qb3NpdGlvbi5vcmlnaW5YKSxcblx0XHRcdFx0XHRvcmlnaW5ZOiBjb25uZWN0aW9uUG9zaXRpb24ub3JpZ2luWSxcblx0XHRcdFx0XHRvdmVybGF5WDogdGhpcy5faW52ZXJ0SG9yaXpvbnRhbFBvcyhvdmVybGF5UG9zaXRpb24ub3ZlcmxheVgpLFxuXHRcdFx0XHRcdG92ZXJsYXlZOiBvdmVybGF5UG9zaXRpb24ub3ZlcmxheVksXG5cdFx0XHRcdH0sXG5cdFx0XHRcdHtcblx0XHRcdFx0XHRvcmlnaW5YOiB0aGlzLl9pbnZlcnRIb3Jpem9udGFsUG9zKGNvbm5lY3Rpb25Qb3NpdGlvbi5vcmlnaW5YKSxcblx0XHRcdFx0XHRvcmlnaW5ZOiB0aGlzLl9pbnZlcnRWZXJ0aWNhbFBvcyhjb25uZWN0aW9uUG9zaXRpb24ub3JpZ2luWSksXG5cdFx0XHRcdFx0b3ZlcmxheVg6IHRoaXMuX2ludmVydEhvcml6b250YWxQb3Mob3ZlcmxheVBvc2l0aW9uLm92ZXJsYXlYKSxcblx0XHRcdFx0XHRvdmVybGF5WTogdGhpcy5faW52ZXJ0VmVydGljYWxQb3Mob3ZlcmxheVBvc2l0aW9uLm92ZXJsYXlZKSxcblx0XHRcdFx0fSxcblx0XHRcdF0pXG5cdFx0XHQud2l0aERlZmF1bHRPZmZzZXRYKHRoaXMudGFyZ2V0Lm9mZnNldFgpXG5cdFx0XHQud2l0aERlZmF1bHRPZmZzZXRZKHRoaXMudGFyZ2V0Lm9mZnNldFkpO1xuXHR9XG5cblx0cHJvdGVjdGVkIF9pbnZlcnRWZXJ0aWNhbFBvcyh5OiBWZXJ0aWNhbENvbm5lY3Rpb25Qb3MpIHtcblx0XHRpZiAoeSA9PT0gJ3RvcCcpIHtcblx0XHRcdHkgPSAnYm90dG9tJztcblx0XHR9IGVsc2UgaWYgKHkgPT09ICdib3R0b20nKSB7XG5cdFx0XHR5ID0gJ3RvcCc7XG5cdFx0fVxuXHRcdHJldHVybiB5O1xuXHR9XG5cblx0cHJvdGVjdGVkIF9pbnZlcnRIb3Jpem9udGFsUG9zKHg6IEhvcml6b250YWxDb25uZWN0aW9uUG9zKSB7XG5cdFx0aWYgKHggPT09ICdlbmQnKSB7XG5cdFx0XHR4ID0gJ3N0YXJ0Jztcblx0XHR9IGVsc2UgaWYgKHggPT09ICdzdGFydCcpIHtcblx0XHRcdHggPSAnZW5kJztcblx0XHR9XG5cblx0XHRyZXR1cm4geDtcblx0fVxuXG5cdHByb3RlY3RlZCBfY2xlYW5VcFN1YnNjcmlwdGlvbnMoKTogdm9pZCB7XG5cdFx0aWYgKHRoaXMuX2JhY2tkcm9wU3Vic2NyaXB0aW9uKSB7XG5cdFx0XHR0aGlzLl9iYWNrZHJvcFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuXHRcdH1cblx0XHRpZiAodGhpcy5fcG9zaXRpb25TdWJzY3JpcHRpb24pIHtcblx0XHRcdHRoaXMuX3Bvc2l0aW9uU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG5cdFx0fVxuXHRcdGlmICh0aGlzLl9ob3ZlcmVkU3Vic2NyaXB0aW9uKSB7XG5cdFx0XHR0aGlzLl9ob3ZlcmVkU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG5cdFx0fVxuXHRcdGlmICh0aGlzLl9wYW5lbEV2ZW50c1N1YnNjcmlwdGlvbnMpIHtcblx0XHRcdHRoaXMuX3BhbmVsRXZlbnRzU3Vic2NyaXB0aW9ucy51bnN1YnNjcmliZSgpO1xuXHRcdH1cblx0XHRpZiAodGhpcy5fb3ZlcmxheURldGFjaG1lbnRzU3Vic2NyaXB0aW9uKSB7XG5cdFx0XHR0aGlzLl9vdmVybGF5RGV0YWNobWVudHNTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcblx0XHR9XG5cdH1cblxuXHRwcm90ZWN0ZWQgX2hhc0VsbGlwc2lzKCk6IGJvb2xlYW4ge1xuXHRcdGlmICghKHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudCBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KSkge1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblxuXHRcdGNvbnN0IHsgc2Nyb2xsV2lkdGgsIHNjcm9sbEhlaWdodCwgY2xpZW50V2lkdGgsIGNsaWVudEhlaWdodCB9ID0gdGhpcy5fZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50O1xuXG5cdFx0Y29uc3QgdGV4dENsYW1wZWRCeVdpZHRoID0gc2Nyb2xsV2lkdGggPiBjbGllbnRXaWR0aDtcblx0XHRjb25zdCB0ZXh0Q2xhbXBlZEJ5SGVpZ2h0ID0gc2Nyb2xsSGVpZ2h0ID4gY2xpZW50SGVpZ2h0O1xuXG5cdFx0cmV0dXJuIHRleHRDbGFtcGVkQnlXaWR0aCB8fCB0ZXh0Q2xhbXBlZEJ5SGVpZ2h0O1xuXHR9XG59XG4iXX0=