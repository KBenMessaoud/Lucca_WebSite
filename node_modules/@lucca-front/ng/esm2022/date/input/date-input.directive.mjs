import { Directive, forwardRef, HostListener, Input } from '@angular/core';
import { NG_VALIDATORS, NG_VALUE_ACCESSOR } from '@angular/forms';
import { ELuDateGranularity, getIntl } from '@lucca-front/ng/core';
import { ALuInput } from '@lucca-front/ng/input';
import { LU_DATE_INPUT_TRANSLATIONS } from './date-input.translate';
import * as i0 from "@angular/core";
import * as i1 from "@lucca-front/ng/core";
class LuDateInputDirective extends ALuInput {
    set placeholder(p) {
        this._elementRef.nativeElement.placeholder = p;
    }
    constructor(_changeDetectorRef, _elementRef, _renderer, _adapter) {
        super(_changeDetectorRef, _elementRef, _renderer);
        this._adapter = _adapter;
        this._focused = false;
        this.granularity = ELuDateGranularity.day;
        this._intl = getIntl(LU_DATE_INPUT_TRANSLATIONS);
    }
    ngOnInit() {
        switch (this.granularity) {
            case ELuDateGranularity.year:
                this.placeholder = this._intl.placeholderYear;
                break;
            case ELuDateGranularity.month:
                this.placeholder = this._intl.placeholderMonth;
                break;
            case ELuDateGranularity.day:
            default:
                this.placeholder = this._intl.placeholderDay;
                break;
        }
    }
    render() {
        if (this._focused) {
            return;
        }
        let format;
        switch (this.granularity) {
            case ELuDateGranularity.year:
                format = this._intl.formatYear;
                break;
            case ELuDateGranularity.month:
                format = this._intl.formatMonth;
                break;
            case ELuDateGranularity.day:
            default:
                format = this._intl.formatDay;
                break;
        }
        const text = this.value && this._adapter.isValid(this.value) ? this._adapter.format(this.value, format) : '';
        this._elementRef.nativeElement.value = text;
    }
    onInput(event) {
        // FIXME
        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access
        const text = event.target.value;
        const value = this.parse(text);
        this.setValue(value);
    }
    parse(text) {
        const date = this._adapter.parse(text, this.granularity);
        return date;
    }
    onFocus() {
        this._focused = true;
    }
    onBlur() {
        this._focused = false;
        this.render();
    }
    validate(control) {
        const d = control.value;
        if (!d) {
            return null;
        }
        if (!this._adapter.isValid(d)) {
            return { date: true };
        }
        if (!!this.min && this._adapter.isValid(this.min) && this._adapter.compare(this.min, d, ELuDateGranularity.day) > 0) {
            return { min: true };
        }
        if (!!this.max && this._adapter.isValid(this.max) && this._adapter.compare(this.max, d, ELuDateGranularity.day) < 0) {
            return { max: true };
        }
        return null;
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.3", ngImport: i0, type: LuDateInputDirective, deps: [{ token: i0.ChangeDetectorRef }, { token: i0.ElementRef }, { token: i0.Renderer2 }, { token: i1.ALuDateAdapter }], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "16.1.3", type: LuDateInputDirective, isStandalone: true, selector: "input[luDateInput]", inputs: { min: "min", max: "max", granularity: "granularity", placeholder: "placeholder" }, host: { listeners: { "input": "onInput($event)", "focus": "onFocus()", "blur": "onBlur()" } }, providers: [
            {
                provide: NG_VALUE_ACCESSOR,
                useExisting: forwardRef(() => LuDateInputDirective),
                multi: true,
            },
            {
                provide: NG_VALIDATORS,
                useExisting: LuDateInputDirective,
                multi: true,
            },
        ], usesInheritance: true, ngImport: i0 }); }
}
export { LuDateInputDirective };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.3", ngImport: i0, type: LuDateInputDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: 'input[luDateInput]',
                    standalone: true,
                    providers: [
                        {
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: forwardRef(() => LuDateInputDirective),
                            multi: true,
                        },
                        {
                            provide: NG_VALIDATORS,
                            useExisting: LuDateInputDirective,
                            multi: true,
                        },
                    ],
                }]
        }], ctorParameters: function () { return [{ type: i0.ChangeDetectorRef }, { type: i0.ElementRef }, { type: i0.Renderer2 }, { type: i1.ALuDateAdapter }]; }, propDecorators: { min: [{
                type: Input
            }], max: [{
                type: Input
            }], granularity: [{
                type: Input
            }], placeholder: [{
                type: Input
            }], onInput: [{
                type: HostListener,
                args: ['input', ['$event']]
            }], onFocus: [{
                type: HostListener,
                args: ['focus']
            }], onBlur: [{
                type: HostListener,
                args: ['blur']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS1pbnB1dC5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wYWNrYWdlcy9uZy9kYXRlL2lucHV0L2RhdGUtaW5wdXQuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBcUIsU0FBUyxFQUFjLFVBQVUsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFxQixNQUFNLGVBQWUsQ0FBQztBQUM3SCxPQUFPLEVBQW1CLGFBQWEsRUFBRSxpQkFBaUIsRUFBK0IsTUFBTSxnQkFBZ0IsQ0FBQztBQUNoSCxPQUFPLEVBQWtCLGtCQUFrQixFQUFFLE9BQU8sRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ25GLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUNqRCxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQzs7O0FBRXBFLE1BZ0JhLG9CQUF3QixTQUFRLFFBQTZCO0lBTXpFLElBQXNCLFdBQVcsQ0FBQyxDQUFTO1FBQzFDLElBQUksQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDLFdBQVcsR0FBRyxDQUFDLENBQUM7SUFDaEQsQ0FBQztJQUVELFlBQVksa0JBQXFDLEVBQUUsV0FBeUMsRUFBRSxTQUFvQixFQUFVLFFBQTJCO1FBQ3RKLEtBQUssQ0FBQyxrQkFBa0IsRUFBRSxXQUFXLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFEeUUsYUFBUSxHQUFSLFFBQVEsQ0FBbUI7UUFUL0ksYUFBUSxHQUFHLEtBQUssQ0FBQztRQUdoQixnQkFBVyxHQUF1QixrQkFBa0IsQ0FBQyxHQUFHLENBQUM7UUFLMUQsVUFBSyxHQUFHLE9BQU8sQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO0lBR3BELENBQUM7SUFDRCxRQUFRO1FBQ1AsUUFBUSxJQUFJLENBQUMsV0FBVyxFQUFFO1lBQ3pCLEtBQUssa0JBQWtCLENBQUMsSUFBSTtnQkFDM0IsSUFBSSxDQUFDLFdBQVcs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S0FBSztnQkFFZ0IsV0FBVztzQkFBaEMsS0FBSztnQkEwQ04sT0FBTztzQkFETixZQUFZO3VCQUFDLE9BQU8sRUFBRSxDQUFDLFFBQVEsQ0FBQztnQkFhakMsT0FBTztzQkFETixZQUFZO3VCQUFDLE9BQU87Z0JBS3JCLE1BQU07c0JBREwsWUFBWTt1QkFBQyxNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2hhbmdlRGV0ZWN0b3JSZWYsIERpcmVjdGl2ZSwgRWxlbWVudFJlZiwgZm9yd2FyZFJlZiwgSG9zdExpc3RlbmVyLCBJbnB1dCwgT25Jbml0LCBSZW5kZXJlcjIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEFic3RyYWN0Q29udHJvbCwgTkdfVkFMSURBVE9SUywgTkdfVkFMVUVfQUNDRVNTT1IsIFZhbGlkYXRpb25FcnJvcnMsIFZhbGlkYXRvciB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IEFMdURhdGVBZGFwdGVyLCBFTHVEYXRlR3JhbnVsYXJpdHksIGdldEludGwgfSBmcm9tICdAbHVjY2EtZnJvbnQvbmcvY29yZSc7XG5pbXBvcnQgeyBBTHVJbnB1dCB9IGZyb20gJ0BsdWNjYS1mcm9udC9uZy9pbnB1dCc7XG5pbXBvcnQgeyBMVV9EQVRFX0lOUFVUX1RSQU5TTEFUSU9OUyB9IGZyb20gJy4vZGF0ZS1pbnB1dC50cmFuc2xhdGUnO1xuXG5ARGlyZWN0aXZlKHtcblx0c2VsZWN0b3I6ICdpbnB1dFtsdURhdGVJbnB1dF0nLFxuXHRzdGFuZGFsb25lOiB0cnVlLFxuXHRwcm92aWRlcnM6IFtcblx0XHR7XG5cdFx0XHRwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcblx0XHRcdHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IEx1RGF0ZUlucHV0RGlyZWN0aXZlKSxcblx0XHRcdG11bHRpOiB0cnVlLFxuXHRcdH0sXG5cdFx0e1xuXHRcdFx0cHJvdmlkZTogTkdfVkFMSURBVE9SUyxcblx0XHRcdHVzZUV4aXN0aW5nOiBMdURhdGVJbnB1dERpcmVjdGl2ZSxcblx0XHRcdG11bHRpOiB0cnVlLFxuXHRcdH0sXG5cdF0sXG59KVxuZXhwb3J0IGNsYXNzIEx1RGF0ZUlucHV0RGlyZWN0aXZlPEQ+IGV4dGVuZHMgQUx1SW5wdXQ8RCwgSFRNTElucHV0RWxlbWVudD4gaW1wbGVtZW50cyBWYWxpZGF0b3IsIE9uSW5pdCB7XG5cdHByaXZhdGUgX2ZvY3VzZWQgPSBmYWxzZTtcblx0QElucHV0KCkgbWluPzogRDtcblx0QElucHV0KCkgbWF4PzogRDtcblx0QElucHV0KCkgZ3JhbnVsYXJpdHk6IEVMdURhdGVHcmFudWxhcml0eSA9IEVMdURhdGVHcmFudWxhcml0eS5kYXk7XG5cblx0QElucHV0KCkgb3ZlcnJpZGUgc2V0IHBsYWNlaG9sZGVyKHA6IHN0cmluZykge1xuXHRcdHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5wbGFjZWhvbGRlciA9IHA7XG5cdH1cblx0cHJpdmF0ZSBfaW50bCA9IGdldEludGwoTFVfREFURV9JTlBVVF9UUkFOU0xBVElPTlMpO1xuXHRjb25zdHJ1Y3RvcihfY2hhbmdlRGV0ZWN0b3JSZWY6IENoYW5nZURldGVjdG9yUmVmLCBfZWxlbWVudFJlZjogRWxlbWVudFJlZjxIVE1MSW5wdXRFbGVtZW50PiwgX3JlbmRlcmVyOiBSZW5kZXJlcjIsIHByaXZhdGUgX2FkYXB0ZXI6IEFMdURhdGVBZGFwdGVyPEQ+KSB7XG5cdFx0c3VwZXIoX2NoYW5nZURldGVjdG9yUmVmLCBfZWxlbWVudFJlZiwgX3JlbmRlcmVyKTtcblx0fVxuXHRuZ09uSW5pdCgpIHtcblx0XHRzd2l0Y2ggKHRoaXMuZ3JhbnVsYXJpdHkpIHtcblx0XHRcdGNhc2UgRUx1RGF0ZUdyYW51bGFyaXR5LnllYXI6XG5cdFx0XHRcdHRoaXMucGxhY2Vob2xkZXIgPSB0aGlzLl9pbnRsLnBsYWNlaG9sZGVyWWVhcjtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRjYXNlIEVMdURhdGVHcmFudWxhcml0eS5tb250aDpcblx0XHRcdFx0dGhpcy5wbGFjZWhvbGRlciA9IHRoaXMuX2ludGwucGxhY2Vob2xkZXJNb250aDtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRjYXNlIEVMdURhdGVHcmFudWxhcml0eS5kYXk6XG5cdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHR0aGlzLnBsYWNlaG9sZGVyID0gdGhpcy5faW50bC5wbGFjZWhvbGRlckRheTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0fVxuXHR9XG5cdHByb3RlY3RlZCByZW5kZXIoKSB7XG5cdFx0aWYgKHRoaXMuX2ZvY3VzZWQpIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0bGV0IGZvcm1hdDogc3RyaW5nO1xuXHRcdHN3aXRjaCAodGhpcy5ncmFudWxhcml0eSkge1xuXHRcdFx0Y2FzZSBFTHVEYXRlR3JhbnVsYXJpdHkueWVhcjpcblx0XHRcdFx0Zm9ybWF0ID0gdGhpcy5faW50bC5mb3JtYXRZZWFyO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdGNhc2UgRUx1RGF0ZUdyYW51bGFyaXR5Lm1vbnRoOlxuXHRcdFx0XHRmb3JtYXQgPSB0aGlzLl9pbnRsLmZvcm1hdE1vbnRoO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdGNhc2UgRUx1RGF0ZUdyYW51bGFyaXR5LmRheTpcblx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdGZvcm1hdCA9IHRoaXMuX2ludGwuZm9ybWF0RGF5O1xuXHRcdFx0XHRicmVhaztcblx0XHR9XG5cdFx0Y29uc3QgdGV4dCA9IHRoaXMudmFsdWUgJiYgdGhpcy5fYWRhcHRlci5pc1ZhbGlkKHRoaXMudmFsdWUpID8gdGhpcy5fYWRhcHRlci5mb3JtYXQodGhpcy52YWx1ZSwgZm9ybWF0KSA6ICcnO1xuXHRcdHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudC52YWx1ZSA9IHRleHQ7XG5cdH1cblx0QEhvc3RMaXN0ZW5lcignaW5wdXQnLCBbJyRldmVudCddKVxuXHRvbklucHV0KGV2ZW50KSB7XG5cdFx0Ly8gRklYTUVcblx0XHQvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVuc2FmZS1tZW1iZXItYWNjZXNzXG5cdFx0Y29uc3QgdGV4dCA9IGV2ZW50LnRhcmdldC52YWx1ZSBhcyBzdHJpbmc7XG5cdFx0Y29uc3QgdmFsdWUgPSB0aGlzLnBhcnNlKHRleHQpO1xuXHRcdHRoaXMuc2V0VmFsdWUodmFsdWUpO1xuXHR9XG5cdHByaXZhdGUgcGFyc2UodGV4dDogc3RyaW5nKTogRCB7XG5cdFx0Y29uc3QgZGF0ZSA9IHRoaXMuX2FkYXB0ZXIucGFyc2UodGV4dCwgdGhpcy5ncmFudWxhcml0eSk7XG5cdFx0cmV0dXJuIGRhdGU7XG5cdH1cblx0QEhvc3RMaXN0ZW5lcignZm9jdXMnKVxuXHRvbkZvY3VzKCkge1xuXHRcdHRoaXMuX2ZvY3VzZWQgPSB0cnVlO1xuXHR9XG5cdEBIb3N0TGlzdGVuZXIoJ2JsdXInKVxuXHRvbkJsdXIoKSB7XG5cdFx0dGhpcy5fZm9jdXNlZCA9IGZhbHNlO1xuXHRcdHRoaXMucmVuZGVyKCk7XG5cdH1cblx0dmFsaWRhdGUoY29udHJvbDogQWJzdHJhY3RDb250cm9sKTogVmFsaWRhdGlvbkVycm9ycyB8IG51bGwge1xuXHRcdGNvbnN0IGQgPSBjb250cm9sLnZhbHVlIGFzIEQ7XG5cdFx0aWYgKCFkKSB7XG5cdFx0XHRyZXR1cm4gbnVsbDtcblx0XHR9XG5cdFx0aWYgKCF0aGlzLl9hZGFwdGVyLmlzVmFsaWQoZCkpIHtcblx0XHRcdHJldHVybiB7IGRhdGU6IHRydWUgfTtcblx0XHR9XG5cdFx0aWYgKCEhdGhpcy5taW4gJiYgdGhpcy5fYWRhcHRlci5pc1ZhbGlkKHRoaXMubWluKSAmJiB0aGlzLl9hZGFwdGVyLmNvbXBhcmUodGhpcy5taW4sIGQsIEVMdURhdGVHcmFudWxhcml0eS5kYXkpID4gMCkge1xuXHRcdFx0cmV0dXJuIHsgbWluOiB0cnVlIH07XG5cdFx0fVxuXHRcdGlmICghIXRoaXMubWF4ICYmIHRoaXMuX2FkYXB0ZXIuaXNWYWxpZCh0aGlzLm1heCkgJiYgdGhpcy5fYWRhcHRlci5jb21wYXJlKHRoaXMubWF4LCBkLCBFTHVEYXRlR3JhbnVsYXJpdHkuZGF5KSA8IDApIHtcblx0XHRcdHJldHVybiB7IG1heDogdHJ1ZSB9O1xuXHRcdH1cblx0XHRyZXR1cm4gbnVsbDtcblx0fVxufVxuIl19