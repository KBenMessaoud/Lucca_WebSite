import { ChangeDetectionStrategy, Component, ContentChildren, EventEmitter, Input, Output, TemplateRef, ViewChild } from '@angular/core';
import { ALuPopoverPanel, luTransformPopover } from '@lucca-front/ng/popover';
// import { UP_ARROW, DOWN_ARROW, TAB } from '@angular/cdk/keycodes';
import { merge, Subscription } from 'rxjs';
import { debounceTime, delay, map, share, startWith, switchMap } from 'rxjs/operators';
import { ALuDropdownItem } from '../item/index';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
class LuDropdownPanelComponent extends ALuPopoverPanel {
    /**
     * This method takes classes set on the host lu-popover element and applies them on the
     * popover template that displays in the overlay container.  Otherwise, it's difficult
     * to style the containing popover from outside the component.
     * @param classes list of class names
     */
    set inputPanelClasses(classes) {
        this.panelClasses = classes;
    }
    /**
     * This method takes classes set on the host lu-popover element and applies them on the
     * popover template that displays in the overlay container. Otherwise, it's difficult
     * to style the containing popover from outside the component.
     * @param classes list of class names
     */
    set inputContentClasses(classes) {
        this.contentClasses = classes;
    }
    set vcTemplateRef(tr) {
        this.templateRef = tr;
    }
    set optionsQL(ql) {
        this._itemsQL = ql;
    }
    constructor() {
        super();
        /** Event emitted when the popover is closed. */
        // eslint-disable-next-line @angular-eslint/no-output-native
        this.close = new EventEmitter();
        // eslint-disable-next-line @angular-eslint/no-output-native
        this.open = new EventEmitter();
        this.hovered = new EventEmitter();
        // protected _highlightIndex = -1;
        // get highlightIndex() { return this._highlightIndex; }
        // set highlightIndex(i: number) {
        // 	this._highlightIndex = i;
        // 	this._applyHighlight();
        // }
        this._items = [];
        this._subs = new Subscription();
    }
    initItems() {
        const items$ = this._itemsQL.changes.pipe(startWith(this._itemsQL), map((ql) => ql.toArray()), delay(0), share());
        const itemsSub = items$.subscribe((i) => (this._items = i || []));
        this._subs.add(itemsSub);
        // this.highlightIndex = -1;
        const singleFlow$ = items$.pipe(switchMap((items) => merge(...items.map((i) => i.onSelect))), debounceTime(1));
        const itemSelectSub = singleFlow$.subscribe(() => this.close.emit());
        this._subs.add(itemSelectSub);
    }
    ngAfterViewInit() {
        this.initItems();
    }
    ngOnDestroy() {
        this.onClose();
        this.close.complete();
        this._subs.unsubscribe();
    }
    _emitCloseEvent() {
        this.close.emit();
    }
    _emitOpenEvent() {
        this.open.emit();
    }
    _emitHoveredEvent(hovered) {
        this.hovered.emit(hovered);
    }
    onOpen() {
        this.focusFirstItem();
    }
    focusFirstItem() {
        const firstItem = this._items[0];
        if (firstItem) {
            firstItem.focus();
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.3", ngImport: i0, type: LuDropdownPanelComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.1.3", type: LuDropdownPanelComponent, selector: "lu-dropdown", inputs: { inputPanelClasses: ["panel-classes", "inputPanelClasses"], inputContentClasses: ["content-classes", "inputContentClasses"] }, outputs: { close: "close", open: "open", hovered: "hovered" }, queries: [{ propertyName: "optionsQL", predicate: ALuDropdownItem, descendants: true }], viewQueries: [{ propertyName: "vcTemplateRef", first: true, predicate: TemplateRef, descendants: true, static: true }], exportAs: ["LuDropdownPanel"], usesInheritance: true, ngImport: i0, template: "<ng-template>\n\t<div\n\t\tclass=\"lu-dropdown-panel lu-popover-panel\"\n\t\t[ngClass]=\"panelClassesMap\"\n\t\t(keydown)=\"_handleKeydown($event)\"\n\t\t(click)=\"onClick()\"\n\t\t(mouseover)=\"onMouseOver()\"\n\t\t(mouseleave)=\"onMouseLeave()\"\n\t\t(mousedown)=\"onMouseDown()\"\n\t\t[attr.id]=\"panelId\"\n\t\t[attr.aria-labelledby]=\"triggerId\"\n\t\t[@transformPopover]=\"'enter'\"\n\t>\n\t\t<div class=\"lu-popover-content lu-dropdown-content\" [ngClass]=\"contentClassesMap\">\n\t\t\t<ul class=\"lu-dropdown-options\">\n\t\t\t\t<ng-content></ng-content>\n\t\t\t</ul>\n\t\t</div>\n\t</div>\n</ng-template>\n", dependencies: [{ kind: "directive", type: i1.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }], animations: [luTransformPopover], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
export { LuDropdownPanelComponent };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.3", ngImport: i0, type: LuDropdownPanelComponent, decorators: [{
            type: Component,
            args: [{ selector: 'lu-dropdown', changeDetection: ChangeDetectionStrategy.OnPush, animations: [luTransformPopover], exportAs: 'LuDropdownPanel', template: "<ng-template>\n\t<div\n\t\tclass=\"lu-dropdown-panel lu-popover-panel\"\n\t\t[ngClass]=\"panelClassesMap\"\n\t\t(keydown)=\"_handleKeydown($event)\"\n\t\t(click)=\"onClick()\"\n\t\t(mouseover)=\"onMouseOver()\"\n\t\t(mouseleave)=\"onMouseLeave()\"\n\t\t(mousedown)=\"onMouseDown()\"\n\t\t[attr.id]=\"panelId\"\n\t\t[attr.aria-labelledby]=\"triggerId\"\n\t\t[@transformPopover]=\"'enter'\"\n\t>\n\t\t<div class=\"lu-popover-content lu-dropdown-content\" [ngClass]=\"contentClassesMap\">\n\t\t\t<ul class=\"lu-dropdown-options\">\n\t\t\t\t<ng-content></ng-content>\n\t\t\t</ul>\n\t\t</div>\n\t</div>\n</ng-template>\n" }]
        }], ctorParameters: function () { return []; }, propDecorators: { inputPanelClasses: [{
                type: Input,
                args: ['panel-classes']
            }], inputContentClasses: [{
                type: Input,
                args: ['content-classes']
            }], close: [{
                type: Output
            }], open: [{
                type: Output
            }], hovered: [{
                type: Output
            }], vcTemplateRef: [{
                type: ViewChild,
                args: [TemplateRef, { static: true }]
            }], optionsQL: [{
                type: ContentChildren,
                args: [ALuDropdownItem, { descendants: true }]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJvcGRvd24tcGFuZWwuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcGFja2FnZXMvbmcvZHJvcGRvd24vcGFuZWwvZHJvcGRvd24tcGFuZWwuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vcGFja2FnZXMvbmcvZHJvcGRvd24vcGFuZWwvZHJvcGRvd24tcGFuZWwuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFpQix1QkFBdUIsRUFBRSxTQUFTLEVBQUUsZUFBZSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQWEsTUFBTSxFQUFhLFdBQVcsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDOUssT0FBTyxFQUFFLGVBQWUsRUFBbUIsa0JBQWtCLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUMvRixxRUFBcUU7QUFDckUsT0FBTyxFQUFFLEtBQUssRUFBYyxZQUFZLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDdkQsT0FBTyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDdkYsT0FBTyxFQUFFLGVBQWUsRUFBbUIsTUFBTSxlQUFlLENBQUM7OztBQUVqRSxNQU9hLHdCQUF5QixTQUFRLGVBQWU7SUFDNUQ7Ozs7O09BS0c7SUFDSCxJQUNJLGlCQUFpQixDQUFDLE9BQWU7UUFDcEMsSUFBSSxDQUFDLFlBQVksR0FBRyxPQUFPLENBQUM7SUFDN0IsQ0FBQztJQUNEOzs7OztPQUtHO0lBQ0gsSUFDSSxtQkFBbUIsQ0FBQyxPQUFlO1FBQ3RDLElBQUksQ0FBQyxjQUFjLEdBQUcsT0FBTyxDQUFDO0lBQy9CLENBQUM7SUFTRCxJQUNJLGFBQWEsQ0FBQyxFQUF3QjtRQUN6QyxJQUFJLENBQUMsV0FBVyxHQUFHLEVBQUUsQ0FBQztJQUN2QixDQUFDO0lBVUQs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RFRhLENBQUMsa0JBQWtCLENBQUM7O1NBR3BCLHdCQUF3QjsyRkFBeEIsd0JBQXdCO2tCQVBwQyxTQUFTOytCQUNDLGFBQWEsbUJBRU4sdUJBQXVCLENBQUMsTUFBTSxjQUNuQyxDQUFDLGtCQUFrQixDQUFDLFlBQ3RCLGlCQUFpQjswRUFVdkIsaUJBQWlCO3NCQURwQixLQUFLO3VCQUFDLGVBQWU7Z0JBV2xCLG1CQUFtQjtzQkFEdEIsS0FBSzt1QkFBQyxpQkFBaUI7Z0JBT0wsS0FBSztzQkFBdkIsTUFBTTtnQkFFWSxJQUFJO3NCQUF0QixNQUFNO2dCQUNZLE9BQU87c0JBQXpCLE1BQU07Z0JBR0gsYUFBYTtzQkFEaEIsU0FBUzt1QkFBQyxXQUFXLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFO2dCQWFxQixTQUFTO3NCQUFyRSxlQUFlO3VCQUFDLGVBQWUsRUFBRSxFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBZnRlclZpZXdJbml0LCBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ29tcG9uZW50LCBDb250ZW50Q2hpbGRyZW4sIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uRGVzdHJveSwgT3V0cHV0LCBRdWVyeUxpc3QsIFRlbXBsYXRlUmVmLCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEFMdVBvcG92ZXJQYW5lbCwgSUx1UG9wb3ZlclBhbmVsLCBsdVRyYW5zZm9ybVBvcG92ZXIgfSBmcm9tICdAbHVjY2EtZnJvbnQvbmcvcG9wb3Zlcic7XG4vLyBpbXBvcnQgeyBVUF9BUlJPVywgRE9XTl9BUlJPVywgVEFCIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2tleWNvZGVzJztcbmltcG9ydCB7IG1lcmdlLCBPYnNlcnZhYmxlLCBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGRlYm91bmNlVGltZSwgZGVsYXksIG1hcCwgc2hhcmUsIHN0YXJ0V2l0aCwgc3dpdGNoTWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgQUx1RHJvcGRvd25JdGVtLCBJTHVEcm9wZG93bkl0ZW0gfSBmcm9tICcuLi9pdGVtL2luZGV4JztcblxuQENvbXBvbmVudCh7XG5cdHNlbGVjdG9yOiAnbHUtZHJvcGRvd24nLFxuXHR0ZW1wbGF0ZVVybDogJy4vZHJvcGRvd24tcGFuZWwuY29tcG9uZW50Lmh0bWwnLFxuXHRjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcblx0YW5pbWF0aW9uczogW2x1VHJhbnNmb3JtUG9wb3Zlcl0sXG5cdGV4cG9ydEFzOiAnTHVEcm9wZG93blBhbmVsJyxcbn0pXG5leHBvcnQgY2xhc3MgTHVEcm9wZG93blBhbmVsQ29tcG9uZW50IGV4dGVuZHMgQUx1UG9wb3ZlclBhbmVsIGltcGxlbWVudHMgSUx1UG9wb3ZlclBhbmVsLCBPbkRlc3Ryb3ksIEFmdGVyVmlld0luaXQge1xuXHQvKipcblx0ICogVGhpcyBtZXRob2QgdGFrZXMgY2xhc3NlcyBzZXQgb24gdGhlIGhvc3QgbHUtcG9wb3ZlciBlbGVtZW50IGFuZCBhcHBsaWVzIHRoZW0gb24gdGhlXG5cdCAqIHBvcG92ZXIgdGVtcGxhdGUgdGhhdCBkaXNwbGF5cyBpbiB0aGUgb3ZlcmxheSBjb250YWluZXIuICBPdGhlcndpc2UsIGl0J3MgZGlmZmljdWx0XG5cdCAqIHRvIHN0eWxlIHRoZSBjb250YWluaW5nIHBvcG92ZXIgZnJvbSBvdXRzaWRlIHRoZSBjb21wb25lbnQuXG5cdCAqIEBwYXJhbSBjbGFzc2VzIGxpc3Qgb2YgY2xhc3MgbmFtZXNcblx0ICovXG5cdEBJbnB1dCgncGFuZWwtY2xhc3NlcycpXG5cdHNldCBpbnB1dFBhbmVsQ2xhc3NlcyhjbGFzc2VzOiBzdHJpbmcpIHtcblx0XHR0aGlzLnBhbmVsQ2xhc3NlcyA9IGNsYXNzZXM7XG5cdH1cblx0LyoqXG5cdCAqIFRoaXMgbWV0aG9kIHRha2VzIGNsYXNzZXMgc2V0IG9uIHRoZSBob3N0IGx1LXBvcG92ZXIgZWxlbWVudCBhbmQgYXBwbGllcyB0aGVtIG9uIHRoZVxuXHQgKiBwb3BvdmVyIHRlbXBsYXRlIHRoYXQgZGlzcGxheXMgaW4gdGhlIG92ZXJsYXkgY29udGFpbmVyLiBPdGhlcndpc2UsIGl0J3MgZGlmZmljdWx0XG5cdCAqIHRvIHN0eWxlIHRoZSBjb250YWluaW5nIHBvcG92ZXIgZnJvbSBvdXRzaWRlIHRoZSBjb21wb25lbnQuXG5cdCAqIEBwYXJhbSBjbGFzc2VzIGxpc3Qgb2YgY2xhc3MgbmFtZXNcblx0ICovXG5cdEBJbnB1dCgnY29udGVudC1jbGFzc2VzJylcblx0c2V0IGlucHV0Q29udGVudENsYXNzZXMoY2xhc3Nlczogc3RyaW5nKSB7XG5cdFx0dGhpcy5jb250ZW50Q2xhc3NlcyA9IGNsYXNzZXM7XG5cdH1cblxuXHQvKiogRXZlbnQgZW1pdHRlZCB3aGVuIHRoZSBwb3BvdmVyIGlzIGNsb3NlZC4gKi9cblx0Ly8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEBhbmd1bGFyLWVzbGludC9uby1vdXRwdXQtbmF0aXZlXG5cdEBPdXRwdXQoKSBvdmVycmlkZSBjbG9zZSA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcblx0Ly8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEBhbmd1bGFyLWVzbGludC9uby1vdXRwdXQtbmF0aXZlXG5cdEBPdXRwdXQoKSBvdmVycmlkZSBvcGVuID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuXHRAT3V0cHV0KCkgb3ZlcnJpZGUgaG92ZXJlZCA9IG5ldyBFdmVudEVtaXR0ZXI8Ym9vbGVhbj4oKTtcblxuXHRAVmlld0NoaWxkKFRlbXBsYXRlUmVmLCB7IHN0YXRpYzogdHJ1ZSB9KVxuXHRzZXQgdmNUZW1wbGF0ZVJlZih0cjogVGVtcGxhdGVSZWY8dW5rbm93bj4pIHtcblx0XHR0aGlzLnRlbXBsYXRlUmVmID0gdHI7XG5cdH1cblxuXHQvLyBwcm90ZWN0ZWQgX2hpZ2hsaWdodEluZGV4ID0gLTE7XG5cdC8vIGdldCBoaWdobGlnaHRJbmRleCgpIHsgcmV0dXJuIHRoaXMuX2hpZ2hsaWdodEluZGV4OyB9XG5cdC8vIHNldCBoaWdobGlnaHRJbmRleChpOiBudW1iZXIpIHtcblx0Ly8gXHR0aGlzLl9oaWdobGlnaHRJbmRleCA9IGk7XG5cdC8vIFx0dGhpcy5fYXBwbHlIaWdobGlnaHQoKTtcblx0Ly8gfVxuXHRwcm90ZWN0ZWQgX2l0ZW1zOiBJTHVEcm9wZG93bkl0ZW1bXSA9IFtdO1xuXHRwcm90ZWN0ZWQgX2l0ZW1zUUw6IFF1ZXJ5TGlzdDxJTHVEcm9wZG93bkl0ZW0+O1xuXHRAQ29udGVudENoaWxkcmVuKEFMdURyb3Bkb3duSXRlbSwgeyBkZXNjZW5kYW50czogdHJ1ZSB9KSBzZXQgb3B0aW9uc1FMKHFsOiBRdWVyeUxpc3Q8SUx1RHJvcGRvd25JdGVtPikge1xuXHRcdHRoaXMuX2l0ZW1zUUwgPSBxbDtcblx0fVxuXG5cdHByaXZhdGUgX3N1YnMgPSBuZXcgU3Vic2NyaXB0aW9uKCk7XG5cblx0Y29uc3RydWN0b3IoKSB7XG5cdFx0c3VwZXIoKTtcblx0fVxuXHRwcm90ZWN0ZWQgaW5pdEl0ZW1zKCkge1xuXHRcdGNvbnN0IGl0ZW1zJCA9IHRoaXMuX2l0ZW1zUUwuY2hhbmdlcy5waXBlKFxuXHRcdFx0c3RhcnRXaXRoKHRoaXMuX2l0ZW1zUUwpLFxuXHRcdFx0bWFwPFF1ZXJ5TGlzdDxJTHVEcm9wZG93bkl0ZW0+LCBJTHVEcm9wZG93bkl0ZW1bXT4oKHFsKSA9PiBxbC50b0FycmF5KCkpLFxuXHRcdFx0ZGVsYXkoMCksXG5cdFx0XHRzaGFyZSgpLFxuXHRcdCk7XG5cdFx0Y29uc3QgaXRlbXNTdWIgPSBpdGVtcyQuc3Vic2NyaWJlKChpKSA9PiAodGhpcy5faXRlbXMgPSBpIHx8IFtdKSk7XG5cdFx0dGhpcy5fc3Vicy5hZGQoaXRlbXNTdWIpO1xuXHRcdC8vIHRoaXMuaGlnaGxpZ2h0SW5kZXggPSAtMTtcblxuXHRcdGNvbnN0IHNpbmdsZUZsb3ckOiBPYnNlcnZhYmxlPGJvb2xlYW4+ID0gaXRlbXMkLnBpcGUoXG5cdFx0XHRzd2l0Y2hNYXAoKGl0ZW1zKSA9PiBtZXJnZSguLi5pdGVtcy5tYXAoKGkpID0+IGkub25TZWxlY3QpKSksXG5cdFx0XHRkZWJvdW5jZVRpbWUoMSksXG5cdFx0KTtcblxuXHRcdGNvbnN0IGl0ZW1TZWxlY3RTdWIgPSBzaW5nbGVGbG93JC5zdWJzY3JpYmUoKCkgPT4gdGhpcy5jbG9zZS5lbWl0KCkpO1xuXHRcdHRoaXMuX3N1YnMuYWRkKGl0ZW1TZWxlY3RTdWIpO1xuXHR9XG5cblx0bmdBZnRlclZpZXdJbml0KCkge1xuXHRcdHRoaXMuaW5pdEl0ZW1zKCk7XG5cdH1cblxuXHRuZ09uRGVzdHJveSgpIHtcblx0XHR0aGlzLm9uQ2xvc2UoKTtcblx0XHR0aGlzLmNsb3NlLmNvbXBsZXRlKCk7XG5cdFx0dGhpcy5fc3Vicy51bnN1YnNjcmliZSgpO1xuXHR9XG5cblx0X2VtaXRDbG9zZUV2ZW50KCk6IHZvaWQge1xuXHRcdHRoaXMuY2xvc2UuZW1pdCgpO1xuXHR9XG5cblx0X2VtaXRPcGVuRXZlbnQoKTogdm9pZCB7XG5cdFx0dGhpcy5vcGVuLmVtaXQoKTtcblx0fVxuXG5cdF9lbWl0SG92ZXJlZEV2ZW50KGhvdmVyZWQ6IGJvb2xlYW4pOiB2b2lkIHtcblx0XHR0aGlzLmhvdmVyZWQuZW1pdChob3ZlcmVkKTtcblx0fVxuXG5cdG92ZXJyaWRlIG9uT3BlbigpIHtcblx0XHR0aGlzLmZvY3VzRmlyc3RJdGVtKCk7XG5cdH1cblxuXHRwcml2YXRlIGZvY3VzRmlyc3RJdGVtKCkge1xuXHRcdGNvbnN0IGZpcnN0SXRlbSA9IHRoaXMuX2l0ZW1zWzBdO1xuXHRcdGlmIChmaXJzdEl0ZW0pIHtcblx0XHRcdGZpcnN0SXRlbS5mb2N1cygpO1xuXHRcdH1cblx0fVxuXG5cdC8vIGtleWRvd25cblx0Ly8gX2hhbmRsZUtleWRvd24oZXZlbnQ6IEtleWJvYXJkRXZlbnQpIHtcblx0Ly8gXHRzdXBlci5faGFuZGxlS2V5ZG93bihldmVudCk7XG5cdC8vIHN3aXRjaCAoZXZlbnQua2V5Q29kZSkge1xuXHQvLyBcdGNhc2UgVVBfQVJST1c6XG5cdC8vIFx0XHR0aGlzLl9kZWNySGlnaGxpZ2h0KCk7XG5cdC8vIFx0XHRpZiAoIXRoaXMuX2hpZ2hsaWdodE91dE9mQm91bmRzKCkpIHtcblx0Ly8gXHRcdFx0ZXZlbnQucHJldmVudERlZmF1bHQoKTtcblx0Ly8gXHRcdFx0ZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdC8vIFx0XHR9XG5cdC8vIFx0XHRicmVhaztcblx0Ly8gXHRjYXNlIERPV05fQVJST1c6XG5cdC8vIFx0XHR0aGlzLl9pbmNySGlnaGxpZ2h0KCk7XG5cdC8vIFx0XHRpZiAoIXRoaXMuX2hpZ2hsaWdodE91dE9mQm91bmRzKCkpIHtcblx0Ly8gXHRcdFx0ZXZlbnQucHJldmVudERlZmF1bHQoKTtcblx0Ly8gXHRcdFx0ZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdC8vIFx0XHR9XG5cdC8vIFx0XHRicmVhaztcblx0Ly8gXHRjYXNlIFRBQjpcblx0Ly8gXHRcdGlmIChldmVudC5zaGlmdEtleSkge1xuXHQvLyBcdFx0XHR0aGlzLl9kZWNySGlnaGxpZ2h0KCk7XG5cdC8vIFx0XHR9IGVsc2Uge1xuXHQvLyBcdFx0XHR0aGlzLl9pbmNySGlnaGxpZ2h0KCk7XG5cdC8vIFx0XHR9XG5cdC8vIFx0XHRpZiAoIXRoaXMuX2hpZ2hsaWdodE91dE9mQm91bmRzKCkpIHtcblx0Ly8gXHRcdFx0ZXZlbnQucHJldmVudERlZmF1bHQoKTtcblx0Ly8gXHRcdFx0ZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdC8vIFx0XHR9XG5cdC8vIFx0XHRicmVhaztcblx0Ly8gfVxuXHQvLyB9XG5cdC8vIHByb3RlY3RlZCBfaW5jckhpZ2hsaWdodCgpIHtcblx0Ly8gXHR0aGlzLmhpZ2hsaWdodEluZGV4Kys7XG5cdC8vIH1cblx0Ly8gcHJvdGVjdGVkIF9kZWNySGlnaGxpZ2h0KCkge1xuXHQvLyBcdHRoaXMuaGlnaGxpZ2h0SW5kZXgtLTtcblx0Ly8gfVxuXHQvLyBwcm90ZWN0ZWQgX2hpZ2hsaWdodE91dE9mQm91bmRzKCk6IGJvb2xlYW4ge1xuXHQvLyBcdGNvbnN0IGl0ZW1zQ291bnQgPSB0aGlzLl9pdGVtcy5sZW5ndGg7XG5cdC8vIFx0cmV0dXJuIHRoaXMuaGlnaGxpZ2h0SW5kZXggPCAwIHx8IHRoaXMuaGlnaGxpZ2h0SW5kZXggPj0gaXRlbXNDb3VudDtcblx0Ly8gfVxuXHQvLyBwcm90ZWN0ZWQgX2FwcGx5SGlnaGxpZ2h0KCkge1xuXG5cdC8vIFx0Y29uc3QgaGlnaGxpZ2h0ZWRJdGVtID0gdGhpcy5faXRlbXNbdGhpcy5oaWdobGlnaHRJbmRleF07XG5cdC8vIFx0aWYgKGhpZ2hsaWdodGVkSXRlbSkge1xuXHQvLyBcdFx0aGlnaGxpZ2h0ZWRJdGVtLmZvY3VzKCk7XG5cdC8vIFx0fVxuXHQvLyB9XG59XG4iLCI8bmctdGVtcGxhdGU+XG5cdDxkaXZcblx0XHRjbGFzcz1cImx1LWRyb3Bkb3duLXBhbmVsIGx1LXBvcG92ZXItcGFuZWxcIlxuXHRcdFtuZ0NsYXNzXT1cInBhbmVsQ2xhc3Nlc01hcFwiXG5cdFx0KGtleWRvd24pPVwiX2hhbmRsZUtleWRvd24oJGV2ZW50KVwiXG5cdFx0KGNsaWNrKT1cIm9uQ2xpY2soKVwiXG5cdFx0KG1vdXNlb3Zlcik9XCJvbk1vdXNlT3ZlcigpXCJcblx0XHQobW91c2VsZWF2ZSk9XCJvbk1vdXNlTGVhdmUoKVwiXG5cdFx0KG1vdXNlZG93bik9XCJvbk1vdXNlRG93bigpXCJcblx0XHRbYXR0ci5pZF09XCJwYW5lbElkXCJcblx0XHRbYXR0ci5hcmlhLWxhYmVsbGVkYnldPVwidHJpZ2dlcklkXCJcblx0XHRbQHRyYW5zZm9ybVBvcG92ZXJdPVwiJ2VudGVyJ1wiXG5cdD5cblx0XHQ8ZGl2IGNsYXNzPVwibHUtcG9wb3Zlci1jb250ZW50IGx1LWRyb3Bkb3duLWNvbnRlbnRcIiBbbmdDbGFzc109XCJjb250ZW50Q2xhc3Nlc01hcFwiPlxuXHRcdFx0PHVsIGNsYXNzPVwibHUtZHJvcGRvd24tb3B0aW9uc1wiPlxuXHRcdFx0XHQ8bmctY29udGVudD48L25nLWNvbnRlbnQ+XG5cdFx0XHQ8L3VsPlxuXHRcdDwvZGl2PlxuXHQ8L2Rpdj5cbjwvbmctdGVtcGxhdGU+XG4iXX0=