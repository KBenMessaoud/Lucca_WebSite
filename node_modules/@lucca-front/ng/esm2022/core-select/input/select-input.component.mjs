/* eslint-disable @angular-eslint/no-output-on-prefix */
import { OverlayContainer } from '@angular/cdk/overlay';
import { ChangeDetectorRef, Directive, EventEmitter, HostBinding, HostListener, Input, Output, inject } from '@angular/core';
import { BehaviorSubject, ReplaySubject, Subject } from 'rxjs';
import { LuSimpleSelectDefaultOptionComponent } from '../option';
import { SELECT_LABEL, SELECT_LABEL_ID } from '../select.model';
import * as i0 from "@angular/core";
class ALuSelectInputComponent {
    constructor() {
        this.tabindex = 0;
        this.placeholder = '';
        this.clearable = false;
        this.disabled = false;
        this.isPanelOpen$ = new BehaviorSubject(false);
        this.role = 'combobox';
        this.overlayConfig = {
            hasBackdrop: true,
            backdropClass: 'cdk-overlay-transparent-backdrop',
        };
        this.optionComparer = (option1, option2) => JSON.stringify(option1) === JSON.stringify(option2);
        this.optionTpl = LuSimpleSelectDefaultOptionComponent;
        this.clueChange = new EventEmitter();
        this.nextPage = new EventEmitter();
        this.previousPage = new EventEmitter();
        this.options$ = new ReplaySubject(1);
        this.loading$ = new ReplaySubject(1);
        this.clue = null;
        this.destroyed$ = new Subject();
        this.changeDetectorRef = inject(ChangeDetectorRef);
        this.overlayContainerRef = inject(OverlayContainer).getContainerElement();
        this.label = inject(SELECT_LABEL);
        this.labelId = inject(SELECT_LABEL_ID);
    }
    get searchable() {
        return this.clueChange.observed;
    }
    get isFilledClass() {
        return this.hasValue;
    }
    get isPanelOpen() {
        return this.isPanelOpen$.value;
    }
    get ariaControls() {
        return this.overlayContainerRef.id;
    }
    set loading(value) {
        this.loading$.next(value);
    }
    set options(options) {
        this.options$.next(options);
    }
    get value() {
        return this._value;
    }
    set value(value) {
        this._value = value;
        this.changeDetectorRef.markForCheck();
    }
    get panelRef() {
        return this._panelRef;
    }
    onKeydown($event) {
        if (!this.isPanelOpen) {
            this.openPanel();
            $event.stopPropagation();
            $event.preventDefault();
        }
    }
    registerOnChange(onChange) {
        this.onChange = onChange;
    }
    registerOnTouched(onTouched) {
        this.onTouched = onTouched;
    }
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
    }
    ngOnDestroy() {
        this.closePanel();
        this.destroyed$.next();
        this.destroyed$.complete();
    }
    ngOnInit() {
        if (this.label) {
            this.label.id = this.labelId;
        }
    }
    clearValue(event) {
        event.stopPropagation();
        this.updateValue(null);
    }
    openPanel() {
        if (this.isPanelOpen || this.disabled) {
            return;
        }
        this.isPanelOpen$.next(true);
        this._panelRef = this.buildPanelRef();
        this.bindInputToPanelRefEvents();
    }
    bindInputToPanelRefEvents() {
        if (!this.panelRef) {
            return;
        }
        this.panelRef.valueChanged.subscribe((value) => this.updateValue(value));
        this.panelRef.nextPage.subscribe(() => this.nextPage.emit());
        this.panelRef.previousPage.subscribe(() => this.previousPage.emit());
        this.panelRef.clueChanged.subscribe((clue) => {
            this.clueChange.emit(clue);
            this.clue = clue;
        });
        this.panelRef.activeOptionIdChanged.subscribe((optionId) => {
            this.activeDescendant = optionId;
            this.changeDetectorRef.markForCheck();
        });
        this.panelRef.closed.subscribe(() => this.closePanel());
    }
    closePanel() {
        if (!this.isPanelOpen) {
            return;
        }
        this.onTouched?.();
        this.isPanelOpen$.next(false);
        this.panelRef.close();
        this._panelRef = undefined;
    }
    writeValue(value) {
        this.value = value;
    }
    updateValue(value) {
        this.value = value;
        this.onChange?.(value);
        this.onTouched?.();
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.3", ngImport: i0, type: ALuSelectInputComponent, deps: [], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "16.1.3", type: ALuSelectInputComponent, inputs: { placeholder: "placeholder", clearable: "clearable", disabled: "disabled", overlayConfig: "overlayConfig", loading: "loading", options: "options", optionComparer: "optionComparer", optionTpl: "optionTpl", valueTpl: "valueTpl" }, outputs: { clueChange: "clueChange", nextPage: "nextPage", previousPage: "previousPage" }, host: { listeners: { "keydown.space": "onKeydown($event)", "keydown.enter": "onKeydown($event)", "keydown.arrowDown": "onKeydown($event)", "click": "onKeydown($event)" }, properties: { "tabindex": "this.tabindex", "class.is-clearable": "this.clearable", "class.is-disabled": "this.disabled", "class.is-filled": "this.isFilledClass", "class.is-focused": "this.isPanelOpen", "attr.aria-expanded": "this.isPanelOpen", "attr.role": "this.role", "attr.aria-activedescendant": "this.activeDescendant", "attr.aria-controls": "this.ariaControls" } }, ngImport: i0 }); }
}
export { ALuSelectInputComponent };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.3", ngImport: i0, type: ALuSelectInputComponent, decorators: [{
            type: Directive
        }], propDecorators: { tabindex: [{
                type: HostBinding,
                args: ['tabindex']
            }], placeholder: [{
                type: Input
            }], clearable: [{
                type: Input
            }, {
                type: HostBinding,
                args: ['class.is-clearable']
            }], disabled: [{
                type: Input
            }, {
                type: HostBinding,
                args: ['class.is-disabled']
            }], isFilledClass: [{
                type: HostBinding,
                args: ['class.is-filled']
            }], isPanelOpen: [{
                type: HostBinding,
                args: ['class.is-focused']
            }, {
                type: HostBinding,
                args: ['attr.aria-expanded']
            }], role: [{
                type: HostBinding,
                args: ['attr.role']
            }], activeDescendant: [{
                type: HostBinding,
                args: ['attr.aria-activedescendant']
            }], ariaControls: [{
                type: HostBinding,
                args: ['attr.aria-controls']
            }], overlayConfig: [{
                type: Input
            }], loading: [{
                type: Input
            }], options: [{
                type: Input
            }], optionComparer: [{
                type: Input
            }], optionTpl: [{
                type: Input
            }], valueTpl: [{
                type: Input
            }], clueChange: [{
                type: Output
            }], nextPage: [{
                type: Output
            }], previousPage: [{
                type: Output
            }], onKeydown: [{
                type: HostListener,
                args: ['keydown.space', ['$event']]
            }, {
                type: HostListener,
                args: ['keydown.enter', ['$event']]
            }, {
                type: HostListener,
                args: ['keydown.arrowDown', ['$event']]
            }, {
                type: HostListener,
                args: ['click', ['$event']]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VsZWN0LWlucHV0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL25nL2NvcmUtc2VsZWN0L2lucHV0L3NlbGVjdC1pbnB1dC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsd0RBQXdEO0FBQ3hELE9BQU8sRUFBaUIsZ0JBQWdCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUN2RSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxXQUFXLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBcUIsTUFBTSxFQUFxQixNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbkssT0FBTyxFQUFFLGVBQWUsRUFBRSxhQUFhLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQy9ELE9BQU8sRUFBRSxvQ0FBb0MsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUVqRSxPQUFPLEVBQW1CLFlBQVksRUFBRSxlQUFlLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQzs7QUFFakYsTUFDc0IsdUJBQXVCO0lBRDdDO1FBRTBCLGFBQVEsR0FBRyxDQUFDLENBQUM7UUFFN0IsZ0JBQVcsR0FBRyxFQUFFLENBQUM7UUFJMUIsY0FBUyxHQUFHLEtBQUssQ0FBQztRQVFsQixhQUFRLEdBQUcsS0FBSyxDQUFDO1FBY1YsaUJBQVksR0FBRyxJQUFJLGVBQWUsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUcxQyxTQUFJLEdBQUcsVUFBVSxDQUFDO1FBV3pCLGtCQUFhLEdBQW1CO1lBQy9CLFdBQVcsRUFBRSxJQUFJO1lBQ2pCLGFBQWEsRUFBRSxrQ0FBa0M7U0FDakQsQ0FBQztRQVVPLG1CQUFjLEdBQW9ELENBQUMsT0FBTyxFQUFFLE9BQU8sRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsS0FBSyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFD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YUFBYTtzQkFEMUIsV0FBVzt1QkFBQyxpQkFBaUI7Z0JBU25CLFdBQVc7c0JBRnJCLFdBQVc7dUJBQUMsa0JBQWtCOztzQkFDOUIsV0FBVzt1QkFBQyxvQkFBb0I7Z0JBTzFCLElBQUk7c0JBRFYsV0FBVzt1QkFBQyxXQUFXO2dCQUlqQixnQkFBZ0I7c0JBRHRCLFdBQVc7dUJBQUMsNEJBQTRCO2dCQUlyQyxZQUFZO3NCQURmLFdBQVc7dUJBQUMsb0JBQW9CO2dCQU1qQyxhQUFhO3NCQURaLEtBQUs7Z0JBTU8sT0FBTztzQkFBbkIsS0FBSztnQkFJTyxPQUFPO3NCQUFuQixLQUFLO2dCQUlHLGNBQWM7c0JBQXRCLEtBQUs7Z0JBQ0csU0FBUztzQkFBakIsS0FBSztnQkFDRyxRQUFRO3NCQUFoQixLQUFLO2dCQUVJLFVBQVU7c0JBQW5CLE1BQU07Z0JBQ0csUUFBUTtzQkFBakIsTUFBTTtnQkFDRyxZQUFZO3NCQUFyQixNQUFNO2dCQWdDUCxTQUFTO3NCQUpSLFlBQVk7dUJBQUMsZUFBZSxFQUFFLENBQUMsUUFBUSxDQUFDOztzQkFDeEMsWUFBWTt1QkFBQyxlQUFlLEVBQUUsQ0FBQyxRQUFRLENBQUM7O3NCQUN4QyxZQUFZO3VCQUFDLG1CQUFtQixFQUFFLENBQUMsUUFBUSxDQUFDOztzQkFDNUMsWUFBWTt1QkFBQyxPQUFPLEVBQUUsQ0FBQyxRQUFRLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBAYW5ndWxhci1lc2xpbnQvbm8tb3V0cHV0LW9uLXByZWZpeCAqL1xuaW1wb3J0IHsgT3ZlcmxheUNvbmZpZywgT3ZlcmxheUNvbnRhaW5lciB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9vdmVybGF5JztcbmltcG9ydCB7IENoYW5nZURldGVjdG9yUmVmLCBEaXJlY3RpdmUsIEV2ZW50RW1pdHRlciwgSG9zdEJpbmRpbmcsIEhvc3RMaXN0ZW5lciwgSW5wdXQsIE9uRGVzdHJveSwgT25Jbml0LCBPdXRwdXQsIFRlbXBsYXRlUmVmLCBUeXBlLCBpbmplY3QgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCwgUmVwbGF5U3ViamVjdCwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgTHVTaW1wbGVTZWxlY3REZWZhdWx0T3B0aW9uQ29tcG9uZW50IH0gZnJvbSAnLi4vb3B0aW9uJztcbmltcG9ydCB7IEx1U2VsZWN0UGFuZWxSZWYgfSBmcm9tICcuLi9wYW5lbCc7XG5pbXBvcnQgeyBMdU9wdGlvbkNvbnRleHQsIFNFTEVDVF9MQUJFTCwgU0VMRUNUX0xBQkVMX0lEIH0gZnJvbSAnLi4vc2VsZWN0Lm1vZGVsJztcblxuQERpcmVjdGl2ZSgpXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQUx1U2VsZWN0SW5wdXRDb21wb25lbnQ8VE9wdGlvbiwgVFZhbHVlPiBpbXBsZW1lbnRzIE9uRGVzdHJveSwgT25Jbml0IHtcblx0QEhvc3RCaW5kaW5nKCd0YWJpbmRleCcpIHRhYmluZGV4ID0gMDtcblxuXHRASW5wdXQoKSBwbGFjZWhvbGRlciA9ICcnO1xuXG5cdEBJbnB1dCgpXG5cdEBIb3N0QmluZGluZygnY2xhc3MuaXMtY2xlYXJhYmxlJylcblx0Y2xlYXJhYmxlID0gZmFsc2U7XG5cblx0Z2V0IHNlYXJjaGFibGUoKTogYm9vbGVhbiB7XG5cdFx0cmV0dXJuIHRoaXMuY2x1ZUNoYW5nZS5vYnNlcnZlZDtcblx0fVxuXG5cdEBJbnB1dCgpXG5cdEBIb3N0QmluZGluZygnY2xhc3MuaXMtZGlzYWJsZWQnKVxuXHRkaXNhYmxlZCA9IGZhbHNlO1xuXG5cdEBIb3N0QmluZGluZygnY2xhc3MuaXMtZmlsbGVkJylcblx0cHJvdGVjdGVkIGdldCBpc0ZpbGxlZENsYXNzKCk6IGJvb2xlYW4ge1xuXHRcdHJldHVybiB0aGlzLmhhc1ZhbHVlO1xuXHR9XG5cblx0cHJvdGVjdGVkIGFic3RyYWN0IHJlYWRvbmx5IGhhc1ZhbHVlOiBib29sZWFuO1xuXG5cdEBIb3N0QmluZGluZygnY2xhc3MuaXMtZm9jdXNlZCcpXG5cdEBIb3N0QmluZGluZygnYXR0ci5hcmlhLWV4cGFuZGVkJylcblx0cHVibGljIGdldCBpc1BhbmVsT3BlbigpOiBib29sZWFuIHtcblx0XHRyZXR1cm4gdGhpcy5pc1BhbmVsT3BlbiQudmFsdWU7XG5cdH1cblx0cHVibGljIGlzUGFuZWxPcGVuJCA9IG5ldyBCZWhhdmlvclN1YmplY3QoZmFsc2UpO1xuXG5cdEBIb3N0QmluZGluZygnYXR0ci5yb2xlJylcblx0cHVibGljIHJvbGUgPSAnY29tYm9ib3gnO1xuXG5cdEBIb3N0QmluZGluZygnYXR0ci5hcmlhLWFjdGl2ZWRlc2NlbmRhbnQnKVxuXHRwdWJsaWMgYWN0aXZlRGVzY2VuZGFudDogc3RyaW5nIHwgdW5kZWZpbmVkO1xuXG5cdEBIb3N0QmluZGluZygnYXR0ci5hcmlhLWNvbnRyb2xzJylcblx0Z2V0IGFyaWFDb250cm9scygpOiBzdHJpbmcge1xuXHRcdHJldHVybiB0aGlzLm92ZXJsYXlDb250YWluZXJSZWYuaWQ7XG5cdH1cblxuXHRASW5wdXQoKVxuXHRvdmVybGF5Q29uZmlnPzogT3ZlcmxheUNvbmZpZyA9IHtcblx0XHRoYXNCYWNrZHJvcDogdHJ1ZSxcblx0XHRiYWNrZHJvcENsYXNzOiAnY2RrLW92ZXJsYXktdHJhbnNwYXJlbnQtYmFja2Ryb3AnLFxuXHR9O1xuXG5cdEBJbnB1dCgpIHNldCBsb2FkaW5nKHZhbHVlOiBib29sZWFuKSB7XG5cdFx0dGhpcy5sb2FkaW5nJC5uZXh0KHZhbHVlKTtcblx0fVxuXG5cdEBJbnB1dCgpIHNldCBvcHRpb25zKG9wdGlvbnM6IFRPcHRpb25bXSkge1xuXHRcdHRoaXMub3B0aW9ucyQubmV4dChvcHRpb25zKTtcblx0fVxuXG5cdEBJbnB1dCgpIG9wdGlvbkNvbXBhcmVyOiAob3B0aW9uMTogVE9wdGlvbiwgb3B0aW9uMjogVE9wdGlvbikgPT4gYm9vbGVhbiA9IChvcHRpb24xLCBvcHRpb24yKSA9PiBKU09OLnN0cmluZ2lmeShvcHRpb24xKSA9PT0gSlNPTi5zdHJpbmdpZnkob3B0aW9uMik7XG5cdEBJbnB1dCgpIG9wdGlvblRwbD86IFRlbXBsYXRlUmVmPEx1T3B0aW9uQ29udGV4dDxUT3B0aW9uPj4gfCBUeXBlPHVua25vd24+ID0gTHVTaW1wbGVTZWxlY3REZWZhdWx0T3B0aW9uQ29tcG9uZW50O1xuXHRASW5wdXQoKSB2YWx1ZVRwbD86IFRlbXBsYXRlUmVmPEx1T3B0aW9uQ29udGV4dDxUT3B0aW9uPj4gfCBUeXBlPHVua25vd24+O1xuXG5cdEBPdXRwdXQoKSBjbHVlQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxzdHJpbmc+KCk7XG5cdEBPdXRwdXQoKSBuZXh0UGFnZSA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcblx0QE91dHB1dCgpIHByZXZpb3VzUGFnZSA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcblxuXHRwdWJsaWMgZ2V0IHZhbHVlKCk6IFRWYWx1ZSB7XG5cdFx0cmV0dXJuIHRoaXMuX3ZhbHVlO1xuXHR9XG5cblx0cHJvdGVjdGVkIHNldCB2YWx1ZSh2YWx1ZTogVFZhbHVlKSB7XG5cdFx0dGhpcy5fdmFsdWUgPSB2YWx1ZTtcblx0XHR0aGlzLmNoYW5nZURldGVjdG9yUmVmLm1hcmtGb3JDaGVjaygpO1xuXHR9XG5cblx0cHJvdGVjdGVkIF92YWx1ZT86IFRWYWx1ZTtcblxuXHRvcHRpb25zJCA9IG5ldyBSZXBsYXlTdWJqZWN0PFRPcHRpb25bXT4oMSk7XG5cdGxvYWRpbmckID0gbmV3IFJlcGxheVN1YmplY3Q8Ym9vbGVhbj4oMSk7XG5cdGNsdWU6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuXG5cdHByb3RlY3RlZCBvbkNoYW5nZT86ICh2YWx1ZTogVFZhbHVlIHwgbnVsbCkgPT4gdm9pZDtcblx0cHJvdGVjdGVkIG9uVG91Y2hlZD86ICgpID0+IHZvaWQ7XG5cblx0cHVibGljIGdldCBwYW5lbFJlZigpOiBMdVNlbGVjdFBhbmVsUmVmPFRPcHRpb24sIFRWYWx1ZT4gfCB1bmRlZmluZWQge1xuXHRcdHJldHVybiB0aGlzLl9wYW5lbFJlZjtcblx0fVxuXG5cdHByb3RlY3RlZCBfcGFuZWxSZWY/OiBMdVNlbGVjdFBhbmVsUmVmPFRPcHRpb24sIFRWYWx1ZT47XG5cblx0cHJvdGVjdGVkIGRlc3Ryb3llZCQgPSBuZXcgU3ViamVjdDx2b2lkPigpO1xuXG5cdEBIb3N0TGlzdGVuZXIoJ2tleWRvd24uc3BhY2UnLCBbJyRldmVudCddKVxuXHRASG9zdExpc3RlbmVyKCdrZXlkb3duLmVudGVyJywgWyckZXZlbnQnXSlcblx0QEhvc3RMaXN0ZW5lcigna2V5ZG93bi5hcnJvd0Rvd24nLCBbJyRldmVudCddKVxuXHRASG9zdExpc3RlbmVyKCdjbGljaycsIFsnJGV2ZW50J10pXG5cdG9uS2V5ZG93bigkZXZlbnQ6IEtleWJvYXJkRXZlbnQpIHtcblx0XHRpZiAoIXRoaXMuaXNQYW5lbE9wZW4pIHtcblx0XHRcdHRoaXMub3BlblBhbmVsKCk7XG5cdFx0XHQkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHQkZXZlbnQucHJldmVudERlZmF1bHQoKTtcblx0XHR9XG5cdH1cblxuXHRwcm90ZWN0ZWQgY2hhbmdlRGV0ZWN0b3JSZWYgPSBpbmplY3QoQ2hhbmdlRGV0ZWN0b3JSZWYpO1xuXHRwcm90ZWN0ZWQgb3ZlcmxheUNvbnRhaW5lclJlZjogSFRNTEVsZW1lbnQgPSBpbmplY3QoT3ZlcmxheUNvbnRhaW5lcikuZ2V0Q29udGFpbmVyRWxlbWVudCgpO1xuXG5cdHByb3RlY3RlZCBsYWJlbDogSFRNTEVsZW1lbnQgfCB1bmRlZmluZWQgPSBpbmplY3QoU0VMRUNUX0xBQkVMKTtcblx0cHJvdGVjdGVkIGxhYmVsSWQ6IHN0cmluZyA9IGluamVjdChTRUxFQ1RfTEFCRUxfSUQpO1xuXG5cdHJlZ2lzdGVyT25DaGFuZ2Uob25DaGFuZ2U6ICh2YWx1ZTogVFZhbHVlKSA9PiB2b2lkKTogdm9pZCB7XG5cdFx0dGhpcy5vbkNoYW5nZSA9IG9uQ2hhbmdlO1xuXHR9XG5cblx0cmVnaXN0ZXJPblRvdWNoZWQob25Ub3VjaGVkOiAoKSA9PiB2b2lkKTogdm9pZCB7XG5cdFx0dGhpcy5vblRvdWNoZWQgPSBvblRvdWNoZWQ7XG5cdH1cblxuXHRzZXREaXNhYmxlZFN0YXRlKGlzRGlzYWJsZWQ6IGJvb2xlYW4pOiB2b2lkIHtcblx0XHR0aGlzLmRpc2FibGVkID0gaXNEaXNhYmxlZDtcblx0fVxuXG5cdG5nT25EZXN0cm95KCk6IHZvaWQge1xuXHRcdHRoaXMuY2xvc2VQYW5lbCgpO1xuXHRcdHRoaXMuZGVzdHJveWVkJC5uZXh0KCk7XG5cdFx0dGhpcy5kZXN0cm95ZWQkLmNvbXBsZXRlKCk7XG5cdH1cblxuXHRuZ09uSW5pdCgpOiB2b2lkIHtcblx0XHRpZiAodGhpcy5sYWJlbCkge1xuXHRcdFx0dGhpcy5sYWJlbC5pZCA9IHRoaXMubGFiZWxJZDtcblx0XHR9XG5cdH1cblxuXHRjbGVhclZhbHVlKGV2ZW50OiBNb3VzZUV2ZW50KTogdm9pZCB7XG5cdFx0ZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0dGhpcy51cGRhdGVWYWx1ZShudWxsKTtcblx0fVxuXG5cdG9wZW5QYW5lbCgpOiB2b2lkIHtcblx0XHRpZiAodGhpcy5pc1BhbmVsT3BlbiB8fCB0aGlzLmRpc2FibGVkKSB7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0dGhpcy5pc1BhbmVsT3BlbiQubmV4dCh0cnVlKTtcblx0XHR0aGlzLl9wYW5lbFJlZiA9IHRoaXMuYnVpbGRQYW5lbFJlZigpO1xuXHRcdHRoaXMuYmluZElucHV0VG9QYW5lbFJlZkV2ZW50cygpO1xuXHR9XG5cblx0cHJvdGVjdGVkIGFic3RyYWN0IGJ1aWxkUGFuZWxSZWYoKTogdGhpc1sncGFuZWxSZWYnXTtcblxuXHRwcm90ZWN0ZWQgYmluZElucHV0VG9QYW5lbFJlZkV2ZW50cygpOiB2b2lkIHtcblx0XHRpZiAoIXRoaXMucGFuZWxSZWYpIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHR0aGlzLnBhbmVsUmVmLnZhbHVlQ2hhbmdlZC5zdWJzY3JpYmUoKHZhbHVlKSA9PiB0aGlzLnVwZGF0ZVZhbHVlKHZhbHVlKSk7XG5cdFx0dGhpcy5wYW5lbFJlZi5uZXh0UGFnZS5zdWJzY3JpYmUoKCkgPT4gdGhpcy5uZXh0UGFnZS5lbWl0KCkpO1xuXHRcdHRoaXMucGFuZWxSZWYucHJldmlvdXNQYWdlLnN1YnNjcmliZSgoKSA9PiB0aGlzLnByZXZpb3VzUGFnZS5lbWl0KCkpO1xuXHRcdHRoaXMucGFuZWxSZWYuY2x1ZUNoYW5nZWQuc3Vic2NyaWJlKChjbHVlKSA9PiB7XG5cdFx0XHR0aGlzLmNsdWVDaGFuZ2UuZW1pdChjbHVlKTtcblx0XHRcdHRoaXMuY2x1ZSA9IGNsdWU7XG5cdFx0fSk7XG5cdFx0dGhpcy5wYW5lbFJlZi5hY3RpdmVPcHRpb25JZENoYW5nZWQuc3Vic2NyaWJlKChvcHRpb25JZCkgPT4ge1xuXHRcdFx0dGhpcy5hY3RpdmVEZXNjZW5kYW50ID0gb3B0aW9uSWQ7XG5cdFx0XHR0aGlzLmNoYW5nZURldGVjdG9yUmVmLm1hcmtGb3JDaGVjaygpO1xuXHRcdH0pO1xuXHRcdHRoaXMucGFuZWxSZWYuY2xvc2VkLnN1YnNjcmliZSgoKSA9PiB0aGlzLmNsb3NlUGFuZWwoKSk7XG5cdH1cblxuXHRwdWJsaWMgY2xvc2VQYW5lbCgpOiB2b2lkIHtcblx0XHRpZiAoIXRoaXMuaXNQYW5lbE9wZW4pIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0dGhpcy5vblRvdWNoZWQ/LigpO1xuXHRcdHRoaXMuaXNQYW5lbE9wZW4kLm5leHQoZmFsc2UpO1xuXHRcdHRoaXMucGFuZWxSZWYuY2xvc2UoKTtcblx0XHR0aGlzLl9wYW5lbFJlZiA9IHVuZGVmaW5lZDtcblx0fVxuXG5cdHB1YmxpYyB3cml0ZVZhbHVlKHZhbHVlOiBUVmFsdWUpOiB2b2lkIHtcblx0XHR0aGlzLnZhbHVlID0gdmFsdWU7XG5cdH1cblxuXHRwdWJsaWMgdXBkYXRlVmFsdWUodmFsdWU6IFRWYWx1ZSk6IHZvaWQge1xuXHRcdHRoaXMudmFsdWUgPSB2YWx1ZTtcblx0XHR0aGlzLm9uQ2hhbmdlPy4odmFsdWUpO1xuXHRcdHRoaXMub25Ub3VjaGVkPy4oKTtcblx0fVxufVxuIl19