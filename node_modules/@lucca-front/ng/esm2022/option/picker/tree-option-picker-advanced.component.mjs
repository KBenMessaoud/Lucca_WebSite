import { A11yModule } from '@angular/cdk/a11y';
import { CommonModule, DOCUMENT } from '@angular/common';
import { ChangeDetectionStrategy, Component, ContentChildren, Directive, forwardRef, Inject } from '@angular/core';
import { ALuOnCloseSubscriber, ALuOnOpenSubscriber, ALuOnScrollBottomSubscriber } from '@lucca-front/ng/core';
import { ALuPickerPanel } from '@lucca-front/ng/picker';
import { luTransformPopover } from '@lucca-front/ng/popover';
import { merge } from 'rxjs';
import { first, map, mergeAll, shareReplay, startWith } from 'rxjs/operators';
import { ALuTreeOptionOperator } from '../operator/index';
import { ALuTreeOptionSelector } from '../selector/index';
import { ALuTreeOptionPickerComponent } from './tree-option-picker.component';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
import * as i2 from "@angular/cdk/a11y";
class ALuTreeOptionPickerAdvancedComponent extends ALuTreeOptionPickerComponent {
    set operatorsQL(ql) {
        this._operatorsQL = ql;
    }
    set onOpenSubsQL(ql) {
        this._onOpenSubscribers = ql.toArray();
    }
    set onCloseSubsQL(ql) {
        this._onCloseSubscribers = ql.toArray();
    }
    set onScrollBottomSubsQL(ql) {
        this._onScrollBottomSubscribers = ql.toArray();
    }
    set selectorsQL(ql) {
        this._selectorsQL = ql;
    }
    constructor(_changeDetectorRef, document) {
        super(_changeDetectorRef, document);
        this._operators = [];
        this._onOpenSubscribers = [];
        this._onCloseSubscribers = [];
        this._onScrollBottomSubscribers = [];
        this._selectors = [];
    }
    onScrollBottom() {
        this._onScrollBottomSubscribers.forEach((o) => {
            if (!o.onScrollBottom) {
                return;
            }
            o.onScrollBottom();
        });
    }
    onOpen() {
        this._onOpenSubscribers.forEach((o) => {
            o.onOpen();
        });
        super.onOpen();
    }
    onClose() {
        this._onCloseSubscribers.forEach((o) => {
            o.onClose();
        });
        super.onClose();
    }
    setValue(value) {
        super.setValue(value);
        this._selectors.forEach((s) => s.setValue(value));
    }
    initOperators() {
        const operators = this._operatorsQL.toArray();
        this._operators = operators;
        let options$;
        operators.forEach((operator) => {
            operator.inOptions$ = options$;
            options$ = operator.outOptions$;
        });
        const lastOperator = operators[operators.length - 1];
        if (lastOperator && lastOperator.outOptions$) {
            this.loading$ = lastOperator.outOptions$.pipe(first(), map(() => false), startWith(true), shareReplay());
        }
    }
    initSelectors() {
        this._selectors = this._selectorsQL.toArray();
        this._subs.add(merge(this._selectors.map((s) => s.onSelectValue))
            .pipe(mergeAll())
            .subscribe((values) => {
            this._select(values);
        }));
    }
    ngAfterViewInit() {
        super.ngAfterViewInit();
        this.initOperators();
        this.initSelectors();
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.3", ngImport: i0, type: ALuTreeOptionPickerAdvancedComponent, deps: [{ token: i0.ChangeDetectorRef }, { token: DOCUMENT }], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "16.1.3", type: ALuTreeOptionPickerAdvancedComponent, queries: [{ propertyName: "operatorsQL", predicate: ALuTreeOptionOperator, descendants: true }, { propertyName: "onOpenSubsQL", predicate: ALuOnOpenSubscriber, descendants: true }, { propertyName: "onCloseSubsQL", predicate: ALuOnCloseSubscriber, descendants: true }, { propertyName: "onScrollBottomSubsQL", predicate: ALuOnScrollBottomSubscriber, descendants: true }, { propertyName: "selectorsQL", predicate: ALuTreeOptionSelector, descendants: true }], usesInheritance: true, ngImport: i0 }); }
}
export { ALuTreeOptionPickerAdvancedComponent };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.3", ngImport: i0, type: ALuTreeOptionPickerAdvancedComponent, decorators: [{
            type: Directive
        }], ctorParameters: function () { return [{ type: i0.ChangeDetectorRef }, { type: Document, decorators: [{
                    type: Inject,
                    args: [DOCUMENT]
                }] }]; }, propDecorators: { operatorsQL: [{
                type: ContentChildren,
                args: [ALuTreeOptionOperator, { descendants: true }]
            }], onOpenSubsQL: [{
                type: ContentChildren,
                args: [ALuOnOpenSubscriber, { descendants: true }]
            }], onCloseSubsQL: [{
                type: ContentChildren,
                args: [ALuOnCloseSubscriber, { descendants: true }]
            }], onScrollBottomSubsQL: [{
                type: ContentChildren,
                args: [ALuOnScrollBottomSubscriber, { descendants: true }]
            }], selectorsQL: [{
                type: ContentChildren,
                args: [ALuTreeOptionSelector, { descendants: true }]
            }] } });
/**
 * advanced option picker panel
 */
class LuTreeOptionPickerAdvancedComponent extends ALuTreeOptionPickerAdvancedComponent {
    constructor(_changeDetectorRef, document) {
        super(_changeDetectorRef, document);
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.3", ngImport: i0, type: LuTreeOptionPickerAdvancedComponent, deps: [{ token: i0.ChangeDetectorRef }, { token: DOCUMENT }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.1.3", type: LuTreeOptionPickerAdvancedComponent, isStandalone: true, selector: "lu-tree-option-picker-advanced", providers: [
            {
                provide: ALuPickerPanel,
                useExisting: forwardRef(() => LuTreeOptionPickerAdvancedComponent),
            },
        ], exportAs: ["LuOptionPicker"], usesInheritance: true, ngImport: i0, template: "<ng-template>\n\t<div\n\t\tclass=\"lu-picker-panel lu-tree-option-picker-panel\"\n\t\trole=\"dialog\"\n\t\t[ngClass]=\"panelClassesMap\"\n\t\t[class.mod-multiple]=\"multiple\"\n\t\t(click)=\"onClick()\"\n\t\t(mouseover)=\"onMouseOver()\"\n\t\t(mouseleave)=\"onMouseLeave()\"\n\t\t(mousedown)=\"onMouseDown()\"\n\t>\n\t\t<div class=\"lu-picker-content\" [ngClass]=\"contentClassesMap\" [cdkTrapFocus]=\"trapFocus\" luScroll (onScrollBottom)=\"onScrollBottom()\">\n\t\t\t<div class=\"lu-picker-content-option\">\n\t\t\t\t<ng-content [class.is-loading]=\"loading$ | async\"></ng-content>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</ng-template>\n", dependencies: [{ kind: "ngmodule", type: CommonModule }, { kind: "directive", type: i1.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "ngmodule", type: A11yModule }, { kind: "directive", type: i2.CdkTrapFocus, selector: "[cdkTrapFocus]", inputs: ["cdkTrapFocus", "cdkTrapFocusAutoCapture"], exportAs: ["cdkTrapFocus"] }], animations: [luTransformPopover], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
export { LuTreeOptionPickerAdvancedComponent };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.3", ngImport: i0, type: LuTreeOptionPickerAdvancedComponent, decorators: [{
            type: Component,
            args: [{ selector: 'lu-tree-option-picker-advanced', changeDetection: ChangeDetectionStrategy.OnPush, animations: [luTransformPopover], exportAs: 'LuOptionPicker', standalone: true, imports: [CommonModule, A11yModule], providers: [
                        {
                            provide: ALuPickerPanel,
                            useExisting: forwardRef(() => LuTreeOptionPickerAdvancedComponent),
                        },
                    ], template: "<ng-template>\n\t<div\n\t\tclass=\"lu-picker-panel lu-tree-option-picker-panel\"\n\t\trole=\"dialog\"\n\t\t[ngClass]=\"panelClassesMap\"\n\t\t[class.mod-multiple]=\"multiple\"\n\t\t(click)=\"onClick()\"\n\t\t(mouseover)=\"onMouseOver()\"\n\t\t(mouseleave)=\"onMouseLeave()\"\n\t\t(mousedown)=\"onMouseDown()\"\n\t>\n\t\t<div class=\"lu-picker-content\" [ngClass]=\"contentClassesMap\" [cdkTrapFocus]=\"trapFocus\" luScroll (onScrollBottom)=\"onScrollBottom()\">\n\t\t\t<div class=\"lu-picker-content-option\">\n\t\t\t\t<ng-content [class.is-loading]=\"loading$ | async\"></ng-content>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</ng-template>\n" }]
        }], ctorParameters: function () { return [{ type: i0.ChangeDetectorRef }, { type: Document, decorators: [{
                    type: Inject,
                    args: [DOCUMENT]
                }] }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJlZS1vcHRpb24tcGlja2VyLWFkdmFuY2VkLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL25nL29wdGlvbi9waWNrZXIvdHJlZS1vcHRpb24tcGlja2VyLWFkdmFuY2VkLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL25nL29wdGlvbi9waWNrZXIvdHJlZS1vcHRpb24tcGlja2VyLWFkdmFuY2VkLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUMvQyxPQUFPLEVBQUUsWUFBWSxFQUFFLFFBQVEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3pELE9BQU8sRUFBaUIsdUJBQXVCLEVBQXFCLFNBQVMsRUFBRSxlQUFlLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQWEsTUFBTSxlQUFlLENBQUM7QUFDaEssT0FBTyxFQUFFLG9CQUFvQixFQUFFLG1CQUFtQixFQUFFLDJCQUEyQixFQUFtRixNQUFNLHNCQUFzQixDQUFDO0FBQy9MLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUN4RCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUM3RCxPQUFPLEVBQUUsS0FBSyxFQUFjLE1BQU0sTUFBTSxDQUFDO0FBQ3pDLE9BQU8sRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLFFBQVEsRUFBRSxXQUFXLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDOUUsT0FBTyxFQUFFLHFCQUFxQixFQUF5QixNQUFNLG1CQUFtQixDQUFDO0FBQ2pGLE9BQU8sRUFBRSxxQkFBcUIsRUFBeUIsTUFBTSxtQkFBbUIsQ0FBQztBQUNqRixPQUFPLEVBQUUsNEJBQTRCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQzs7OztBQUU5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QUFXLEVBQUUsSUFBSSxFQUFFO2dCQU14RCxvQkFBb0I7c0JBRHZCLGVBQWU7dUJBQUMsMkJBQTJCLEVBQUUsRUFBRSxXQUFXLEVBQUUsSUFBSSxFQUFFO2dCQVEvRCxXQUFXO3NCQURkLGVBQWU7dUJBQUMscUJBQXFCLEVBQUUsRUFBRSxXQUFXLEVBQUUsSUFBSSxFQUFFOztBQW9FOUQ7O0dBRUc7QUFDSCxNQWVhLG1DQUdYLFNBQVEsb0NBQTBDO0lBQ25ELFlBQVksa0JBQXFDLEVBQW9CLFFBQWtCO1FBQ3RGLEtBQUssQ0FBQyxrQkFBa0IsRUFBRSxRQUFRLENBQUMsQ0FBQztJQUNyQyxDQUFDOzhHQU5XLG1DQUFtQyxtREFJWSxRQUFRO2tHQUp2RCxtQ0FBbUMsNkVBUHBDO1lBQ1Y7Z0JBQ0MsT0FBTyxFQUFFLGNBQWM7Z0JBQ3ZCLFdBQVcsRUFBRSxVQUFVLENBQUMsR0FBRyxFQUFFLENBQUMsbUNBQW1DLENBQUM7YUFDbEU7U0FDRCwrRUM5SEYsZ29CQWtCQSwyQ0RzR1csWUFBWSw0SEFBRSxVQUFVLDRLQUh0QixDQUFDLGtCQUFrQixDQUFDOztTQVdwQixtQ0FBbUM7MkZBQW5DLG1DQUFtQztrQkFmL0MsU0FBUzsrQkFDQyxnQ0FBZ0MsbUJBRXpCLHVCQUF1QixDQUFDLE1BQU0sY0FDbkMsQ0FBQyxrQkFBa0IsQ0FBQyxZQUN0QixnQkFBZ0IsY0FDZCxJQUFJLFdBQ1AsQ0FBQyxZQUFZLEVBQUUsVUFBVSxDQUFDLGFBQ3hCO3dCQUNWOzRCQUNDLE9BQU8sRUFBRSxjQUFjOzRCQUN2QixXQUFXLEVBQUUsVUFBVSxDQUFDLEdBQUcsRUFBRSxvQ0FBb0MsQ0FBQzt5QkFDbEU7cUJBQ0Q7OzBCQU1tRCxNQUFNOzJCQUFDLFFBQVEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBMTF5TW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2ExMXknO1xuaW1wb3J0IHsgQ29tbW9uTW9kdWxlLCBET0NVTUVOVCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQgeyBBZnRlclZpZXdJbml0LCBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ2hhbmdlRGV0ZWN0b3JSZWYsIENvbXBvbmVudCwgQ29udGVudENoaWxkcmVuLCBEaXJlY3RpdmUsIGZvcndhcmRSZWYsIEluamVjdCwgUXVlcnlMaXN0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBTHVPbkNsb3NlU3Vic2NyaWJlciwgQUx1T25PcGVuU3Vic2NyaWJlciwgQUx1T25TY3JvbGxCb3R0b21TdWJzY3JpYmVyLCBJTHVPbkNsb3NlU3Vic2NyaWJlciwgSUx1T25PcGVuU3Vic2NyaWJlciwgSUx1T25TY3JvbGxCb3R0b21TdWJzY3JpYmVyLCBJTHVUcmVlIH0gZnJvbSAnQGx1Y2NhLWZyb250L25nL2NvcmUnO1xuaW1wb3J0IHsgQUx1UGlja2VyUGFuZWwgfSBmcm9tICdAbHVjY2EtZnJvbnQvbmcvcGlja2VyJztcbmltcG9ydCB7IGx1VHJhbnNmb3JtUG9wb3ZlciB9IGZyb20gJ0BsdWNjYS1mcm9udC9uZy9wb3BvdmVyJztcbmltcG9ydCB7IG1lcmdlLCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBmaXJzdCwgbWFwLCBtZXJnZUFsbCwgc2hhcmVSZXBsYXksIHN0YXJ0V2l0aCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IEFMdVRyZWVPcHRpb25PcGVyYXRvciwgSUx1VHJlZU9wdGlvbk9wZXJhdG9yIH0gZnJvbSAnLi4vb3BlcmF0b3IvaW5kZXgnO1xuaW1wb3J0IHsgQUx1VHJlZU9wdGlvblNlbGVjdG9yLCBJTHVUcmVlT3B0aW9uU2VsZWN0b3IgfSBmcm9tICcuLi9zZWxlY3Rvci9pbmRleCc7XG5pbXBvcnQgeyBBTHVUcmVlT3B0aW9uUGlja2VyQ29tcG9uZW50IH0gZnJvbSAnLi90cmVlLW9wdGlvbi1waWNrZXIuY29tcG9uZW50JztcblxuQERpcmVjdGl2ZSgpXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQUx1VHJlZU9wdGlvblBpY2tlckFkdmFuY2VkQ29tcG9uZW50PFQsIE8gZXh0ZW5kcyBpbXBvcnQoJy4uL2l0ZW0vdHJlZS1vcHRpb24taXRlbS5tb2RlbCcpLklMdVRyZWVPcHRpb25JdGVtPFQ+ID0gaW1wb3J0KCcuLi9pdGVtL3RyZWUtb3B0aW9uLWl0ZW0ubW9kZWwnKS5JTHVUcmVlT3B0aW9uSXRlbTxUPj5cblx0ZXh0ZW5kcyBBTHVUcmVlT3B0aW9uUGlja2VyQ29tcG9uZW50PFQsIE8+XG5cdGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdFxue1xuXHRsb2FkaW5nJDogT2JzZXJ2YWJsZTxib29sZWFuPjtcblxuXHRwcm90ZWN0ZWQgX29wZXJhdG9yczogSUx1VHJlZU9wdGlvbk9wZXJhdG9yPFQ+W10gPSBbXTtcblx0cHJvdGVjdGVkIF9vcGVyYXRvcnNRTDogUXVlcnlMaXN0PElMdVRyZWVPcHRpb25PcGVyYXRvcjxUPj47XG5cdEBDb250ZW50Q2hpbGRyZW4oQUx1VHJlZU9wdGlvbk9wZXJhdG9yLCB7IGRlc2NlbmRhbnRzOiB0cnVlIH0pXG5cdHNldCBvcGVyYXRvcnNRTChxbDogUXVlcnlMaXN0PElMdVRyZWVPcHRpb25PcGVyYXRvcjxUPj4pIHtcblx0XHR0aGlzLl9vcGVyYXRvcnNRTCA9IHFsO1xuXHR9XG5cdHByb3RlY3RlZCBfb25PcGVuU3Vic2NyaWJlcnM6IElMdU9uT3BlblN1YnNjcmliZXJbXSA9IFtdO1xuXHRAQ29udGVudENoaWxkcmVuKEFMdU9uT3BlblN1YnNjcmliZXIsIHsgZGVzY2VuZGFudHM6IHRydWUgfSkgc2V0IG9uT3BlblN1YnNRTChxbDogUXVlcnlMaXN0PElMdU9uT3BlblN1YnNjcmliZXI+KSB7XG5cdFx0dGhpcy5fb25PcGVuU3Vic2NyaWJlcnMgPSBxbC50b0FycmF5KCk7XG5cdH1cblx0cHJvdGVjdGVkIF9vbkNsb3NlU3Vic2NyaWJlcnM6IElMdU9uQ2xvc2VTdWJzY3JpYmVyW10gPSBbXTtcblx0QENvbnRlbnRDaGlsZHJlbihBTHVPbkNsb3NlU3Vic2NyaWJlciwgeyBkZXNjZW5kYW50czogdHJ1ZSB9KVxuXHRzZXQgb25DbG9zZVN1YnNRTChxbDogUXVlcnlMaXN0PElMdU9uQ2xvc2VTdWJzY3JpYmVyPikge1xuXHRcdHRoaXMuX29uQ2xvc2VTdWJzY3JpYmVycyA9IHFsLnRvQXJyYXkoKTtcblx0fVxuXHRwcm90ZWN0ZWQgX29uU2Nyb2xsQm90dG9tU3Vic2NyaWJlcnM6IElMdU9uU2Nyb2xsQm90dG9tU3Vic2NyaWJlcltdID0gW107XG5cdEBDb250ZW50Q2hpbGRyZW4oQUx1T25TY3JvbGxCb3R0b21TdWJzY3JpYmVyLCB7IGRlc2NlbmRhbnRzOiB0cnVlIH0pXG5cdHNldCBvblNjcm9sbEJvdHRvbVN1YnNRTChxbDogUXVlcnlMaXN0PElMdU9uU2Nyb2xsQm90dG9tU3Vic2NyaWJlcj4pIHtcblx0XHR0aGlzLl9vblNjcm9sbEJvdHRvbVN1YnNjcmliZXJzID0gcWwudG9BcnJheSgpO1xuXHR9XG5cblx0cHJvdGVjdGVkIF9zZWxlY3RvcnNRTDogUXVlcnlMaXN0PElMdVRyZWVPcHRpb25TZWxlY3RvcjxUPj47XG5cdHByb3RlY3RlZCBfc2VsZWN0b3JzOiBJTHVUcmVlT3B0aW9uU2VsZWN0b3I8VD5bXSA9IFtdO1xuXHRAQ29udGVudENoaWxkcmVuKEFMdVRyZWVPcHRpb25TZWxlY3RvciwgeyBkZXNjZW5kYW50czogdHJ1ZSB9KVxuXHRzZXQgc2VsZWN0b3JzUUwocWw6IFF1ZXJ5TGlzdDxJTHVUcmVlT3B0aW9uU2VsZWN0b3I8VD4+KSB7XG5cdFx0dGhpcy5fc2VsZWN0b3JzUUwgPSBxbDtcblx0fVxuXG5cdGNvbnN0cnVjdG9yKF9jaGFuZ2VEZXRlY3RvclJlZjogQ2hhbmdlRGV0ZWN0b3JSZWYsIEBJbmplY3QoRE9DVU1FTlQpIGRvY3VtZW50OiBEb2N1bWVudCkge1xuXHRcdHN1cGVyKF9jaGFuZ2VEZXRlY3RvclJlZiwgZG9jdW1lbnQpO1xuXHR9XG5cdG9uU2Nyb2xsQm90dG9tKCkge1xuXHRcdHRoaXMuX29uU2Nyb2xsQm90dG9tU3Vic2NyaWJlcnMuZm9yRWFjaCgobykgPT4ge1xuXHRcdFx0aWYgKCFvLm9uU2Nyb2xsQm90dG9tKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHRcdG8ub25TY3JvbGxCb3R0b20oKTtcblx0XHR9KTtcblx0fVxuXHRvdmVycmlkZSBvbk9wZW4oKSB7XG5cdFx0dGhpcy5fb25PcGVuU3Vic2NyaWJlcnMuZm9yRWFjaCgobykgPT4ge1xuXHRcdFx0by5vbk9wZW4oKTtcblx0XHR9KTtcblx0XHRzdXBlci5vbk9wZW4oKTtcblx0fVxuXHRvdmVycmlkZSBvbkNsb3NlKCkge1xuXHRcdHRoaXMuX29uQ2xvc2VTdWJzY3JpYmVycy5mb3JFYWNoKChvKSA9PiB7XG5cdFx0XHRvLm9uQ2xvc2UoKTtcblx0XHR9KTtcblx0XHRzdXBlci5vbkNsb3NlKCk7XG5cdH1cblx0b3ZlcnJpZGUgc2V0VmFsdWUodmFsdWU6IFQgfCBUW10pIHtcblx0XHRzdXBlci5zZXRWYWx1ZSh2YWx1ZSk7XG5cdFx0dGhpcy5fc2VsZWN0b3JzLmZvckVhY2goKHMpID0+IHMuc2V0VmFsdWUodmFsdWUpKTtcblx0fVxuXG5cdHByb3RlY3RlZCBpbml0T3BlcmF0b3JzKCkge1xuXHRcdGNvbnN0IG9wZXJhdG9ycyA9IHRoaXMuX29wZXJhdG9yc1FMLnRvQXJyYXkoKTtcblx0XHR0aGlzLl9vcGVyYXRvcnMgPSBvcGVyYXRvcnM7XG5cdFx0bGV0IG9wdGlvbnMkOiBPYnNlcnZhYmxlPElMdVRyZWU8VD5bXT47XG5cdFx0b3BlcmF0b3JzLmZvckVhY2goKG9wZXJhdG9yKSA9PiB7XG5cdFx0XHRvcGVyYXRvci5pbk9wdGlvbnMkID0gb3B0aW9ucyQ7XG5cdFx0XHRvcHRpb25zJCA9IG9wZXJhdG9yLm91dE9wdGlvbnMkO1xuXHRcdH0pO1xuXHRcdGNvbnN0IGxhc3RPcGVyYXRvciA9IG9wZXJhdG9yc1tvcGVyYXRvcnMubGVuZ3RoIC0gMV07XG5cdFx0aWYgKGxhc3RPcGVyYXRvciAmJiBsYXN0T3BlcmF0b3Iub3V0T3B0aW9ucyQpIHtcblx0XHRcdHRoaXMubG9hZGluZyQgPSBsYXN0T3BlcmF0b3Iub3V0T3B0aW9ucyQucGlwZShcblx0XHRcdFx0Zmlyc3QoKSxcblx0XHRcdFx0bWFwKCgpID0+IGZhbHNlKSxcblx0XHRcdFx0c3RhcnRXaXRoKHRydWUpLFxuXHRcdFx0XHRzaGFyZVJlcGxheSgpLFxuXHRcdFx0KTtcblx0XHR9XG5cdH1cblx0cHJvdGVjdGVkIGluaXRTZWxlY3RvcnMoKSB7XG5cdFx0dGhpcy5fc2VsZWN0b3JzID0gdGhpcy5fc2VsZWN0b3JzUUwudG9BcnJheSgpO1xuXHRcdHRoaXMuX3N1YnMuYWRkKFxuXHRcdFx0bWVyZ2UodGhpcy5fc2VsZWN0b3JzLm1hcCgocykgPT4gcy5vblNlbGVjdFZhbHVlKSlcblx0XHRcdFx0LnBpcGUobWVyZ2VBbGwoKSlcblx0XHRcdFx0LnN1YnNjcmliZSgodmFsdWVzKSA9PiB7XG5cdFx0XHRcdFx0dGhpcy5fc2VsZWN0KHZhbHVlcyk7XG5cdFx0XHRcdH0pLFxuXHRcdCk7XG5cdH1cblx0b3ZlcnJpZGUgbmdBZnRlclZpZXdJbml0KCkge1xuXHRcdHN1cGVyLm5nQWZ0ZXJWaWV3SW5pdCgpO1xuXHRcdHRoaXMuaW5pdE9wZXJhdG9ycygpO1xuXHRcdHRoaXMuaW5pdFNlbGVjdG9ycygpO1xuXHR9XG59XG5cbi8qKlxuICogYWR2YW5jZWQgb3B0aW9uIHBpY2tlciBwYW5lbFxuICovXG5AQ29tcG9uZW50KHtcblx0c2VsZWN0b3I6ICdsdS10cmVlLW9wdGlvbi1waWNrZXItYWR2YW5jZWQnLFxuXHR0ZW1wbGF0ZVVybDogJy4vdHJlZS1vcHRpb24tcGlja2VyLWFkdmFuY2VkLmNvbXBvbmVudC5odG1sJyxcblx0Y2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG5cdGFuaW1hdGlvbnM6IFtsdVRyYW5zZm9ybVBvcG92ZXJdLFxuXHRleHBvcnRBczogJ0x1T3B0aW9uUGlja2VyJyxcblx0c3RhbmRhbG9uZTogdHJ1ZSxcblx0aW1wb3J0czogW0NvbW1vbk1vZHVsZSwgQTExeU1vZHVsZV0sXG5cdHByb3ZpZGVyczogW1xuXHRcdHtcblx0XHRcdHByb3ZpZGU6IEFMdVBpY2tlclBhbmVsLFxuXHRcdFx0dXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gTHVUcmVlT3B0aW9uUGlja2VyQWR2YW5jZWRDb21wb25lbnQpLFxuXHRcdH0sXG5cdF0sXG59KVxuZXhwb3J0IGNsYXNzIEx1VHJlZU9wdGlvblBpY2tlckFkdmFuY2VkQ29tcG9uZW50PFxuXHRULFxuXHRPIGV4dGVuZHMgaW1wb3J0KCcuLi9pdGVtL3RyZWUtb3B0aW9uLWl0ZW0ubW9kZWwnKS5JTHVUcmVlT3B0aW9uSXRlbTxUPiA9IGltcG9ydCgnLi4vaXRlbS90cmVlLW9wdGlvbi1pdGVtLm1vZGVsJykuSUx1VHJlZU9wdGlvbkl0ZW08VD4sXG4+IGV4dGVuZHMgQUx1VHJlZU9wdGlvblBpY2tlckFkdmFuY2VkQ29tcG9uZW50PFQsIE8+IHtcblx0Y29uc3RydWN0b3IoX2NoYW5nZURldGVjdG9yUmVmOiBDaGFuZ2VEZXRlY3RvclJlZiwgQEluamVjdChET0NVTUVOVCkgZG9jdW1lbnQ6IERvY3VtZW50KSB7XG5cdFx0c3VwZXIoX2NoYW5nZURldGVjdG9yUmVmLCBkb2N1bWVudCk7XG5cdH1cbn1cbiIsIjxuZy10ZW1wbGF0ZT5cblx0PGRpdlxuXHRcdGNsYXNzPVwibHUtcGlja2VyLXBhbmVsIGx1LXRyZWUtb3B0aW9uLXBpY2tlci1wYW5lbFwiXG5cdFx0cm9sZT1cImRpYWxvZ1wiXG5cdFx0W25nQ2xhc3NdPVwicGFuZWxDbGFzc2VzTWFwXCJcblx0XHRbY2xhc3MubW9kLW11bHRpcGxlXT1cIm11bHRpcGxlXCJcblx0XHQoY2xpY2spPVwib25DbGljaygpXCJcblx0XHQobW91c2VvdmVyKT1cIm9uTW91c2VPdmVyKClcIlxuXHRcdChtb3VzZWxlYXZlKT1cIm9uTW91c2VMZWF2ZSgpXCJcblx0XHQobW91c2Vkb3duKT1cIm9uTW91c2VEb3duKClcIlxuXHQ+XG5cdFx0PGRpdiBjbGFzcz1cImx1LXBpY2tlci1jb250ZW50XCIgW25nQ2xhc3NdPVwiY29udGVudENsYXNzZXNNYXBcIiBbY2RrVHJhcEZvY3VzXT1cInRyYXBGb2N1c1wiIGx1U2Nyb2xsIChvblNjcm9sbEJvdHRvbSk9XCJvblNjcm9sbEJvdHRvbSgpXCI+XG5cdFx0XHQ8ZGl2IGNsYXNzPVwibHUtcGlja2VyLWNvbnRlbnQtb3B0aW9uXCI+XG5cdFx0XHRcdDxuZy1jb250ZW50IFtjbGFzcy5pcy1sb2FkaW5nXT1cImxvYWRpbmckIHwgYXN5bmNcIj48L25nLWNvbnRlbnQ+XG5cdFx0XHQ8L2Rpdj5cblx0XHQ8L2Rpdj5cblx0PC9kaXY+XG48L25nLXRlbXBsYXRlPlxuIl19