import { A11yModule } from '@angular/cdk/a11y';
import { OverlayModule } from '@angular/cdk/overlay';
import { CommonModule, DOCUMENT } from '@angular/common';
import { ChangeDetectionStrategy, Component, ContentChildren, Directive, forwardRef, Inject } from '@angular/core';
import { ALuOnCloseSubscriber, ALuOnOpenSubscriber, ALuOnScrollBottomSubscriber } from '@lucca-front/ng/core';
import { ALuPickerPanel } from '@lucca-front/ng/picker';
import { luTransformPopover } from '@lucca-front/ng/popover';
import { LuScrollDirective } from '@lucca-front/ng/scroll';
import { merge } from 'rxjs';
import { first, map, mergeAll, shareReplay, startWith } from 'rxjs/operators';
import { LuOptionItemComponent } from '../item';
import { ALuOptionOperator } from '../operator/index';
import { ALuOptionSelector } from '../selector/index';
import { ALuOptionPickerComponent } from './option-picker.component';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
import * as i2 from "@angular/cdk/a11y";
class ALuOptionPickerAdvancedComponent extends ALuOptionPickerComponent {
    set operatorsQL(ql) {
        this._operatorsQL = ql;
    }
    set onOpenSubsQL(ql) {
        this._onOpenSubscribers = ql.toArray();
    }
    set onCloseSubsQL(ql) {
        this._onCloseSubscribers = ql.toArray();
    }
    set onScrollBottomSubsQL(ql) {
        this._onScrollBottomSubscribers = ql.toArray();
    }
    set selectorsQL(ql) {
        this._selectorsQL = ql;
    }
    constructor(_changeDetectorRef, document) {
        super(_changeDetectorRef, document);
        this._operators = [];
        this._onOpenSubscribers = [];
        this._onCloseSubscribers = [];
        this._onScrollBottomSubscribers = [];
        this._selectors = [];
    }
    onScrollBottom() {
        this._onScrollBottomSubscribers.forEach((o) => {
            if (!o.onScrollBottom) {
                return;
            }
            o.onScrollBottom();
        });
    }
    onOpen() {
        this._onOpenSubscribers.forEach((o) => {
            o.onOpen();
        });
        const operators = this._operators || [];
        const lastOperator = operators[operators.length - 1];
        if (lastOperator && lastOperator.outOptions$) {
            this.loading$ = lastOperator.outOptions$.pipe(first(), map(() => false), startWith(true), shareReplay());
        }
        super.onOpen();
    }
    onClose() {
        this._onCloseSubscribers.forEach((o) => {
            o.onClose();
        });
        super.onClose();
    }
    setValue(value) {
        super.setValue(value);
        this._selectors.forEach((s) => s.setValue(value));
    }
    initOperators() {
        const operators = this._operatorsQL.toArray();
        this._operators = operators;
        let options$;
        operators.forEach((operator) => {
            operator.inOptions$ = options$;
            options$ = operator.outOptions$;
        });
    }
    initSelectors() {
        // TODO : FIX changes type
        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment
        const selectors$ = this._selectorsQL.changes.pipe(startWith(this._selectorsQL.toArray()));
        this._subs.add(selectors$.subscribe((selectors) => {
            this._selectors = selectors;
            this._selectors.forEach((s) => s.setValue(this._value));
            this._subs.add(merge(this._selectors.map((s) => s.onSelectValue))
                .pipe(mergeAll())
                .subscribe((values) => {
                this._select(values);
            }));
        }));
    }
    ngAfterViewInit() {
        super.ngAfterViewInit();
        this.initOperators();
        this.initSelectors();
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.3", ngImport: i0, type: ALuOptionPickerAdvancedComponent, deps: [{ token: i0.ChangeDetectorRef }, { token: DOCUMENT }], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "16.1.3", type: ALuOptionPickerAdvancedComponent, queries: [{ propertyName: "operatorsQL", predicate: ALuOptionOperator, descendants: true }, { propertyName: "onOpenSubsQL", predicate: ALuOnOpenSubscriber, descendants: true }, { propertyName: "onCloseSubsQL", predicate: ALuOnCloseSubscriber, descendants: true }, { propertyName: "onScrollBottomSubsQL", predicate: ALuOnScrollBottomSubscriber, descendants: true }, { propertyName: "selectorsQL", predicate: ALuOptionSelector, descendants: true }], usesInheritance: true, ngImport: i0 }); }
}
export { ALuOptionPickerAdvancedComponent };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.3", ngImport: i0, type: ALuOptionPickerAdvancedComponent, decorators: [{
            type: Directive
        }], ctorParameters: function () { return [{ type: i0.ChangeDetectorRef }, { type: Document, decorators: [{
                    type: Inject,
                    args: [DOCUMENT]
                }] }]; }, propDecorators: { operatorsQL: [{
                type: ContentChildren,
                args: [ALuOptionOperator, { descendants: true }]
            }], onOpenSubsQL: [{
                type: ContentChildren,
                args: [ALuOnOpenSubscriber, { descendants: true }]
            }], onCloseSubsQL: [{
                type: ContentChildren,
                args: [ALuOnCloseSubscriber, { descendants: true }]
            }], onScrollBottomSubsQL: [{
                type: ContentChildren,
                args: [ALuOnScrollBottomSubscriber, { descendants: true }]
            }], selectorsQL: [{
                type: ContentChildren,
                args: [ALuOptionSelector, { descendants: true }]
            }] } });
/**
 * advanced option picker panel
 */
class LuOptionPickerAdvancedComponent extends ALuOptionPickerAdvancedComponent {
    constructor(_changeDetectorRef, document) {
        super(_changeDetectorRef, document);
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.3", ngImport: i0, type: LuOptionPickerAdvancedComponent, deps: [{ token: i0.ChangeDetectorRef }, { token: DOCUMENT }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.1.3", type: LuOptionPickerAdvancedComponent, isStandalone: true, selector: "lu-option-picker-advanced", providers: [
            {
                provide: ALuPickerPanel,
                useExisting: forwardRef(() => LuOptionPickerAdvancedComponent),
            },
        ], exportAs: ["LuOptionPickerAdvanced"], usesInheritance: true, ngImport: i0, template: "<ng-template>\n\t<div\n\t\tclass=\"lu-picker-panel lu-option-picker-panel\"\n\t\trole=\"dialog\"\n\t\t[ngClass]=\"panelClassesMap\"\n\t\t[class.mod-multiple]=\"multiple\"\n\t\t(click)=\"onClick()\"\n\t\t(mouseover)=\"onMouseOver()\"\n\t\t(mouseleave)=\"onMouseLeave()\"\n\t\t(mousedown)=\"onMouseDown()\"\n\t>\n\t\t<div\n\t\t\t[class.is-loading]=\"loading$ | async\"\n\t\t\tclass=\"lu-picker-content\"\n\t\t\t[ngClass]=\"contentClassesMap\"\n\t\t\t[cdkTrapFocus]=\"trapFocus\"\n\t\t\tluScroll\n\t\t\t(onScrollBottom)=\"onScrollBottom()\"\n\t\t>\n\t\t\t<ng-content></ng-content>\n\t\t\t<div *ngIf=\"loading$ | async\" class=\"loading lu-picker-loading\"></div>\n\t\t</div>\n\t</div>\n</ng-template>\n", dependencies: [{ kind: "ngmodule", type: CommonModule }, { kind: "directive", type: i1.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: i1.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "pipe", type: i1.AsyncPipe, name: "async" }, { kind: "ngmodule", type: OverlayModule }, { kind: "directive", type: LuScrollDirective, selector: "[luScroll]", inputs: ["debounceTime"], outputs: ["onScroll", "onScrollTop", "onScrollBottom", "onScrollLeft", "onScrollRight"], exportAs: ["luScroll"] }, { kind: "ngmodule", type: A11yModule }, { kind: "directive", type: i2.CdkTrapFocus, selector: "[cdkTrapFocus]", inputs: ["cdkTrapFocus", "cdkTrapFocusAutoCapture"], exportAs: ["cdkTrapFocus"] }], animations: [luTransformPopover], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
export { LuOptionPickerAdvancedComponent };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.3", ngImport: i0, type: LuOptionPickerAdvancedComponent, decorators: [{
            type: Component,
            args: [{ selector: 'lu-option-picker-advanced', changeDetection: ChangeDetectionStrategy.OnPush, animations: [luTransformPopover], exportAs: 'LuOptionPickerAdvanced', standalone: true, imports: [CommonModule, OverlayModule, LuOptionItemComponent, LuScrollDirective, A11yModule], providers: [
                        {
                            provide: ALuPickerPanel,
                            useExisting: forwardRef(() => LuOptionPickerAdvancedComponent),
                        },
                    ], template: "<ng-template>\n\t<div\n\t\tclass=\"lu-picker-panel lu-option-picker-panel\"\n\t\trole=\"dialog\"\n\t\t[ngClass]=\"panelClassesMap\"\n\t\t[class.mod-multiple]=\"multiple\"\n\t\t(click)=\"onClick()\"\n\t\t(mouseover)=\"onMouseOver()\"\n\t\t(mouseleave)=\"onMouseLeave()\"\n\t\t(mousedown)=\"onMouseDown()\"\n\t>\n\t\t<div\n\t\t\t[class.is-loading]=\"loading$ | async\"\n\t\t\tclass=\"lu-picker-content\"\n\t\t\t[ngClass]=\"contentClassesMap\"\n\t\t\t[cdkTrapFocus]=\"trapFocus\"\n\t\t\tluScroll\n\t\t\t(onScrollBottom)=\"onScrollBottom()\"\n\t\t>\n\t\t\t<ng-content></ng-content>\n\t\t\t<div *ngIf=\"loading$ | async\" class=\"loading lu-picker-loading\"></div>\n\t\t</div>\n\t</div>\n</ng-template>\n" }]
        }], ctorParameters: function () { return [{ type: i0.ChangeDetectorRef }, { type: Document, decorators: [{
                    type: Inject,
                    args: [DOCUMENT]
                }] }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3B0aW9uLXBpY2tlci1hZHZhbmNlZC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wYWNrYWdlcy9uZy9vcHRpb24vcGlja2VyL29wdGlvbi1waWNrZXItYWR2YW5jZWQuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vcGFja2FnZXMvbmcvb3B0aW9uL3BpY2tlci9vcHRpb24tcGlja2VyLWFkdmFuY2VkLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUMvQyxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDckQsT0FBTyxFQUFFLFlBQVksRUFBRSxRQUFRLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUN6RCxPQUFPLEVBQWlCLHVCQUF1QixFQUFxQixTQUFTLEVBQUUsZUFBZSxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFhLE1BQU0sZUFBZSxDQUFDO0FBQ2hLLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxtQkFBbUIsRUFBRSwyQkFBMkIsRUFBMEUsTUFBTSxzQkFBc0IsQ0FBQztBQUN0TCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDeEQsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDN0QsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDM0QsT0FBTyxFQUFFLEtBQUssRUFBYyxNQUFNLE1BQU0sQ0FBQztBQUN6QyxPQUFPLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxRQUFRLEVBQUUsV0FBVyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzlFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUNoRCxPQUFPLEVBQUUsaUJBQWlCLEVBQXFC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QUErQixDQUFDO2FBQzlEO1NBQ0QsdUZDdElGLDZyQkF3QkEsMkNEd0dXLFlBQVkscVJBQUUsYUFBYSwrQkFBeUIsaUJBQWlCLGlNQUFFLFVBQVUsNEtBSC9FLENBQUMsa0JBQWtCLENBQUM7O1NBV3BCLCtCQUErQjsyRkFBL0IsK0JBQStCO2tCQWYzQyxTQUFTOytCQUNDLDJCQUEyQixtQkFFcEIsdUJBQXVCLENBQUMsTUFBTSxjQUNuQyxDQUFDLGtCQUFrQixDQUFDLFlBQ3RCLHdCQUF3QixjQUN0QixJQUFJLFdBQ1AsQ0FBQyxZQUFZLEVBQUUsYUFBYSxFQUFFLHFCQUFxQixFQUFFLGlCQUFpQixFQUFFLFVBQVUsQ0FBQyxhQUNqRjt3QkFDVjs0QkFDQyxPQUFPLEVBQUUsY0FBYzs0QkFDdkIsV0FBVyxFQUFFLFVBQVUsQ0FBQyxHQUFHLEVBQUUsZ0NBQWdDLENBQUM7eUJBQzlEO3FCQUNEOzswQkFNbUQsTUFBTTsyQkFBQyxRQUFRIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQTExeU1vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9hMTF5JztcbmltcG9ydCB7IE92ZXJsYXlNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9jZGsvb3ZlcmxheSc7XG5pbXBvcnQgeyBDb21tb25Nb2R1bGUsIERPQ1VNRU5UIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IEFmdGVyVmlld0luaXQsIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDaGFuZ2VEZXRlY3RvclJlZiwgQ29tcG9uZW50LCBDb250ZW50Q2hpbGRyZW4sIERpcmVjdGl2ZSwgZm9yd2FyZFJlZiwgSW5qZWN0LCBRdWVyeUxpc3QgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEFMdU9uQ2xvc2VTdWJzY3JpYmVyLCBBTHVPbk9wZW5TdWJzY3JpYmVyLCBBTHVPblNjcm9sbEJvdHRvbVN1YnNjcmliZXIsIElMdU9uQ2xvc2VTdWJzY3JpYmVyLCBJTHVPbk9wZW5TdWJzY3JpYmVyLCBJTHVPblNjcm9sbEJvdHRvbVN1YnNjcmliZXIgfSBmcm9tICdAbHVjY2EtZnJvbnQvbmcvY29yZSc7XG5pbXBvcnQgeyBBTHVQaWNrZXJQYW5lbCB9IGZyb20gJ0BsdWNjYS1mcm9udC9uZy9waWNrZXInO1xuaW1wb3J0IHsgbHVUcmFuc2Zvcm1Qb3BvdmVyIH0gZnJvbSAnQGx1Y2NhLWZyb250L25nL3BvcG92ZXInO1xuaW1wb3J0IHsgTHVTY3JvbGxEaXJlY3RpdmUgfSBmcm9tICdAbHVjY2EtZnJvbnQvbmcvc2Nyb2xsJztcbmltcG9ydCB7IG1lcmdlLCBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBmaXJzdCwgbWFwLCBtZXJnZUFsbCwgc2hhcmVSZXBsYXksIHN0YXJ0V2l0aCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IEx1T3B0aW9uSXRlbUNvbXBvbmVudCB9IGZyb20gJy4uL2l0ZW0nO1xuaW1wb3J0IHsgQUx1T3B0aW9uT3BlcmF0b3IsIElMdU9wdGlvbk9wZXJhdG9yIH0gZnJvbSAnLi4vb3BlcmF0b3IvaW5kZXgnO1xuaW1wb3J0IHsgQUx1T3B0aW9uU2VsZWN0b3IsIElMdU9wdGlvblNlbGVjdG9yIH0gZnJvbSAnLi4vc2VsZWN0b3IvaW5kZXgnO1xuaW1wb3J0IHsgQUx1T3B0aW9uUGlja2VyQ29tcG9uZW50IH0gZnJvbSAnLi9vcHRpb24tcGlja2VyLmNvbXBvbmVudCc7XG5cbkBEaXJlY3RpdmUoKVxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIEFMdU9wdGlvblBpY2tlckFkdmFuY2VkQ29tcG9uZW50PFQsIE8gZXh0ZW5kcyBpbXBvcnQoJy4uL2l0ZW0vb3B0aW9uLWl0ZW0ubW9kZWwnKS5JTHVPcHRpb25JdGVtPFQ+ID0gaW1wb3J0KCcuLi9pdGVtL29wdGlvbi1pdGVtLm1vZGVsJykuSUx1T3B0aW9uSXRlbTxUPj5cblx0ZXh0ZW5kcyBBTHVPcHRpb25QaWNrZXJDb21wb25lbnQ8VCwgTz5cblx0aW1wbGVtZW50cyBBZnRlclZpZXdJbml0XG57XG5cdGxvYWRpbmckOiBPYnNlcnZhYmxlPGJvb2xlYW4+O1xuXG5cdHByb3RlY3RlZCBfb3BlcmF0b3JzOiBJTHVPcHRpb25PcGVyYXRvcjxUPltdID0gW107XG5cdHByb3RlY3RlZCBfb3BlcmF0b3JzUUw6IFF1ZXJ5TGlzdDxJTHVPcHRpb25PcGVyYXRvcjxUPj47XG5cdEBDb250ZW50Q2hpbGRyZW4oQUx1T3B0aW9uT3BlcmF0b3IsIHsgZGVzY2VuZGFudHM6IHRydWUgfSkgc2V0IG9wZXJhdG9yc1FMKHFsOiBRdWVyeUxpc3Q8SUx1T3B0aW9uT3BlcmF0b3I8VD4+KSB7XG5cdFx0dGhpcy5fb3BlcmF0b3JzUUwgPSBxbDtcblx0fVxuXHRwcm90ZWN0ZWQgX29uT3BlblN1YnNjcmliZXJzOiBJTHVPbk9wZW5TdWJzY3JpYmVyW10gPSBbXTtcblx0QENvbnRlbnRDaGlsZHJlbihBTHVPbk9wZW5TdWJzY3JpYmVyLCB7IGRlc2NlbmRhbnRzOiB0cnVlIH0pIHNldCBvbk9wZW5TdWJzUUwocWw6IFF1ZXJ5TGlzdDxJTHVPbk9wZW5TdWJzY3JpYmVyPikge1xuXHRcdHRoaXMuX29uT3BlblN1YnNjcmliZXJzID0gcWwudG9BcnJheSgpO1xuXHR9XG5cdHByb3RlY3RlZCBfb25DbG9zZVN1YnNjcmliZXJzOiBJTHVPbkNsb3NlU3Vic2NyaWJlcltdID0gW107XG5cdEBDb250ZW50Q2hpbGRyZW4oQUx1T25DbG9zZVN1YnNjcmliZXIsIHsgZGVzY2VuZGFudHM6IHRydWUgfSlcblx0c2V0IG9uQ2xvc2VTdWJzUUwocWw6IFF1ZXJ5TGlzdDxJTHVPbkNsb3NlU3Vic2NyaWJlcj4pIHtcblx0XHR0aGlzLl9vbkNsb3NlU3Vic2NyaWJlcnMgPSBxbC50b0FycmF5KCk7XG5cdH1cblx0cHJvdGVjdGVkIF9vblNjcm9sbEJvdHRvbVN1YnNjcmliZXJzOiBJTHVPblNjcm9sbEJvdHRvbVN1YnNjcmliZXJbXSA9IFtdO1xuXHRAQ29udGVudENoaWxkcmVuKEFMdU9uU2Nyb2xsQm90dG9tU3Vic2NyaWJlciwgeyBkZXNjZW5kYW50czogdHJ1ZSB9KVxuXHRzZXQgb25TY3JvbGxCb3R0b21TdWJzUUwocWw6IFF1ZXJ5TGlzdDxJTHVPblNjcm9sbEJvdHRvbVN1YnNjcmliZXI+KSB7XG5cdFx0dGhpcy5fb25TY3JvbGxCb3R0b21TdWJzY3JpYmVycyA9IHFsLnRvQXJyYXkoKTtcblx0fVxuXHRwcm90ZWN0ZWQgX3NlbGVjdG9yczogSUx1T3B0aW9uU2VsZWN0b3I8VD5bXSA9IFtdO1xuXHRwcm90ZWN0ZWQgX3NlbGVjdG9yc1FMOiBRdWVyeUxpc3Q8SUx1T3B0aW9uU2VsZWN0b3I8VD4+O1xuXHRAQ29udGVudENoaWxkcmVuKEFMdU9wdGlvblNlbGVjdG9yLCB7IGRlc2NlbmRhbnRzOiB0cnVlIH0pIHNldCBzZWxlY3RvcnNRTChxbDogUXVlcnlMaXN0PElMdU9wdGlvblNlbGVjdG9yPFQ+Pikge1xuXHRcdHRoaXMuX3NlbGVjdG9yc1FMID0gcWw7XG5cdH1cblxuXHRjb25zdHJ1Y3RvcihfY2hhbmdlRGV0ZWN0b3JSZWY6IENoYW5nZURldGVjdG9yUmVmLCBASW5qZWN0KERPQ1VNRU5UKSBkb2N1bWVudDogRG9jdW1lbnQpIHtcblx0XHRzdXBlcihfY2hhbmdlRGV0ZWN0b3JSZWYsIGRvY3VtZW50KTtcblx0fVxuXHRvblNjcm9sbEJvdHRvbSgpIHtcblx0XHR0aGlzLl9vblNjcm9sbEJvdHRvbVN1YnNjcmliZXJzLmZvckVhY2goKG86IElMdU9uU2Nyb2xsQm90dG9tU3Vic2NyaWJlcikgPT4ge1xuXHRcdFx0aWYgKCFvLm9uU2Nyb2xsQm90dG9tKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHRcdG8ub25TY3JvbGxCb3R0b20oKTtcblx0XHR9KTtcblx0fVxuXHRvdmVycmlkZSBvbk9wZW4oKSB7XG5cdFx0dGhpcy5fb25PcGVuU3Vic2NyaWJlcnMuZm9yRWFjaCgobzogSUx1T25PcGVuU3Vic2NyaWJlcikgPT4ge1xuXHRcdFx0by5vbk9wZW4oKTtcblx0XHR9KTtcblx0XHRjb25zdCBvcGVyYXRvcnMgPSB0aGlzLl9vcGVyYXRvcnMgfHwgW107XG5cdFx0Y29uc3QgbGFzdE9wZXJhdG9yID0gb3BlcmF0b3JzW29wZXJhdG9ycy5sZW5ndGggLSAxXTtcblx0XHRpZiAobGFzdE9wZXJhdG9yICYmIGxhc3RPcGVyYXRvci5vdXRPcHRpb25zJCkge1xuXHRcdFx0dGhpcy5sb2FkaW5nJCA9IGxhc3RPcGVyYXRvci5vdXRPcHRpb25zJC5waXBlKFxuXHRcdFx0XHRmaXJzdCgpLFxuXHRcdFx0XHRtYXAoKCkgPT4gZmFsc2UpLFxuXHRcdFx0XHRzdGFydFdpdGgodHJ1ZSksXG5cdFx0XHRcdHNoYXJlUmVwbGF5KCksXG5cdFx0XHQpO1xuXHRcdH1cblx0XHRzdXBlci5vbk9wZW4oKTtcblx0fVxuXHRvdmVycmlkZSBvbkNsb3NlKCkge1xuXHRcdHRoaXMuX29uQ2xvc2VTdWJzY3JpYmVycy5mb3JFYWNoKChvOiBJTHVPbkNsb3NlU3Vic2NyaWJlcikgPT4ge1xuXHRcdFx0by5vbkNsb3NlKCk7XG5cdFx0fSk7XG5cdFx0c3VwZXIub25DbG9zZSgpO1xuXHR9XG5cdG92ZXJyaWRlIHNldFZhbHVlKHZhbHVlOiBUIHwgVFtdKSB7XG5cdFx0c3VwZXIuc2V0VmFsdWUodmFsdWUpO1xuXHRcdHRoaXMuX3NlbGVjdG9ycy5mb3JFYWNoKChzKSA9PiBzLnNldFZhbHVlKHZhbHVlKSk7XG5cdH1cblx0cHJvdGVjdGVkIGluaXRPcGVyYXRvcnMoKSB7XG5cdFx0Y29uc3Qgb3BlcmF0b3JzID0gdGhpcy5fb3BlcmF0b3JzUUwudG9BcnJheSgpO1xuXHRcdHRoaXMuX29wZXJhdG9ycyA9IG9wZXJhdG9ycztcblx0XHRsZXQgb3B0aW9ucyQ6IE9ic2VydmFibGU8VFtdPjtcblx0XHRvcGVyYXRvcnMuZm9yRWFjaCgob3BlcmF0b3IpID0+IHtcblx0XHRcdG9wZXJhdG9yLmluT3B0aW9ucyQgPSBvcHRpb25zJDtcblx0XHRcdG9wdGlvbnMkID0gb3BlcmF0b3Iub3V0T3B0aW9ucyQ7XG5cdFx0fSk7XG5cdH1cblx0cHJvdGVjdGVkIGluaXRTZWxlY3RvcnMoKSB7XG5cdFx0Ly8gVE9ETyA6IEZJWCBjaGFuZ2VzIHR5cGVcblx0XHQvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVuc2FmZS1hc3NpZ25tZW50XG5cdFx0Y29uc3Qgc2VsZWN0b3JzJDogT2JzZXJ2YWJsZTxJTHVPcHRpb25TZWxlY3RvcjxUPltdPiA9IHRoaXMuX3NlbGVjdG9yc1FMLmNoYW5nZXMucGlwZShzdGFydFdpdGgodGhpcy5fc2VsZWN0b3JzUUwudG9BcnJheSgpKSk7XG5cdFx0dGhpcy5fc3Vicy5hZGQoXG5cdFx0XHRzZWxlY3RvcnMkLnN1YnNjcmliZSgoc2VsZWN0b3JzKSA9PiB7XG5cdFx0XHRcdHRoaXMuX3NlbGVjdG9ycyA9IHNlbGVjdG9ycztcblx0XHRcdFx0dGhpcy5fc2VsZWN0b3JzLmZvckVhY2goKHMpID0+IHMuc2V0VmFsdWUodGhpcy5fdmFsdWUpKTtcblx0XHRcdFx0dGhpcy5fc3Vicy5hZGQoXG5cdFx0XHRcdFx0bWVyZ2UodGhpcy5fc2VsZWN0b3JzLm1hcCgocykgPT4gcy5vblNlbGVjdFZhbHVlKSlcblx0XHRcdFx0XHRcdC5waXBlKG1lcmdlQWxsKCkpXG5cdFx0XHRcdFx0XHQuc3Vic2NyaWJlKCh2YWx1ZXMpID0+IHtcblx0XHRcdFx0XHRcdFx0dGhpcy5fc2VsZWN0KHZhbHVlcyk7XG5cdFx0XHRcdFx0XHR9KSxcblx0XHRcdFx0KTtcblx0XHRcdH0pLFxuXHRcdCk7XG5cdH1cblx0b3ZlcnJpZGUgbmdBZnRlclZpZXdJbml0KCkge1xuXHRcdHN1cGVyLm5nQWZ0ZXJWaWV3SW5pdCgpO1xuXHRcdHRoaXMuaW5pdE9wZXJhdG9ycygpO1xuXHRcdHRoaXMuaW5pdFNlbGVjdG9ycygpO1xuXHR9XG59XG5cbi8qKlxuICogYWR2YW5jZWQgb3B0aW9uIHBpY2tlciBwYW5lbFxuICovXG5AQ29tcG9uZW50KHtcblx0c2VsZWN0b3I6ICdsdS1vcHRpb24tcGlja2VyLWFkdmFuY2VkJyxcblx0dGVtcGxhdGVVcmw6ICcuL29wdGlvbi1waWNrZXItYWR2YW5jZWQuY29tcG9uZW50Lmh0bWwnLFxuXHRjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcblx0YW5pbWF0aW9uczogW2x1VHJhbnNmb3JtUG9wb3Zlcl0sXG5cdGV4cG9ydEFzOiAnTHVPcHRpb25QaWNrZXJBZHZhbmNlZCcsXG5cdHN0YW5kYWxvbmU6IHRydWUsXG5cdGltcG9ydHM6IFtDb21tb25Nb2R1bGUsIE92ZXJsYXlNb2R1bGUsIEx1T3B0aW9uSXRlbUNvbXBvbmVudCwgTHVTY3JvbGxEaXJlY3RpdmUsIEExMXlNb2R1bGVdLFxuXHRwcm92aWRlcnM6IFtcblx0XHR7XG5cdFx0XHRwcm92aWRlOiBBTHVQaWNrZXJQYW5lbCxcblx0XHRcdHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IEx1T3B0aW9uUGlja2VyQWR2YW5jZWRDb21wb25lbnQpLFxuXHRcdH0sXG5cdF0sXG59KVxuZXhwb3J0IGNsYXNzIEx1T3B0aW9uUGlja2VyQWR2YW5jZWRDb21wb25lbnQ8XG5cdFQsXG5cdE8gZXh0ZW5kcyBpbXBvcnQoJy4uL2l0ZW0vb3B0aW9uLWl0ZW0ubW9kZWwnKS5JTHVPcHRpb25JdGVtPFQ+ID0gaW1wb3J0KCcuLi9pdGVtL29wdGlvbi1pdGVtLm1vZGVsJykuSUx1T3B0aW9uSXRlbTxUPixcbj4gZXh0ZW5kcyBBTHVPcHRpb25QaWNrZXJBZHZhbmNlZENvbXBvbmVudDxULCBPPiB7XG5cdGNvbnN0cnVjdG9yKF9jaGFuZ2VEZXRlY3RvclJlZjogQ2hhbmdlRGV0ZWN0b3JSZWYsIEBJbmplY3QoRE9DVU1FTlQpIGRvY3VtZW50OiBEb2N1bWVudCkge1xuXHRcdHN1cGVyKF9jaGFuZ2VEZXRlY3RvclJlZiwgZG9jdW1lbnQpO1xuXHR9XG59XG4iLCI8bmctdGVtcGxhdGU+XG5cdDxkaXZcblx0XHRjbGFzcz1cImx1LXBpY2tlci1wYW5lbCBsdS1vcHRpb24tcGlja2VyLXBhbmVsXCJcblx0XHRyb2xlPVwiZGlhbG9nXCJcblx0XHRbbmdDbGFzc109XCJwYW5lbENsYXNzZXNNYXBcIlxuXHRcdFtjbGFzcy5tb2QtbXVsdGlwbGVdPVwibXVsdGlwbGVcIlxuXHRcdChjbGljayk9XCJvbkNsaWNrKClcIlxuXHRcdChtb3VzZW92ZXIpPVwib25Nb3VzZU92ZXIoKVwiXG5cdFx0KG1vdXNlbGVhdmUpPVwib25Nb3VzZUxlYXZlKClcIlxuXHRcdChtb3VzZWRvd24pPVwib25Nb3VzZURvd24oKVwiXG5cdD5cblx0XHQ8ZGl2XG5cdFx0XHRbY2xhc3MuaXMtbG9hZGluZ109XCJsb2FkaW5nJCB8IGFzeW5jXCJcblx0XHRcdGNsYXNzPVwibHUtcGlja2VyLWNvbnRlbnRcIlxuXHRcdFx0W25nQ2xhc3NdPVwiY29udGVudENsYXNzZXNNYXBcIlxuXHRcdFx0W2Nka1RyYXBGb2N1c109XCJ0cmFwRm9jdXNcIlxuXHRcdFx0bHVTY3JvbGxcblx0XHRcdChvblNjcm9sbEJvdHRvbSk9XCJvblNjcm9sbEJvdHRvbSgpXCJcblx0XHQ+XG5cdFx0XHQ8bmctY29udGVudD48L25nLWNvbnRlbnQ+XG5cdFx0XHQ8ZGl2ICpuZ0lmPVwibG9hZGluZyQgfCBhc3luY1wiIGNsYXNzPVwibG9hZGluZyBsdS1waWNrZXItbG9hZGluZ1wiPjwvZGl2PlxuXHRcdDwvZGl2PlxuXHQ8L2Rpdj5cbjwvbmctdGVtcGxhdGU+XG4iXX0=