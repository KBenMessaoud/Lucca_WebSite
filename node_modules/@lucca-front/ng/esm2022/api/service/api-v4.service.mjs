import { Injectable } from '@angular/core';
import { map } from 'rxjs/operators';
import { ALuApiService } from './api-service.model';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
class LuApiV4Service extends ALuApiService {
    set api(api) {
        this._api = api;
    }
    set filters(filters) {
        this._filters = filters || [];
    }
    get filters() {
        return this._filters;
    }
    set sort(sort) {
        if (sort) {
            this._sort = `sort=${sort}`;
        }
    }
    constructor(_http) {
        super();
        this._http = _http;
        this._filters = [];
    }
    getAll(filters = []) {
        const query = [...this.filters, ...filters, this._sort].filter((f) => !!f);
        const url = [this._api, query.join('&')].join('?');
        return this._http.get(url).pipe(map((res) => res.items));
    }
    getPaged(page = 0, filters = []) {
        const query = [`page=${page + 1}`, ...this.filters, ...filters, this._sort].filter((f) => !!f);
        const url = [this._api, query.join('&')].join('?');
        return this._http.get(url).pipe(map((res) => res.items));
    }
    searchAll(clue = '', filters = []) {
        if (!clue) {
            return this.getAll(filters);
        }
        const urlSafeClues = clue
            .split(' ')
            .map((c) => encodeURIComponent(c))
            .join(',');
        const query = [`search=${urlSafeClues}`, ...this.filters, ...filters, this._sort].filter((f) => !!f);
        const url = [this._api, query.join('&')].join('?');
        return this._http.get(url).pipe(map((res) => res.items));
    }
    searchPaged(clue = '', page = 0, filters = []) {
        if (!clue) {
            return this.getPaged(page, filters);
        }
        const urlSafeClues = clue
            .split(' ')
            .map((c) => encodeURIComponent(c))
            .join(',');
        const query = [`search=${urlSafeClues}`, `page=${page + 1}`, ...this.filters, ...filters, this._sort].filter((f) => !!f);
        const url = [this._api, query.join('&')].join('?');
        return this._http.get(url).pipe(map((res) => res.items));
    }
    count() {
        const query = [...this.filters, 'fields.root=count', 'limit=0'].filter((f) => !!f);
        const url = [this._api, query.join('&')].join('?');
        return this._http.get(url).pipe(map((res) => res.count));
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.3", ngImport: i0, type: LuApiV4Service, deps: [{ token: i1.HttpClient }], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "16.1.3", ngImport: i0, type: LuApiV4Service }); }
}
export { LuApiV4Service };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.3", ngImport: i0, type: LuApiV4Service, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: i1.HttpClient }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBpLXY0LnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wYWNrYWdlcy9uZy9hcGkvc2VydmljZS9hcGktdjQuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTNDLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUVyQyxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0scUJBQXFCLENBQUM7OztBQUVwRCxNQUNhLGNBQWtELFNBQVEsYUFBZ0I7SUFFdEYsSUFBSSxHQUFHLENBQUMsR0FBVztRQUNsQixJQUFJLENBQUMsSUFBSSxHQUFHLEdBQUcsQ0FBQztJQUNqQixDQUFDO0lBR0QsSUFBSSxPQUFPLENBQUMsT0FBaUI7UUFDNUIsSUFBSSxDQUFDLFFBQVEsR0FBRyxPQUFPLElBQUksRUFBRSxDQUFDO0lBQy9CLENBQUM7SUFDRCxJQUFJLE9BQU87UUFDVixPQUFPLElBQUksQ0FBQyxRQUFRLENBQUM7SUFDdEIsQ0FBQztJQUdELElBQUksSUFBSSxDQUFDLElBQVk7UUFDcEIsSUFBSSxJQUFJLEVBQUU7WUFDVCxJQUFJLENBQUMsS0FBSyxHQUFHLFFBQVEsSUFBSSxFQUFFLENBQUM7U0FDNUI7SUFDRixDQUFDO0lBRUQsWUFBc0IsS0FBaUI7UUFDdEMsS0FBSyxFQUFFLENBQUM7UUFEYSxVQUFLLEdBQUwsS0FBSyxDQUFZO1FBZjdCLGFBQVEsR0FBYSxFQUFFLENBQUM7SUFpQmxDLENBQUM7SUFFRCxNQUFNLENBQUMsVUFBb0IsRUFBRTtRQUM1QixNQUFNLEtBQUssR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLE9BQU8sRUFBRSxHQUFHLE9BQU8sRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENB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dWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBtYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBJTHVBcGlJdGVtIH0gZnJvbSAnLi4vYXBpLm1vZGVsJztcbmltcG9ydCB7IEFMdUFwaVNlcnZpY2UgfSBmcm9tICcuL2FwaS1zZXJ2aWNlLm1vZGVsJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEx1QXBpVjRTZXJ2aWNlPFQgZXh0ZW5kcyBJTHVBcGlJdGVtID0gSUx1QXBpSXRlbT4gZXh0ZW5kcyBBTHVBcGlTZXJ2aWNlPFQ+IHtcblx0cHJvdGVjdGVkIF9hcGk6IHN0cmluZztcblx0c2V0IGFwaShhcGk6IHN0cmluZykge1xuXHRcdHRoaXMuX2FwaSA9IGFwaTtcblx0fVxuXG5cdHByb3RlY3RlZCBfZmlsdGVyczogc3RyaW5nW10gPSBbXTtcblx0c2V0IGZpbHRlcnMoZmlsdGVyczogc3RyaW5nW10pIHtcblx0XHR0aGlzLl9maWx0ZXJzID0gZmlsdGVycyB8fCBbXTtcblx0fVxuXHRnZXQgZmlsdGVycygpOiBzdHJpbmdbXSB7XG5cdFx0cmV0dXJuIHRoaXMuX2ZpbHRlcnM7XG5cdH1cblxuXHRwcm90ZWN0ZWQgX3NvcnQ6IHN0cmluZztcblx0c2V0IHNvcnQoc29ydDogc3RyaW5nKSB7XG5cdFx0aWYgKHNvcnQpIHtcblx0XHRcdHRoaXMuX3NvcnQgPSBgc29ydD0ke3NvcnR9YDtcblx0XHR9XG5cdH1cblxuXHRjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgX2h0dHA6IEh0dHBDbGllbnQpIHtcblx0XHRzdXBlcigpO1xuXHR9XG5cblx0Z2V0QWxsKGZpbHRlcnM6IHN0cmluZ1tdID0gW10pOiBPYnNlcnZhYmxlPFRbXT4ge1xuXHRcdGNvbnN0IHF1ZXJ5ID0gWy4uLnRoaXMuZmlsdGVycywgLi4uZmlsdGVycywgdGhpcy5fc29ydF0uZmlsdGVyKChmKSA9PiAhIWYpO1xuXHRcdGNvbnN0IHVybCA9IFt0aGlzLl9hcGksIHF1ZXJ5LmpvaW4oJyYnKV0uam9pbignPycpO1xuXHRcdHJldHVybiB0aGlzLl9odHRwLmdldDx7IGl0ZW1zOiBUW10gfT4odXJsKS5waXBlKG1hcCgocmVzKSA9PiByZXMuaXRlbXMpKTtcblx0fVxuXHRnZXRQYWdlZChwYWdlID0gMCwgZmlsdGVyczogc3RyaW5nW10gPSBbXSk6IE9ic2VydmFibGU8VFtdPiB7XG5cdFx0Y29uc3QgcXVlcnkgPSBbYHBhZ2U9JHtwYWdlICsgMX1gLCAuLi50aGlzLmZpbHRlcnMsIC4uLmZpbHRlcnMsIHRoaXMuX3NvcnRdLmZpbHRlcigoZikgPT4gISFmKTtcblx0XHRjb25zdCB1cmwgPSBbdGhpcy5fYXBpLCBxdWVyeS5qb2luKCcmJyldLmpvaW4oJz8nKTtcblx0XHRyZXR1cm4gdGhpcy5faHR0cC5nZXQ8eyBpdGVtczogVFtdIH0+KHVybCkucGlwZShtYXAoKHJlcykgPT4gcmVzLml0ZW1zKSk7XG5cdH1cblx0c2VhcmNoQWxsKGNsdWUgPSAnJywgZmlsdGVyczogc3RyaW5nW10gPSBbXSk6IE9ic2VydmFibGU8VFtdPiB7XG5cdFx0aWYgKCFjbHVlKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5nZXRBbGwoZmlsdGVycyk7XG5cdFx0fVxuXHRcdGNvbnN0IHVybFNhZmVDbHVlcyA9IGNsdWVcblx0XHRcdC5zcGxpdCgnICcpXG5cdFx0XHQubWFwKChjKSA9PiBlbmNvZGVVUklDb21wb25lbnQoYykpXG5cdFx0XHQuam9pbignLCcpO1xuXHRcdGNvbnN0IHF1ZXJ5ID0gW2BzZWFyY2g9JHt1cmxTYWZlQ2x1ZXN9YCwgLi4udGhpcy5maWx0ZXJzLCAuLi5maWx0ZXJzLCB0aGlzLl9zb3J0XS5maWx0ZXIoKGYpID0+ICEhZik7XG5cdFx0Y29uc3QgdXJsID0gW3RoaXMuX2FwaSwgcXVlcnkuam9pbignJicpXS5qb2luKCc/Jyk7XG5cdFx0cmV0dXJuIHRoaXMuX2h0dHAuZ2V0PHsgaXRlbXM6IFRbXSB9Pih1cmwpLnBpcGUobWFwKChyZXMpID0+IHJlcy5pdGVtcykpO1xuXHR9XG5cdHNlYXJjaFBhZ2VkKGNsdWUgPSAnJywgcGFnZSA9IDAsIGZpbHRlcnM6IHN0cmluZ1tdID0gW10pOiBPYnNlcnZhYmxlPFRbXT4ge1xuXHRcdGlmICghY2x1ZSkge1xuXHRcdFx0cmV0dXJuIHRoaXMuZ2V0UGFnZWQocGFnZSwgZmlsdGVycyk7XG5cdFx0fVxuXHRcdGNvbnN0IHVybFNhZmVDbHVlcyA9IGNsdWVcblx0XHRcdC5zcGxpdCgnICcpXG5cdFx0XHQubWFwKChjKSA9PiBlbmNvZGVVUklDb21wb25lbnQoYykpXG5cdFx0XHQuam9pbignLCcpO1xuXHRcdGNvbnN0IHF1ZXJ5ID0gW2BzZWFyY2g9JHt1cmxTYWZlQ2x1ZXN9YCwgYHBhZ2U9JHtwYWdlICsgMX1gLCAuLi50aGlzLmZpbHRlcnMsIC4uLmZpbHRlcnMsIHRoaXMuX3NvcnRdLmZpbHRlcigoZikgPT4gISFmKTtcblx0XHRjb25zdCB1cmwgPSBbdGhpcy5fYXBpLCBxdWVyeS5qb2luKCcmJyldLmpvaW4oJz8nKTtcblx0XHRyZXR1cm4gdGhpcy5faHR0cC5nZXQ8eyBpdGVtczogVFtdIH0+KHVybCkucGlwZShtYXAoKHJlcykgPT4gcmVzLml0ZW1zKSk7XG5cdH1cblx0Y291bnQoKTogT2JzZXJ2YWJsZTxudW1iZXI+IHtcblx0XHRjb25zdCBxdWVyeSA9IFsuLi50aGlzLmZpbHRlcnMsICdmaWVsZHMucm9vdD1jb3VudCcsICdsaW1pdD0wJ10uZmlsdGVyKChmKSA9PiAhIWYpO1xuXHRcdGNvbnN0IHVybCA9IFt0aGlzLl9hcGksIHF1ZXJ5LmpvaW4oJyYnKV0uam9pbignPycpO1xuXHRcdHJldHVybiB0aGlzLl9odHRwLmdldDx7IGNvdW50OiBudW1iZXIgfT4odXJsKS5waXBlKG1hcCgocmVzKSA9PiByZXMuY291bnQpKTtcblx0fVxufVxuIl19