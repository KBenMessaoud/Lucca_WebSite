import { A11yModule, ActiveDescendantKeyManager } from '@angular/cdk/a11y';
import { AsyncPipe, NgFor, NgIf } from '@angular/common';
import { ChangeDetectionStrategy, Component, HostListener, inject, ViewChild, ViewChildren } from '@angular/core';
import { FormsModule } from '@angular/forms';
import { getIntl } from '@lucca-front/ng/core';
import { LuSelectPanelRef, SELECT_ID, ɵLuOptionComponent } from '@lucca-front/ng/core-select';
import { asyncScheduler, filter, map, observeOn, take, takeUntil } from 'rxjs';
import { SIMPLE_SELECT_PANEL_DATA } from '../select.model';
import { LU_SIMPLE_SELECT_TRANSLATIONS } from '../select.translate';
import * as i0 from "@angular/core";
import * as i1 from "@angular/cdk/a11y";
import * as i2 from "@angular/forms";
class LuSelectPanelComponent {
    constructor() {
        this.panelData = inject(SIMPLE_SELECT_PANEL_DATA);
        this.panelRef = inject(LuSelectPanelRef);
        this.selectId = inject(SELECT_ID);
        this.intl = getIntl(LU_SIMPLE_SELECT_TRANSLATIONS);
        this.options$ = this.panelData.options$;
        this.loading$ = this.panelData.loading$;
        this.optionComparer = this.panelData.optionComparer;
        this.initialValue = this.panelData.initialValue;
        this.optionTpl = this.panelData.optionTpl;
        this.searchable = this.panelData.searchable;
        this.search = null;
    }
    set searchInput(input) {
        if (!input) {
            return;
        }
        setTimeout(() => input.nativeElement.focus());
    }
    get selected() {
        return this.keyManager?.activeItem?.option;
    }
    onScroll(evt) {
        if (!(evt.target instanceof HTMLElement)) {
            return;
        }
        if (evt.target.scrollTop === 0) {
            this.panelRef.previousPage.emit();
        }
        if (evt.target.scrollHeight - evt.target.scrollTop - evt.target.clientHeight < 1) {
            this.panelRef.nextPage.emit();
        }
    }
    ngAfterViewInit() {
        if (!this.optionsQL) {
            return;
        }
        this.keyManager = new ActiveDescendantKeyManager(this.optionsQL).withHomeAndEnd();
        if (this.initialValue) {
            this.options$
                ?.pipe(observeOn(asyncScheduler), map((options) => options.findIndex((o) => this.optionComparer(o, this.initialValue))), filter((index) => index !== -1), take(1), takeUntil(this.panelRef.closed))
                .subscribe((selectedIndex) => this.keyManager.setActiveItem(selectedIndex));
        }
        this.keyManager.change
            .pipe(map(() => this.keyManager.activeItem?.id), takeUntil(this.panelRef.closed))
            .subscribe((activeDescendant) => this.panelRef.activeOptionIdChanged.emit(activeDescendant));
    }
    onKeyDown($event) {
        switch ($event.key) {
            case 'Escape':
            case 'Tab':
                return this.panelRef.close();
            case 'Enter':
                return this.panelRef.emitValue(this.selected);
            default:
                this.keyManager?.onKeydown($event);
        }
    }
    updateClue(clue) {
        this.search = clue;
        this.panelRef.clueChanged.emit(clue);
        setTimeout(() => this.keyManager.setFirstItemActive());
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.3", ngImport: i0, type: LuSelectPanelComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.1.3", type: LuSelectPanelComponent, isStandalone: true, selector: "lu-select-panel", host: { listeners: { "keydown": "onKeyDown($event)" } }, viewQueries: [{ propertyName: "searchInput", first: true, predicate: ["searchInput"], descendants: true }, { propertyName: "optionsQL", predicate: ɵLuOptionComponent, descendants: true }], ngImport: i0, template: "<div\n\tclass=\"lu-picker-panel lu-option-picker-panel\"\n\trole=\"dialog\"\n\tcdkTrapFocus\n\t*ngIf=\"{ options: options$ | async } as ctx\"\n\t[cdkTrapFocusAutoCapture]=\"true\"\n>\n\t<div class=\"lu-picker-content\" [class.is-loading]=\"loading$ | async\" tabindex=\"0\" (scroll)=\"onScroll($event)\">\n\t\t<ng-container *ngIf=\"searchable\">\n\t\t\t<div class=\"panel-search textfield mod-search\">\n\t\t\t\t<input #searchInput class=\"textfield-input\" [ngModel]=\"search\" (ngModelChange)=\"updateClue($event)\" />\n\t\t\t</div>\n\n\t\t\t<div class=\"optionPlaceholder\" *ngIf=\"search && !ctx.options?.length\">\n\t\t\t\t<p class=\"optionPlaceholder-content u-marginBottom0\">{{ intl.emptyResults }}</p>\n\t\t\t\t<button type=\"button\" class=\"link\" (click)=\"updateClue(null); searchInput.focus()\">{{ intl.clearSearch }}</button>\n\t\t\t</div>\n\t\t</ng-container>\n\t\t<div class=\"lu-picker-content-option\">\n\t\t\t<lu-select-option\n\t\t\t\t*ngFor=\"let option of ctx.options; let index = index\"\n\t\t\t\t[option]=\"option\"\n\t\t\t\t[optionTpl]=\"optionTpl\"\n\t\t\t\t[optionIndex]=\"index\"\n\t\t\t\t[scrollIntoViewOptions]=\"{ block: 'center' }\"\n\t\t\t\t[isSelected]=\"option === selected\"\n\t\t\t\t(click)=\"panelRef.emitValue(option)\"\n\t\t\t></lu-select-option>\n\t\t</div>\n\n\t\t<div *ngIf=\"loading$ | async\" class=\"panel-loading loading lu-picker-loading\"></div>\n\t</div>\n</div>\n", styles: [":root{--components-options-item-padding-vertical: var(--spacings-XS);--components-options-item-padding-horizontal: var(--spacings-XS);--components-options-item-multiple-padding: 2.25rem;--components-options-item-icon-color: var(--palettes-grey-800);--components-options-checkbox-left: .5rem;--components-options-checkbox-size: 1.25rem;--components-options-checkbox-color: var(--palettes-primary-700);--components-options-checkbox-border-radius: 6px;--components-options-checkbox-border-color: var(--palettes-grey-700);--components-options-establishment-multiple-padding: 2rem}.textfield.mod-search{width:100%}.textfield-input{outline:none}.checkbox.mod-formerEmployee{padding:var(--spacings-XXS) var(--components-options-item-padding-horizontal);border-bottom:var(--commons-divider-width) solid var(--commons-divider-color);background-color:var(--palettes-grey-50);font-style:italic}.optionPlaceholder{display:block;padding:var(--components-options-item-padding-vertical) var(--components-options-item-padding-horizontal);font-style:italic;color:var(--palettes-grey-600)}.panel-search{position:sticky;top:0;box-shadow:0 -4px 0 var(--spacings-XS) var(--colors-white-color)}.panel-loading:after{box-shadow:0 0 0 .25rem var(--colors-white-color),inset 0 0 0 .5rem var(--colors-white-color)}\n"], dependencies: [{ kind: "ngmodule", type: A11yModule }, { kind: "directive", type: i1.CdkTrapFocus, selector: "[cdkTrapFocus]", inputs: ["cdkTrapFocus", "cdkTrapFocusAutoCapture"], exportAs: ["cdkTrapFocus"] }, { kind: "pipe", type: AsyncPipe, name: "async" }, { kind: "ngmodule", type: FormsModule }, { kind: "directive", type: i2.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { kind: "directive", type: i2.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i2.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }, { kind: "directive", type: NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: NgFor, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "component", type: ɵLuOptionComponent, selector: "lu-select-option", inputs: ["optionTpl", "isSelected", "option", "optionIndex", "scrollIntoViewOptions"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
export { LuSelectPanelComponent };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.3", ngImport: i0, type: LuSelectPanelComponent, decorators: [{
            type: Component,
            args: [{ selector: 'lu-select-panel', changeDetection: ChangeDetectionStrategy.OnPush, standalone: true, imports: [A11yModule, AsyncPipe, FormsModule, NgIf, NgFor, ɵLuOptionComponent], template: "<div\n\tclass=\"lu-picker-panel lu-option-picker-panel\"\n\trole=\"dialog\"\n\tcdkTrapFocus\n\t*ngIf=\"{ options: options$ | async } as ctx\"\n\t[cdkTrapFocusAutoCapture]=\"true\"\n>\n\t<div class=\"lu-picker-content\" [class.is-loading]=\"loading$ | async\" tabindex=\"0\" (scroll)=\"onScroll($event)\">\n\t\t<ng-container *ngIf=\"searchable\">\n\t\t\t<div class=\"panel-search textfield mod-search\">\n\t\t\t\t<input #searchInput class=\"textfield-input\" [ngModel]=\"search\" (ngModelChange)=\"updateClue($event)\" />\n\t\t\t</div>\n\n\t\t\t<div class=\"optionPlaceholder\" *ngIf=\"search && !ctx.options?.length\">\n\t\t\t\t<p class=\"optionPlaceholder-content u-marginBottom0\">{{ intl.emptyResults }}</p>\n\t\t\t\t<button type=\"button\" class=\"link\" (click)=\"updateClue(null); searchInput.focus()\">{{ intl.clearSearch }}</button>\n\t\t\t</div>\n\t\t</ng-container>\n\t\t<div class=\"lu-picker-content-option\">\n\t\t\t<lu-select-option\n\t\t\t\t*ngFor=\"let option of ctx.options; let index = index\"\n\t\t\t\t[option]=\"option\"\n\t\t\t\t[optionTpl]=\"optionTpl\"\n\t\t\t\t[optionIndex]=\"index\"\n\t\t\t\t[scrollIntoViewOptions]=\"{ block: 'center' }\"\n\t\t\t\t[isSelected]=\"option === selected\"\n\t\t\t\t(click)=\"panelRef.emitValue(option)\"\n\t\t\t></lu-select-option>\n\t\t</div>\n\n\t\t<div *ngIf=\"loading$ | async\" class=\"panel-loading loading lu-picker-loading\"></div>\n\t</div>\n</div>\n", styles: [":root{--components-options-item-padding-vertical: var(--spacings-XS);--components-options-item-padding-horizontal: var(--spacings-XS);--components-options-item-multiple-padding: 2.25rem;--components-options-item-icon-color: var(--palettes-grey-800);--components-options-checkbox-left: .5rem;--components-options-checkbox-size: 1.25rem;--components-options-checkbox-color: var(--palettes-primary-700);--components-options-checkbox-border-radius: 6px;--components-options-checkbox-border-color: var(--palettes-grey-700);--components-options-establishment-multiple-padding: 2rem}.textfield.mod-search{width:100%}.textfield-input{outline:none}.checkbox.mod-formerEmployee{padding:var(--spacings-XXS) var(--components-options-item-padding-horizontal);border-bottom:var(--commons-divider-width) solid var(--commons-divider-color);background-color:var(--palettes-grey-50);font-style:italic}.optionPlaceholder{display:block;padding:var(--components-options-item-padding-vertical) var(--components-options-item-padding-horizontal);font-style:italic;color:var(--palettes-grey-600)}.panel-search{position:sticky;top:0;box-shadow:0 -4px 0 var(--spacings-XS) var(--colors-white-color)}.panel-loading:after{box-shadow:0 0 0 .25rem var(--colors-white-color),inset 0 0 0 .5rem var(--colors-white-color)}\n"] }]
        }], propDecorators: { searchInput: [{
                type: ViewChild,
                args: ['searchInput']
            }], optionsQL: [{
                type: ViewChildren,
                args: [ɵLuOptionComponent]
            }], onKeyDown: [{
                type: HostListener,
                args: ['keydown', ['$event']]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFuZWwuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcGFja2FnZXMvbmcvc2ltcGxlLXNlbGVjdC9wYW5lbC9wYW5lbC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi9wYWNrYWdlcy9uZy9zaW1wbGUtc2VsZWN0L3BhbmVsL3BhbmVsLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUMzRSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUN6RCxPQUFPLEVBQWlCLHVCQUF1QixFQUFFLFNBQVMsRUFBYyxZQUFZLEVBQUUsTUFBTSxFQUFhLFNBQVMsRUFBRSxZQUFZLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDeEosT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzdDLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUMvQyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsU0FBUyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDOUYsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQy9FLE9BQU8sRUFBNEIsd0JBQXdCLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUNyRixPQUFPLEVBQUUsNkJBQTZCLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQzs7OztBQUVwRSxNQVFhLHNCQUFzQjtJQVJuQztRQVNXLGNBQVMsR0FBRyxNQUFNLENBQThCLHdCQUF3QixDQUFDLENBQUM7UUFDN0UsYUFBUSxHQUFHLE1BQU0sQ0FBeUIsZ0JBQWdCLENBQUMsQ0FBQztRQUM1RCxhQUFR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QyxhQUFhO2dCQVNVLFNBQVM7c0JBQTFDLFlBQVk7dUJBQUMsa0JBQWtCO2dCQW1EaEMsU0FBUztzQkFEUixZQUFZO3VCQUFDLFNBQVMsRUFBRSxDQUFDLFFBQVEsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEExMXlNb2R1bGUsIEFjdGl2ZURlc2NlbmRhbnRLZXlNYW5hZ2VyIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2ExMXknO1xuaW1wb3J0IHsgQXN5bmNQaXBlLCBOZ0ZvciwgTmdJZiB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQgeyBBZnRlclZpZXdJbml0LCBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBIb3N0TGlzdGVuZXIsIGluamVjdCwgUXVlcnlMaXN0LCBWaWV3Q2hpbGQsIFZpZXdDaGlsZHJlbiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRm9ybXNNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBnZXRJbnRsIH0gZnJvbSAnQGx1Y2NhLWZyb250L25nL2NvcmUnO1xuaW1wb3J0IHsgTHVTZWxlY3RQYW5lbFJlZiwgU0VMRUNUX0lELCDJtUx1T3B0aW9uQ29tcG9uZW50IH0gZnJvbSAnQGx1Y2NhLWZyb250L25nL2NvcmUtc2VsZWN0JztcbmltcG9ydCB7IGFzeW5jU2NoZWR1bGVyLCBmaWx0ZXIsIG1hcCwgb2JzZXJ2ZU9uLCB0YWtlLCB0YWtlVW50aWwgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IElMdVNpbXBsZVNlbGVjdFBhbmVsRGF0YSwgU0lNUExFX1NFTEVDVF9QQU5FTF9EQVRBIH0gZnJvbSAnLi4vc2VsZWN0Lm1vZGVsJztcbmltcG9ydCB7IExVX1NJTVBMRV9TRUxFQ1RfVFJBTlNMQVRJT05TIH0gZnJvbSAnLi4vc2VsZWN0LnRyYW5zbGF0ZSc7XG5cbkBDb21wb25lbnQoe1xuXHRzZWxlY3RvcjogJ2x1LXNlbGVjdC1wYW5lbCcsXG5cdHRlbXBsYXRlVXJsOiAnLi9wYW5lbC5jb21wb25lbnQuaHRtbCcsXG5cdHN0eWxlVXJsczogWycuL3BhbmVsLmNvbXBvbmVudC5zY3NzJ10sXG5cdGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuXHRzdGFuZGFsb25lOiB0cnVlLFxuXHRpbXBvcnRzOiBbQTExeU1vZHVsZSwgQXN5bmNQaXBlLCBGb3Jtc01vZHVsZSwgTmdJZiwgTmdGb3IsIMm1THVPcHRpb25Db21wb25lbnRdLFxufSlcbmV4cG9ydCBjbGFzcyBMdVNlbGVjdFBhbmVsQ29tcG9uZW50PFQ+IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCB7XG5cdHByb3RlY3RlZCBwYW5lbERhdGEgPSBpbmplY3Q8SUx1U2ltcGxlU2VsZWN0UGFuZWxEYXRhPFQ+PihTSU1QTEVfU0VMRUNUX1BBTkVMX0RBVEEpO1xuXHRwdWJsaWMgcGFuZWxSZWYgPSBpbmplY3Q8THVTZWxlY3RQYW5lbFJlZjxULCBUPj4oTHVTZWxlY3RQYW5lbFJlZik7XG5cdHB1YmxpYyBzZWxlY3RJZCA9IGluamVjdChTRUxFQ1RfSUQpO1xuXHRwdWJsaWMgaW50bCA9IGdldEludGwoTFVfU0lNUExFX1NFTEVDVF9UUkFOU0xBVElPTlMpO1xuXG5cdG9wdGlvbnMkID0gdGhpcy5wYW5lbERhdGEub3B0aW9ucyQ7XG5cdGxvYWRpbmckID0gdGhpcy5wYW5lbERhdGEubG9hZGluZyQ7XG5cdG9wdGlvbkNvbXBhcmVyID0gdGhpcy5wYW5lbERhdGEub3B0aW9uQ29tcGFyZXI7XG5cdGluaXRpYWxWYWx1ZTogVCB8IHVuZGVmaW5lZCA9IHRoaXMucGFuZWxEYXRhLmluaXRpYWxWYWx1ZTtcblx0b3B0aW9uVHBsID0gdGhpcy5wYW5lbERhdGEub3B0aW9uVHBsO1xuXHRzZWFyY2hhYmxlID0gdGhpcy5wYW5lbERhdGEuc2VhcmNoYWJsZTtcblxuXHRAVmlld0NoaWxkKCdzZWFyY2hJbnB1dCcpXG5cdHB1YmxpYyBzZXQgc2VhcmNoSW5wdXQoaW5wdXQ6IEVsZW1lbnRSZWY8SFRNTElucHV0RWxlbWVudD4gfCB1bmRlZmluZWQpIHtcblx0XHRpZiAoIWlucHV0KSB7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0c2V0VGltZW91dCgoKSA9PiBpbnB1dC5uYXRpdmVFbGVtZW50LmZvY3VzKCkpO1xuXHR9XG5cblx0QFZpZXdDaGlsZHJlbijJtUx1T3B0aW9uQ29tcG9uZW50KSBvcHRpb25zUUw6IFF1ZXJ5TGlzdDzJtUx1T3B0aW9uQ29tcG9uZW50PFQ+Pjtcblx0cHJpdmF0ZSBrZXlNYW5hZ2VyOiBBY3RpdmVEZXNjZW5kYW50S2V5TWFuYWdlcjzJtUx1T3B0aW9uQ29tcG9uZW50PFQ+PjtcblxuXHRzZWFyY2g6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuXG5cdHB1YmxpYyBnZXQgc2VsZWN0ZWQoKTogVCB8IHVuZGVmaW5lZCB7XG5cdFx0cmV0dXJuIHRoaXMua2V5TWFuYWdlcj8uYWN0aXZlSXRlbT8ub3B0aW9uO1xuXHR9XG5cblx0b25TY3JvbGwoZXZ0OiBFdmVudCk6IHZvaWQge1xuXHRcdGlmICghKGV2dC50YXJnZXQgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkpIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHRpZiAoZXZ0LnRhcmdldC5zY3JvbGxUb3AgPT09IDApIHtcblx0XHRcdHRoaXMucGFuZWxSZWYucHJldmlvdXNQYWdlLmVtaXQoKTtcblx0XHR9XG5cblx0XHRpZiAoZXZ0LnRhcmdldC5zY3JvbGxIZWlnaHQgLSBldnQudGFyZ2V0LnNjcm9sbFRvcCAtIGV2dC50YXJnZXQuY2xpZW50SGVpZ2h0IDwgMSkge1xuXHRcdFx0dGhpcy5wYW5lbFJlZi5uZXh0UGFnZS5lbWl0KCk7XG5cdFx0fVxuXHR9XG5cblx0bmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xuXHRcdGlmICghdGhpcy5vcHRpb25zUUwpIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHR0aGlzLmtleU1hbmFnZXIgPSBuZXcgQWN0aXZlRGVzY2VuZGFudEtleU1hbmFnZXIodGhpcy5vcHRpb25zUUwpLndpdGhIb21lQW5kRW5kKCk7XG5cblx0XHRpZiAodGhpcy5pbml0aWFsVmFsdWUpIHtcblx0XHRcdHRoaXMub3B0aW9ucyRcblx0XHRcdFx0Py5waXBlKFxuXHRcdFx0XHRcdG9ic2VydmVPbihhc3luY1NjaGVkdWxlciksXG5cdFx0XHRcdFx0bWFwKChvcHRpb25zKSA9PiBvcHRpb25zLmZpbmRJbmRleCgobykgPT4gdGhpcy5vcHRpb25Db21wYXJlcihvLCB0aGlzLmluaXRpYWxWYWx1ZSkpKSxcblx0XHRcdFx0XHRmaWx0ZXIoKGluZGV4KSA9PiBpbmRleCAhPT0gLTEpLFxuXHRcdFx0XHRcdHRha2UoMSksXG5cdFx0XHRcdFx0dGFrZVVudGlsKHRoaXMucGFuZWxSZWYuY2xvc2VkKSxcblx0XHRcdFx0KVxuXHRcdFx0XHQuc3Vic2NyaWJlKChzZWxlY3RlZEluZGV4KSA9PiB0aGlzLmtleU1hbmFnZXIuc2V0QWN0aXZlSXRlbShzZWxlY3RlZEluZGV4KSk7XG5cdFx0fVxuXG5cdFx0dGhpcy5rZXlNYW5hZ2VyLmNoYW5nZVxuXHRcdFx0LnBpcGUoXG5cdFx0XHRcdG1hcCgoKSA9PiB0aGlzLmtleU1hbmFnZXIuYWN0aXZlSXRlbT8uaWQpLFxuXHRcdFx0XHR0YWtlVW50aWwodGhpcy5wYW5lbFJlZi5jbG9zZWQpLFxuXHRcdFx0KVxuXHRcdFx0LnN1YnNjcmliZSgoYWN0aXZlRGVzY2VuZGFudCkgPT4gdGhpcy5wYW5lbFJlZi5hY3RpdmVPcHRpb25JZENoYW5nZWQuZW1pdChhY3RpdmVEZXNjZW5kYW50KSk7XG5cdH1cblxuXHRASG9zdExpc3RlbmVyKCdrZXlkb3duJywgWyckZXZlbnQnXSlcblx0b25LZXlEb3duKCRldmVudDogS2V5Ym9hcmRFdmVudCk6IHZvaWQge1xuXHRcdHN3aXRjaCAoJGV2ZW50LmtleSkge1xuXHRcdFx0Y2FzZSAnRXNjYXBlJzpcblx0XHRcdGNhc2UgJ1RhYic6XG5cdFx0XHRcdHJldHVybiB0aGlzLnBhbmVsUmVmLmNsb3NlKCk7XG5cdFx0XHRjYXNlICdFbnRlcic6XG5cdFx0XHRcdHJldHVybiB0aGlzLnBhbmVsUmVmLmVtaXRWYWx1ZSh0aGlzLnNlbGVjdGVkKTtcblx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdHRoaXMua2V5TWFuYWdlcj8ub25LZXlkb3duKCRldmVudCk7XG5cdFx0fVxuXHR9XG5cblx0dXBkYXRlQ2x1ZShjbHVlOiBzdHJpbmcgfCBudWxsKTogdm9pZCB7XG5cdFx0dGhpcy5zZWFyY2ggPSBjbHVlO1xuXHRcdHRoaXMucGFuZWxSZWYuY2x1ZUNoYW5nZWQuZW1pdChjbHVlKTtcblxuXHRcdHNldFRpbWVvdXQoKCkgPT4gdGhpcy5rZXlNYW5hZ2VyLnNldEZpcnN0SXRlbUFjdGl2ZSgpKTtcblx0fVxufVxuIiwiPGRpdlxuXHRjbGFzcz1cImx1LXBpY2tlci1wYW5lbCBsdS1vcHRpb24tcGlja2VyLXBhbmVsXCJcblx0cm9sZT1cImRpYWxvZ1wiXG5cdGNka1RyYXBGb2N1c1xuXHQqbmdJZj1cInsgb3B0aW9uczogb3B0aW9ucyQgfCBhc3luYyB9IGFzIGN0eFwiXG5cdFtjZGtUcmFwRm9jdXNBdXRvQ2FwdHVyZV09XCJ0cnVlXCJcbj5cblx0PGRpdiBjbGFzcz1cImx1LXBpY2tlci1jb250ZW50XCIgW2NsYXNzLmlzLWxvYWRpbmddPVwibG9hZGluZyQgfCBhc3luY1wiIHRhYmluZGV4PVwiMFwiIChzY3JvbGwpPVwib25TY3JvbGwoJGV2ZW50KVwiPlxuXHRcdDxuZy1jb250YWluZXIgKm5nSWY9XCJzZWFyY2hhYmxlXCI+XG5cdFx0XHQ8ZGl2IGNsYXNzPVwicGFuZWwtc2VhcmNoIHRleHRmaWVsZCBtb2Qtc2VhcmNoXCI+XG5cdFx0XHRcdDxpbnB1dCAjc2VhcmNoSW5wdXQgY2xhc3M9XCJ0ZXh0ZmllbGQtaW5wdXRcIiBbbmdNb2RlbF09XCJzZWFyY2hcIiAobmdNb2RlbENoYW5nZSk9XCJ1cGRhdGVDbHVlKCRldmVudClcIiAvPlxuXHRcdFx0PC9kaXY+XG5cblx0XHRcdDxkaXYgY2xhc3M9XCJvcHRpb25QbGFjZWhvbGRlclwiICpuZ0lmPVwic2VhcmNoICYmICFjdHgub3B0aW9ucz8ubGVuZ3RoXCI+XG5cdFx0XHRcdDxwIGNsYXNzPVwib3B0aW9uUGxhY2Vob2xkZXItY29udGVudCB1LW1hcmdpbkJvdHRvbTBcIj57eyBpbnRsLmVtcHR5UmVzdWx0cyB9fTwvcD5cblx0XHRcdFx0PGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJsaW5rXCIgKGNsaWNrKT1cInVwZGF0ZUNsdWUobnVsbCk7IHNlYXJjaElucHV0LmZvY3VzKClcIj57eyBpbnRsLmNsZWFyU2VhcmNoIH19PC9idXR0b24+XG5cdFx0XHQ8L2Rpdj5cblx0XHQ8L25nLWNvbnRhaW5lcj5cblx0XHQ8ZGl2IGNsYXNzPVwibHUtcGlja2VyLWNvbnRlbnQtb3B0aW9uXCI+XG5cdFx0XHQ8bHUtc2VsZWN0LW9wdGlvblxuXHRcdFx0XHQqbmdGb3I9XCJsZXQgb3B0aW9uIG9mIGN0eC5vcHRpb25zOyBsZXQgaW5kZXggPSBpbmRleFwiXG5cdFx0XHRcdFtvcHRpb25dPVwib3B0aW9uXCJcblx0XHRcdFx0W29wdGlvblRwbF09XCJvcHRpb25UcGxcIlxuXHRcdFx0XHRbb3B0aW9uSW5kZXhdPVwiaW5kZXhcIlxuXHRcdFx0XHRbc2Nyb2xsSW50b1ZpZXdPcHRpb25zXT1cInsgYmxvY2s6ICdjZW50ZXInIH1cIlxuXHRcdFx0XHRbaXNTZWxlY3RlZF09XCJvcHRpb24gPT09IHNlbGVjdGVkXCJcblx0XHRcdFx0KGNsaWNrKT1cInBhbmVsUmVmLmVtaXRWYWx1ZShvcHRpb24pXCJcblx0XHRcdD48L2x1LXNlbGVjdC1vcHRpb24+XG5cdFx0PC9kaXY+XG5cblx0XHQ8ZGl2ICpuZ0lmPVwibG9hZGluZyQgfCBhc3luY1wiIGNsYXNzPVwicGFuZWwtbG9hZGluZyBsb2FkaW5nIGx1LXBpY2tlci1sb2FkaW5nXCI+PC9kaXY+XG5cdDwvZGl2PlxuPC9kaXY+XG4iXX0=