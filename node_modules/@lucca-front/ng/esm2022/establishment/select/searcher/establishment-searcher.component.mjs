/* eslint-disable max-len */
import { CommonModule } from '@angular/common';
import { ChangeDetectionStrategy, Component, ElementRef, EventEmitter, forwardRef, HostBinding, Inject, Input, Optional, Output, Self, SkipSelf, ViewChild } from '@angular/core';
import { FormControl, ReactiveFormsModule } from '@angular/forms';
import { ALuOnCloseSubscriber, ALuOnOpenSubscriber, ALuOnScrollBottomSubscriber } from '@lucca-front/ng/core';
import { ALuOptionOperator, LuOptionPlaceholderComponent } from '@lucca-front/ng/option';
import { of, Subject } from 'rxjs';
import { catchError, debounceTime, map, scan, share, startWith, switchMap, takeWhile, tap } from 'rxjs/operators';
import { ALuEstablishmentService, LuEstablishmentService } from '../../service/index';
import * as i0 from "@angular/core";
import * as i1 from "@angular/forms";
import * as i2 from "@angular/common";
import * as i3 from "../../service/index";
class LuEstablishmentSearcherComponent {
    set filters(filters) {
        this._service.filters = filters;
    }
    set appInstanceId(appId) {
        this._service.appInstanceId = appId;
    }
    set operations(ops) {
        this._service.operations = ops;
    }
    set sort(sort) {
        this._service.sort = sort;
    }
    constructor(hostService, selfService) {
        this.fixed = true;
        this.isSearching = new EventEmitter();
        this._isSearching = false;
        this.clueControl = new FormControl('');
        this.loading = false;
        this._nextPage$ = new Subject();
        this._page$ = this._nextPage$.pipe(scan((acc) => acc + 1, 0), startWith(0));
        this._resetOutOptions = new Subject();
        this.outOptions$ = this._resetOutOptions.pipe(startWith(undefined), switchMap(() => this.clueControl.valueChanges.pipe(debounceTime(100), switchMap((clue) => this._page$.pipe(tap(() => (this.loading = true)), tap(() => {
            // FIXME refactor, add some spec anywhere
            const isSearching = clue != null && clue !== '';
            if (this._isSearching !== isSearching) {
                this._isSearching = isSearching;
                this.isSearching.emit(this._isSearching);
            }
        }), switchMap((page) => this._service.searchPaged(clue, page).pipe(catchError(() => of([])))), takeWhile((loadedItems) => !!loadedItems.length), scan((acc, next) => [...acc, ...next]))), tap(() => (this.loading = false)))), share());
        this.displayPlaceholder$ = this.outOptions$.pipe(map((o) => o?.length === 0 && this._isSearching));
        this._service = hostService || selfService;
    }
    onOpen() {
        this.searchInput.nativeElement.focus();
        this.reset();
    }
    onScrollBottom() {
        if (!this.loading) {
            this._nextPage$.next();
        }
    }
    onClose() {
        this._resetOutOptions.next();
    }
    reset() {
        this.clueControl.reset();
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.3", ngImport: i0, type: LuEstablishmentSearcherComponent, deps: [{ token: ALuEstablishmentService, optional: true, skipSelf: true }, { token: ALuEstablishmentService, self: true }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "16.1.3", type: LuEstablishmentSearcherComponent, isStandalone: true, selector: "lu-establishment-searcher", inputs: { filters: "filters", appInstanceId: "appInstanceId", operations: "operations", sort: "sort" }, outputs: { isSearching: "isSearching" }, host: { properties: { "class.position-fixed": "this.fixed" } }, providers: [
            {
                provide: ALuOptionOperator,
                useExisting: forwardRef(() => LuEstablishmentSearcherComponent),
                multi: true,
            },
            {
                provide: ALuOnOpenSubscriber,
                useExisting: forwardRef(() => LuEstablishmentSearcherComponent),
                multi: true,
            },
            {
                provide: ALuOnCloseSubscriber,
                useExisting: forwardRef(() => LuEstablishmentSearcherComponent),
                multi: true,
            },
            {
                provide: ALuOnScrollBottomSubscriber,
                useExisting: forwardRef(() => LuEstablishmentSearcherComponent),
                multi: true,
            },
            {
                provide: ALuEstablishmentService,
                useClass: LuEstablishmentService,
            },
        ], viewQueries: [{ propertyName: "searchInput", first: true, predicate: ["searchInput"], descendants: true, read: ElementRef, static: true }], ngImport: i0, template: "<form>\n\t<div class=\"textfield mod-search\" [class.is-loading]=\"loading\">\n\t\t<input #searchInput class=\"textfield-input\" [formControl]=\"clueControl\" />\n\t</div>\n</form>\n\n<lu-option-placeholder *ngIf=\"displayPlaceholder$ | async\" (onClear)=\"reset()\"></lu-option-placeholder>\n", styles: [":root{--components-options-item-padding-vertical: var(--spacings-XS);--components-options-item-padding-horizontal: var(--spacings-XS);--components-options-item-multiple-padding: 2.25rem;--components-options-item-icon-color: var(--palettes-grey-800);--components-options-checkbox-left: .5rem;--components-options-checkbox-size: 1.25rem;--components-options-checkbox-color: var(--palettes-primary-700);--components-options-checkbox-border-radius: 6px;--components-options-checkbox-border-color: var(--palettes-grey-700);--components-options-establishment-multiple-padding: 2rem}.textfield.mod-search{width:100%}.textfield-input{outline:none}.checkbox.mod-formerEmployee{padding:var(--spacings-XXS) var(--components-options-item-padding-horizontal);border-bottom:var(--commons-divider-width) solid var(--commons-divider-color);background-color:var(--palettes-grey-50);font-style:italic}\n"], dependencies: [{ kind: "ngmodule", type: ReactiveFormsModule }, { kind: "directive", type: i1.ɵNgNoValidate, selector: "form:not([ngNoForm]):not([ngNativeValidate])" }, { kind: "directive", type: i1.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { kind: "directive", type: i1.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i1.NgControlStatusGroup, selector: "[formGroupName],[formArrayName],[ngModelGroup],[formGroup],form:not([ngNoForm]),[ngForm]" }, { kind: "directive", type: i1.FormControlDirective, selector: "[formControl]", inputs: ["formControl", "disabled", "ngModel"], outputs: ["ngModelChange"], exportAs: ["ngForm"] }, { kind: "ngmodule", type: CommonModule }, { kind: "directive", type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "pipe", type: i2.AsyncPipe, name: "async" }, { kind: "component", type: LuOptionPlaceholderComponent, selector: "lu-option-placeholder", outputs: ["onClear"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
export { LuEstablishmentSearcherComponent };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.3", ngImport: i0, type: LuEstablishmentSearcherComponent, decorators: [{
            type: Component,
            args: [{ selector: 'lu-establishment-searcher', changeDetection: ChangeDetectionStrategy.OnPush, standalone: true, imports: [ReactiveFormsModule, CommonModule, LuOptionPlaceholderComponent], providers: [
                        {
                            provide: ALuOptionOperator,
                            useExisting: forwardRef(() => LuEstablishmentSearcherComponent),
                            multi: true,
                        },
                        {
                            provide: ALuOnOpenSubscriber,
                            useExisting: forwardRef(() => LuEstablishmentSearcherComponent),
                            multi: true,
                        },
                        {
                            provide: ALuOnCloseSubscriber,
                            useExisting: forwardRef(() => LuEstablishmentSearcherComponent),
                            multi: true,
                        },
                        {
                            provide: ALuOnScrollBottomSubscriber,
                            useExisting: forwardRef(() => LuEstablishmentSearcherComponent),
                            multi: true,
                        },
                        {
                            provide: ALuEstablishmentService,
                            useClass: LuEstablishmentService,
                        },
                    ], template: "<form>\n\t<div class=\"textfield mod-search\" [class.is-loading]=\"loading\">\n\t\t<input #searchInput class=\"textfield-input\" [formControl]=\"clueControl\" />\n\t</div>\n</form>\n\n<lu-option-placeholder *ngIf=\"displayPlaceholder$ | async\" (onClear)=\"reset()\"></lu-option-placeholder>\n", styles: [":root{--components-options-item-padding-vertical: var(--spacings-XS);--components-options-item-padding-horizontal: var(--spacings-XS);--components-options-item-multiple-padding: 2.25rem;--components-options-item-icon-color: var(--palettes-grey-800);--components-options-checkbox-left: .5rem;--components-options-checkbox-size: 1.25rem;--components-options-checkbox-color: var(--palettes-primary-700);--components-options-checkbox-border-radius: 6px;--components-options-checkbox-border-color: var(--palettes-grey-700);--components-options-establishment-multiple-padding: 2rem}.textfield.mod-search{width:100%}.textfield-input{outline:none}.checkbox.mod-formerEmployee{padding:var(--spacings-XXS) var(--components-options-item-padding-horizontal);border-bottom:var(--commons-divider-width) solid var(--commons-divider-color);background-color:var(--palettes-grey-50);font-style:italic}\n"] }]
        }], ctorParameters: function () { return [{ type: i3.LuEstablishmentService, decorators: [{
                    type: Inject,
                    args: [ALuEstablishmentService]
                }, {
                    type: Optional
                }, {
                    type: SkipSelf
                }] }, { type: i3.LuEstablishmentService, decorators: [{
                    type: Inject,
                    args: [ALuEstablishmentService]
                }, {
                    type: Self
                }] }]; }, propDecorators: { filters: [{
                type: Input
            }], appInstanceId: [{
                type: Input
            }], operations: [{
                type: Input
            }], sort: [{
                type: Input
            }], fixed: [{
                type: HostBinding,
                args: ['class.position-fixed']
            }], searchInput: [{
                type: ViewChild,
                args: ['searchInput', { read: ElementRef, static: true }]
            }], isSearching: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXN0YWJsaXNobWVudC1zZWFyY2hlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wYWNrYWdlcy9uZy9lc3RhYmxpc2htZW50L3NlbGVjdC9zZWFyY2hlci9lc3RhYmxpc2htZW50LXNlYXJjaGVyLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL25nL2VzdGFibGlzaG1lbnQvc2VsZWN0L3NlYXJjaGVyL2VzdGFibGlzaG1lbnQtc2VhcmNoZXIuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsNEJBQTRCO0FBQzVCLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMvQyxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsVUFBVSxFQUFFLFdBQVcsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbEwsT0FBTyxFQUFFLFdBQVcsRUFBRSxtQkFBbUIsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ2xFLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxtQkFBbUIsRUFBRSwyQkFBMkIsRUFBMEUsTUFBTSxzQkFBc0IsQ0FBQztBQUN0TCxPQUFPLEVBQUUsaUJBQWlCLEVBQXFCLDRCQUE0QixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDNUcsT0FBTyxFQUFjLEVBQUUsRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0MsT0FBTyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFbEgsT0FBTyxFQUFFLHVC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bUVDLE1BQU07MkJBQUMsdUJBQXVCOzswQkFDOUIsUUFBUTs7MEJBQ1IsUUFBUTs7MEJBRVIsTUFBTTsyQkFBQyx1QkFBdUI7OzBCQUM5QixJQUFJOzRDQXJFTyxPQUFPO3NCQUFuQixLQUFLO2dCQUdPLGFBQWE7c0JBQXpCLEtBQUs7Z0JBR08sVUFBVTtzQkFBdEIsS0FBSztnQkFHTyxJQUFJO3NCQUFoQixLQUFLO2dCQU0rQixLQUFLO3NCQUF6QyxXQUFXO3VCQUFDLHNCQUFzQjtnQkFFbkMsV0FBVztzQkFEVixTQUFTO3VCQUFDLGFBQWEsRUFBRSxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTtnQkFJNUQsV0FBVztzQkFEVixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgbWF4LWxlbiAqL1xuaW1wb3J0IHsgQ29tbW9uTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IENoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDb21wb25lbnQsIEVsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciwgZm9yd2FyZFJlZiwgSG9zdEJpbmRpbmcsIEluamVjdCwgSW5wdXQsIE9wdGlvbmFsLCBPdXRwdXQsIFNlbGYsIFNraXBTZWxmLCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEZvcm1Db250cm9sLCBSZWFjdGl2ZUZvcm1zTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgQUx1T25DbG9zZVN1YnNjcmliZXIsIEFMdU9uT3BlblN1YnNjcmliZXIsIEFMdU9uU2Nyb2xsQm90dG9tU3Vic2NyaWJlciwgSUx1T25DbG9zZVN1YnNjcmliZXIsIElMdU9uT3BlblN1YnNjcmliZXIsIElMdU9uU2Nyb2xsQm90dG9tU3Vic2NyaWJlciB9IGZyb20gJ0BsdWNjYS1mcm9udC9uZy9jb3JlJztcbmltcG9ydCB7IEFMdU9wdGlvbk9wZXJhdG9yLCBJTHVPcHRpb25PcGVyYXRvciwgTHVPcHRpb25QbGFjZWhvbGRlckNvbXBvbmVudCB9IGZyb20gJ0BsdWNjYS1mcm9udC9uZy9vcHRpb24nO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgb2YsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGNhdGNoRXJyb3IsIGRlYm91bmNlVGltZSwgbWFwLCBzY2FuLCBzaGFyZSwgc3RhcnRXaXRoLCBzd2l0Y2hNYXAsIHRha2VXaGlsZSwgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgSUx1RXN0YWJsaXNobWVudCB9IGZyb20gJy4uLy4uL2VzdGFibGlzaG1lbnQubW9kZWwnO1xuaW1wb3J0IHsgQUx1RXN0YWJsaXNobWVudFNlcnZpY2UsIEx1RXN0YWJsaXNobWVudFNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlL2luZGV4JztcblxuQENvbXBvbmVudCh7XG5cdHNlbGVjdG9yOiAnbHUtZXN0YWJsaXNobWVudC1zZWFyY2hlcicsXG5cdHRlbXBsYXRlVXJsOiAnZXN0YWJsaXNobWVudC1zZWFyY2hlci5jb21wb25lbnQuaHRtbCcsXG5cdHN0eWxlVXJsczogWydlc3RhYmxpc2htZW50LXNlYXJjaGVyLmNvbXBvbmVudC5zY3NzJ10sXG5cdGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuXHRzdGFuZGFsb25lOiB0cnVlLFxuXHRpbXBvcnRzOiBbUmVhY3RpdmVGb3Jtc01vZHVsZSwgQ29tbW9uTW9kdWxlLCBMdU9wdGlvblBsYWNlaG9sZGVyQ29tcG9uZW50XSxcblx0cHJvdmlkZXJzOiBbXG5cdFx0e1xuXHRcdFx0cHJvdmlkZTogQUx1T3B0aW9uT3BlcmF0b3IsXG5cdFx0XHR1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBMdUVzdGFibGlzaG1lbnRTZWFyY2hlckNvbXBvbmVudCksXG5cdFx0XHRtdWx0aTogdHJ1ZSxcblx0XHR9LFxuXHRcdHtcblx0XHRcdHByb3ZpZGU6IEFMdU9uT3BlblN1YnNjcmliZXIsXG5cdFx0XHR1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBMdUVzdGFibGlzaG1lbnRTZWFyY2hlckNvbXBvbmVudCksXG5cdFx0XHRtdWx0aTogdHJ1ZSxcblx0XHR9LFxuXHRcdHtcblx0XHRcdHByb3ZpZGU6IEFMdU9uQ2xvc2VTdWJzY3JpYmVyLFxuXHRcdFx0dXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gTHVFc3RhYmxpc2htZW50U2VhcmNoZXJDb21wb25lbnQpLFxuXHRcdFx0bXVsdGk6IHRydWUsXG5cdFx0fSxcblx0XHR7XG5cdFx0XHRwcm92aWRlOiBBTHVPblNjcm9sbEJvdHRvbVN1YnNjcmliZXIsXG5cdFx0XHR1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBMdUVzdGFibGlzaG1lbnRTZWFyY2hlckNvbXBvbmVudCksXG5cdFx0XHRtdWx0aTogdHJ1ZSxcblx0XHR9LFxuXHRcdHtcblx0XHRcdHByb3ZpZGU6IEFMdUVzdGFibGlzaG1lbnRTZXJ2aWNlLFxuXHRcdFx0dXNlQ2xhc3M6IEx1RXN0YWJsaXNobWVudFNlcnZpY2UsXG5cdFx0fSxcblx0XSxcbn0pXG5leHBvcnQgY2xhc3MgTHVFc3RhYmxpc2htZW50U2VhcmNoZXJDb21wb25lbnQgaW1wbGVtZW50cyBJTHVPbk9wZW5TdWJzY3JpYmVyLCBJTHVPblNjcm9sbEJvdHRvbVN1YnNjcmliZXIsIElMdU9uQ2xvc2VTdWJzY3JpYmVyLCBJTHVPcHRpb25PcGVyYXRvcjxJTHVFc3RhYmxpc2htZW50PiB7XG5cdEBJbnB1dCgpIHNldCBmaWx0ZXJzKGZpbHRlcnM6IHN0cmluZ1tdKSB7XG5cdFx0dGhpcy5fc2VydmljZS5maWx0ZXJzID0gZmlsdGVycztcblx0fVxuXHRASW5wdXQoKSBzZXQgYXBwSW5zdGFuY2VJZChhcHBJZDogbnVtYmVyKSB7XG5cdFx0dGhpcy5fc2VydmljZS5hcHBJbnN0YW5jZUlkID0gYXBwSWQ7XG5cdH1cblx0QElucHV0KCkgc2V0IG9wZXJhdGlvbnMob3BzOiBudW1iZXJbXSkge1xuXHRcdHRoaXMuX3NlcnZpY2Uub3BlcmF0aW9ucyA9IG9wcztcblx0fVxuXHRASW5wdXQoKSBzZXQgc29ydChzb3J0OiBzdHJpbmcpIHtcblx0XHR0aGlzLl9zZXJ2aWNlLnNvcnQgPSBzb3J0O1xuXHR9XG5cblx0cHJpdmF0ZSBfc2VydmljZTogTHVFc3RhYmxpc2htZW50U2VydmljZTtcblxuXHRASG9zdEJpbmRpbmcoJ2NsYXNzLnBvc2l0aW9uLWZpeGVkJykgZml4ZWQgPSB0cnVlO1xuXHRAVmlld0NoaWxkKCdzZWFyY2hJbnB1dCcsIHsgcmVhZDogRWxlbWVudFJlZiwgc3RhdGljOiB0cnVlIH0pXG5cdHNlYXJjaElucHV0OiBFbGVtZW50UmVmPEhUTUxFbGVtZW50PjtcblxuXHRAT3V0cHV0KClcblx0aXNTZWFyY2hpbmcgPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KCk7XG5cdHByaXZhdGUgX2lzU2VhcmNoaW5nID0gZmFsc2U7XG5cblx0Y2x1ZUNvbnRyb2wgPSBuZXcgRm9ybUNvbnRyb2w8c3RyaW5nPignJyk7XG5cblx0bG9hZGluZyA9IGZhbHNlO1xuXG5cdHByaXZhdGUgX25leHRQYWdlJCA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XG5cdHByaXZhdGUgX3BhZ2UkOiBPYnNlcnZhYmxlPG51bWJlcj4gPSB0aGlzLl9uZXh0UGFnZSQucGlwZShcblx0XHRzY2FuKChhY2MpID0+IGFjYyArIDEsIDApLFxuXHRcdHN0YXJ0V2l0aCgwKSxcblx0KTtcblx0cHJpdmF0ZSBfcmVzZXRPdXRPcHRpb25zID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcblxuXHRvdXRPcHRpb25zJCA9IHRoaXMuX3Jlc2V0T3V0T3B0aW9ucy5waXBlKFxuXHRcdHN0YXJ0V2l0aCh1bmRlZmluZWQpLFxuXHRcdHN3aXRjaE1hcCgoKSA9PlxuXHRcdFx0dGhpcy5jbHVlQ29udHJvbC52YWx1ZUNoYW5nZXMucGlwZShcblx0XHRcdFx0ZGVib3VuY2VUaW1lKDEwMCksXG5cdFx0XHRcdHN3aXRjaE1hcCgoY2x1ZSkgPT5cblx0XHRcdFx0XHR0aGlzLl9wYWdlJC5waXBlKFxuXHRcdFx0XHRcdFx0dGFwKCgpID0+ICh0aGlzLmxvYWRpbmcgPSB0cnVlKSksXG5cdFx0XHRcdFx0XHR0YXAoKCkgPT4ge1xuXHRcdFx0XHRcdFx0XHQvLyBGSVhNRSByZWZhY3RvciwgYWRkIHNvbWUgc3BlYyBhbnl3aGVyZVxuXHRcdFx0XHRcdFx0XHRjb25zdCBpc1NlYXJjaGluZyA9IGNsdWUgIT0gbnVsbCAmJiBjbHVlICE9PSAnJztcblx0XHRcdFx0XHRcdFx0aWYgKHRoaXMuX2lzU2VhcmNoaW5nICE9PSBpc1NlYXJjaGluZykge1xuXHRcdFx0XHRcdFx0XHRcdHRoaXMuX2lzU2VhcmNoaW5nID0gaXNTZWFyY2hpbmc7XG5cdFx0XHRcdFx0XHRcdFx0dGhpcy5pc1NlYXJjaGluZy5lbWl0KHRoaXMuX2lzU2VhcmNoaW5nKTtcblx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0fSksXG5cdFx0XHRcdFx0XHRzd2l0Y2hNYXAoKHBhZ2UpID0+IHRoaXMuX3NlcnZpY2Uuc2VhcmNoUGFnZWQoY2x1ZSwgcGFnZSkucGlwZShjYXRjaEVycm9yKCgpID0+IG9mKFtdIGFzIElMdUVzdGFibGlzaG1lbnRbXSkpKSksXG5cdFx0XHRcdFx0XHR0YWtlV2hpbGUoKGxvYWRlZEl0ZW1zKSA9PiAhIWxvYWRlZEl0ZW1zLmxlbmd0aCksXG5cdFx0XHRcdFx0XHRzY2FuKChhY2MsIG5leHQpID0+IFsuLi5hY2MsIC4uLm5leHRdKSxcblx0XHRcdFx0XHQpLFxuXHRcdFx0XHQpLFxuXHRcdFx0XHR0YXAoKCkgPT4gKHRoaXMubG9hZGluZyA9IGZhbHNlKSksXG5cdFx0XHQpLFxuXHRcdCksXG5cdFx0c2hhcmUoKSxcblx0KTtcblxuXHRkaXNwbGF5UGxhY2Vob2xkZXIkID0gdGhpcy5vdXRPcHRpb25zJC5waXBlKG1hcCgobykgPT4gbz8ubGVuZ3RoID09PSAwICYmIHRoaXMuX2lzU2VhcmNoaW5nKSk7XG5cblx0Y29uc3RydWN0b3IoXG5cdFx0QEluamVjdChBTHVFc3RhYmxpc2htZW50U2VydmljZSlcblx0XHRAT3B0aW9uYWwoKVxuXHRcdEBTa2lwU2VsZigpXG5cdFx0aG9zdFNlcnZpY2U6IEx1RXN0YWJsaXNobWVudFNlcnZpY2UsXG5cdFx0QEluamVjdChBTHVFc3RhYmxpc2htZW50U2VydmljZSlcblx0XHRAU2VsZigpXG5cdFx0c2VsZlNlcnZpY2U6IEx1RXN0YWJsaXNobWVudFNlcnZpY2UsXG5cdCkge1xuXHRcdHRoaXMuX3NlcnZpY2UgPSBob3N0U2VydmljZSB8fCBzZWxmU2VydmljZTtcblx0fVxuXG5cdG9uT3BlbigpIHtcblx0XHR0aGlzLnNlYXJjaElucHV0Lm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcblx0XHR0aGlzLnJlc2V0KCk7XG5cdH1cblxuXHRvblNjcm9sbEJvdHRvbSgpIHtcblx0XHRpZiAoIXRoaXMubG9hZGluZykge1xuXHRcdFx0dGhpcy5fbmV4dFBhZ2UkLm5leHQoKTtcblx0XHR9XG5cdH1cblxuXHRvbkNsb3NlKCkge1xuXHRcdHRoaXMuX3Jlc2V0T3V0T3B0aW9ucy5uZXh0KCk7XG5cdH1cblxuXHRyZXNldCgpIHtcblx0XHR0aGlzLmNsdWVDb250cm9sLnJlc2V0KCk7XG5cdH1cbn1cbiIsIjxmb3JtPlxuXHQ8ZGl2IGNsYXNzPVwidGV4dGZpZWxkIG1vZC1zZWFyY2hcIiBbY2xhc3MuaXMtbG9hZGluZ109XCJsb2FkaW5nXCI+XG5cdFx0PGlucHV0ICNzZWFyY2hJbnB1dCBjbGFzcz1cInRleHRmaWVsZC1pbnB1dFwiIFtmb3JtQ29udHJvbF09XCJjbHVlQ29udHJvbFwiIC8+XG5cdDwvZGl2PlxuPC9mb3JtPlxuXG48bHUtb3B0aW9uLXBsYWNlaG9sZGVyICpuZ0lmPVwiZGlzcGxheVBsYWNlaG9sZGVyJCB8IGFzeW5jXCIgKG9uQ2xlYXIpPVwicmVzZXQoKVwiPjwvbHUtb3B0aW9uLXBsYWNlaG9sZGVyPlxuIl19