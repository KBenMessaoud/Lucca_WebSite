import { ComponentPortal } from '@angular/cdk/portal';
import { Directive, EventEmitter, HostBinding, HostListener, Input, Output } from '@angular/core';
import { ALuPopoverTrigger, LuPopoverTarget } from '@lucca-front/ng/popover';
import { LuTooltipPanelComponent } from '../panel/tooltip-panel.component';
import * as i0 from "@angular/core";
import * as i1 from "@angular/cdk/overlay";
class LuTooltipTriggerDirective extends ALuPopoverTrigger {
    set tooltipContent(c) {
        if (this.panel) {
            this.panel.content = c;
        }
        this._tooltipContent = c;
    }
    /** when trigger = hover, delay before the popover panel appears, default 300ms */
    set inputEnterDelay(d) {
        this.enterDelay = d;
    }
    /** when trigger = hover, delay before the popover panel disappears, default 100ms */
    set inputLeaveDelay(d) {
        this.leaveDelay = d;
    }
    /** disable popover apparition */
    set inputDisabled(d) {
        this.disabled = d;
        if (this._handleTabindex) {
            this._setTabindex(d ? null : 0);
        }
    }
    set inputPosition(pos) {
        this.target.position = pos;
    }
    set inputWhenEllipsis(we) {
        this.whenEllipsis = we;
    }
    onMouseEnter() {
        super.onMouseEnter();
    }
    onMouseLeave() {
        super.onMouseLeave();
    }
    onFocus() {
        super.onFocus();
    }
    onBlur() {
        super.onBlur();
    }
    // @HostBinding('attr.tabindex') tabindex;
    // private set tabindex(i: number = null) {
    // }
    /** accessibility attribute - dont override */
    get _attrId() {
        return this._triggerId;
    }
    /** accessibility attribute - dont override */
    get _attrAriaDescribedBy() {
        return this._panelId;
    }
    constructor(_overlay, _elementRef, _viewContainerRef) {
        super(_overlay, _elementRef, _viewContainerRef);
        this._overlay = _overlay;
        this._elementRef = _elementRef;
        this._viewContainerRef = _viewContainerRef;
        // FIXME output native
        /** Event emitted when the associated popover is opened. */
        // eslint-disable-next-line @angular-eslint/no-output-on-prefix
        this.onOpen = new EventEmitter();
        /** Event emitted when the associated popover is closed. */
        // eslint-disable-next-line @angular-eslint/no-output-on-prefix
        this.onClose = new EventEmitter();
        this._handleTabindex = false;
        this._tooltipContent = '';
        this.target = new LuPopoverTarget();
        this.target.elementRef = this._elementRef;
        this._triggerId = this._elementRef.nativeElement.getAttribute('id') || this._triggerId;
        this.triggerEvent = 'hover';
        this.target.position = 'above';
        this.enterDelay = 300;
        this.leaveDelay = 100;
        this._handleTabindex = this._shouldHandleTabindex();
        if (this._handleTabindex) {
            this._setTabindex(0);
        }
    }
    ngAfterViewInit() {
        this._checkTarget();
    }
    ngOnDestroy() {
        this._cleanUpSubscriptions();
        if (this._popoverOpen) {
            this.closePopover();
        }
        this.destroyPopover();
    }
    _emitOpen() {
        this.onOpen.emit();
    }
    _emitClose() {
        this.onClose.emit();
    }
    _createOverlay() {
        if (!this._overlayRef) {
            this._portal = new ComponentPortal(LuTooltipPanelComponent, this._viewContainerRef);
            const config = this._getOverlayConfig();
            this._subscribeToPositions(config.positionStrategy);
            this._overlayRef = this._overlay.create(config);
        }
        return this._overlayRef;
    }
    _attachPortalToOverlay() {
        const componentRef = this._overlayRef.attach(this._portal);
        this._panel = componentRef.instance;
        this._panel.content = this._tooltipContent;
    }
    _getPanelScrollStrategy() {
        return 'close';
    }
    _shouldHandleTabindex() {
        const tag = this._elementRef.nativeElement.tagName?.toLowerCase();
        // https://allyjs.io/data-tables/focusable.html
        // i'm choosing to not support area and iframe, dont @ me
        const nativelyFocusableTags = ['a', 'button', 'input', 'select', 'textarea'];
        const isNatevelyFocusableTag = nativelyFocusableTags.includes(tag);
        const hasATabIndex = this._elementRef.nativeElement.getAttribute('tabindex') !== null;
        return !isNatevelyFocusableTag && !hasATabIndex;
    }
    _setTabindex(i = null) {
        this._elementRef.nativeElement.setAttribute('tabindex', `${i}`);
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.1.3", ngImport: i0, type: LuTooltipTriggerDirective, deps: [{ token: i1.Overlay }, { token: i0.ElementRef }, { token: i0.ViewContainerRef }], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "16.1.3", type: LuTooltipTriggerDirective, isStandalone: true, selector: "[luTooltip]", inputs: { tooltipContent: ["luTooltip", "tooltipContent"], inputEnterDelay: ["luTooltipEnterDelay", "inputEnterDelay"], inputLeaveDelay: ["luTooltipLeaveDelay", "inputLeaveDelay"], inputDisabled: ["luTooltipDisabled", "inputDisabled"], inputPosition: ["luTooltipPosition", "inputPosition"], inputWhenEllipsis: ["luTooltipWhenEllipsis", "inputWhenEllipsis"] }, outputs: { onOpen: "luTooltipOnOpen", onClose: "luTooltipOnClose" }, host: { listeners: { "mouseenter": "onMouseEnter()", "mouseleave": "onMouseLeave()", "focus": "onFocus()", "blur": "onBlur()" }, properties: { "attr.id": "this._attrId", "attr.aria-describedby": "this._attrAriaDescribedBy" } }, usesInheritance: true, ngImport: i0 }); }
}
export { LuTooltipTriggerDirective };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.1.3", ngImport: i0, type: LuTooltipTriggerDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[luTooltip]',
                    standalone: true,
                }]
        }], ctorParameters: function () { return [{ type: i1.Overlay }, { type: i0.ElementRef }, { type: i0.ViewContainerRef }]; }, propDecorators: { tooltipContent: [{
                type: Input,
                args: ['luTooltip']
            }], inputEnterDelay: [{
                type: Input,
                args: ['luTooltipEnterDelay']
            }], inputLeaveDelay: [{
                type: Input,
                args: ['luTooltipLeaveDelay']
            }], inputDisabled: [{
                type: Input,
                args: ['luTooltipDisabled']
            }], inputPosition: [{
                type: Input,
                args: ['luTooltipPosition']
            }], inputWhenEllipsis: [{
                type: Input,
                args: ['luTooltipWhenEllipsis']
            }], onOpen: [{
                type: Output,
                args: ['luTooltipOnOpen']
            }], onClose: [{
                type: Output,
                args: ['luTooltipOnClose']
            }], onMouseEnter: [{
                type: HostListener,
                args: ['mouseenter']
            }], onMouseLeave: [{
                type: HostListener,
                args: ['mouseleave']
            }], onFocus: [{
                type: HostListener,
                args: ['focus']
            }], onBlur: [{
                type: HostListener,
                args: ['blur']
            }], _attrId: [{
                type: HostBinding,
                args: ['attr.id']
            }], _attrAriaDescribedBy: [{
                type: HostBinding,
                args: ['attr.aria-describedby']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9vbHRpcC10cmlnZ2VyLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL25nL3Rvb2x0aXAvdHJpZ2dlci90b29sdGlwLXRyaWdnZXIuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUN0RCxPQUFPLEVBQWlCLFNBQVMsRUFBYyxZQUFZLEVBQUUsV0FBVyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQWEsTUFBTSxFQUFvQixNQUFNLGVBQWUsQ0FBQztBQUUxSixPQUFPLEVBQUUsaUJBQWlCLEVBQThDLGVBQWUsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQ3pILE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxNQUFNLGtDQUFrQyxDQUFDOzs7QUFFM0UsTUFJYSx5QkFBMEIsU0FBUSxpQkFBMkQ7SUFDekcsSUFBd0IsY0FBYyxDQUFDLENBQW9CO1FBQzFELElBQUksSUFBSSxDQUFDLEtBQUssRUFBRTtZQUNmLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxHQUFHLENBQUMsQ0FBQztTQUN2QjtRQUVELElBQUksQ0FBQyxlQUFlLEdBQUcsQ0FBQyxDQUFDO0lBQzFCLENBQUM7SUFDRCxrRkFBa0Y7SUFDbEYsSUFBa0MsZUFBZSxDQUFDLENBQVM7UUFDMUQsSUFBSSxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUM7SUFDckIsQ0FBQztJQUNELHFGQUFxRjtJQUNyRixJQUFrQyxlQUFlLENBQUMsQ0FBUztRQUMxRCxJQUFJLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQztJQUNyQixDQUFDO0lBQ0QsaUNBQWlDO0lBQ2pDLElBQWdDLGFBQWEsQ0FBQyxDQUFVO1FBQ3ZELElBQUksQ0FBQyxRQUFRLEdBQUcsQ0FBQyxDQUFDO1FBQ2xCLElBQUksSUFBSSxDQUFDLGVBQWUsRUFBRTtZQUN6QixJQUFJLENBQUMsWUFBWSxD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UG9zaXRpb25TdHJhdGVneSwgT3ZlcmxheSwgT3ZlcmxheVJlZiB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9vdmVybGF5JztcbmltcG9ydCB7IENvbXBvbmVudFBvcnRhbCB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9wb3J0YWwnO1xuaW1wb3J0IHsgQWZ0ZXJWaWV3SW5pdCwgRGlyZWN0aXZlLCBFbGVtZW50UmVmLCBFdmVudEVtaXR0ZXIsIEhvc3RCaW5kaW5nLCBIb3N0TGlzdGVuZXIsIElucHV0LCBPbkRlc3Ryb3ksIE91dHB1dCwgVmlld0NvbnRhaW5lclJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgU2FmZUh0bWwgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyJztcbmltcG9ydCB7IEFMdVBvcG92ZXJUcmlnZ2VyLCBMdVBvcG92ZXJQb3NpdGlvbiwgTHVQb3BvdmVyU2Nyb2xsU3RyYXRlZ3ksIEx1UG9wb3ZlclRhcmdldCB9IGZyb20gJ0BsdWNjYS1mcm9udC9uZy9wb3BvdmVyJztcbmltcG9ydCB7IEx1VG9vbHRpcFBhbmVsQ29tcG9uZW50IH0gZnJvbSAnLi4vcGFuZWwvdG9vbHRpcC1wYW5lbC5jb21wb25lbnQnO1xuXG5ARGlyZWN0aXZlKHtcblx0c2VsZWN0b3I6ICdbbHVUb29sdGlwXScsXG5cdHN0YW5kYWxvbmU6IHRydWUsXG59KVxuZXhwb3J0IGNsYXNzIEx1VG9vbHRpcFRyaWdnZXJEaXJlY3RpdmUgZXh0ZW5kcyBBTHVQb3BvdmVyVHJpZ2dlcjxMdVRvb2x0aXBQYW5lbENvbXBvbmVudCwgTHVQb3BvdmVyVGFyZ2V0PiBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSB7XG5cdEBJbnB1dCgnbHVUb29sdGlwJykgc2V0IHRvb2x0aXBDb250ZW50KGM6IHN0cmluZyB8IFNhZmVIdG1sKSB7XG5cdFx0aWYgKHRoaXMucGFuZWwpIHtcblx0XHRcdHRoaXMucGFuZWwuY29udGVudCA9IGM7XG5cdFx0fVxuXG5cdFx0dGhpcy5fdG9vbHRpcENvbnRlbnQgPSBjO1xuXHR9XG5cdC8qKiB3aGVuIHRyaWdnZXIgPSBob3ZlciwgZGVsYXkgYmVmb3JlIHRoZSBwb3BvdmVyIHBhbmVsIGFwcGVhcnMsIGRlZmF1bHQgMzAwbXMgKi9cblx0QElucHV0KCdsdVRvb2x0aXBFbnRlckRlbGF5Jykgc2V0IGlucHV0RW50ZXJEZWxheShkOiBudW1iZXIpIHtcblx0XHR0aGlzLmVudGVyRGVsYXkgPSBkO1xuXHR9XG5cdC8qKiB3aGVuIHRyaWdnZXIgPSBob3ZlciwgZGVsYXkgYmVmb3JlIHRoZSBwb3BvdmVyIHBhbmVsIGRpc2FwcGVhcnMsIGRlZmF1bHQgMTAwbXMgKi9cblx0QElucHV0KCdsdVRvb2x0aXBMZWF2ZURlbGF5Jykgc2V0IGlucHV0TGVhdmVEZWxheShkOiBudW1iZXIpIHtcblx0XHR0aGlzLmxlYXZlRGVsYXkgPSBkO1xuXHR9XG5cdC8qKiBkaXNhYmxlIHBvcG92ZXIgYXBwYXJpdGlvbiAqL1xuXHRASW5wdXQoJ2x1VG9vbHRpcERpc2FibGVkJykgc2V0IGlucHV0RGlzYWJsZWQoZDogYm9vbGVhbikge1xuXHRcdHRoaXMuZGlzYWJsZWQgPSBkO1xuXHRcdGlmICh0aGlzLl9oYW5kbGVUYWJpbmRleCkge1xuXHRcdFx0dGhpcy5fc2V0VGFiaW5kZXgoZCA/IG51bGwgOiAwKTtcblx0XHR9XG5cdH1cblxuXHRASW5wdXQoJ2x1VG9vbHRpcFBvc2l0aW9uJykgc2V0IGlucHV0UG9zaXRpb24ocG9zOiBMdVBvcG92ZXJQb3NpdGlvbikge1xuXHRcdHRoaXMudGFyZ2V0LnBvc2l0aW9uID0gcG9zO1xuXHR9XG5cblx0QElucHV0KCdsdVRvb2x0aXBXaGVuRWxsaXBzaXMnKSBwdWJsaWMgc2V0IGlucHV0V2hlbkVsbGlwc2lzKHdlOiBib29sZWFuKSB7XG5cdFx0dGhpcy53aGVuRWxsaXBzaXMgPSB3ZTtcblx0fVxuXG5cdC8vIEZJWE1FIG91dHB1dCBuYXRpdmVcblx0LyoqIEV2ZW50IGVtaXR0ZWQgd2hlbiB0aGUgYXNzb2NpYXRlZCBwb3BvdmVyIGlzIG9wZW5lZC4gKi9cblx0Ly8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEBhbmd1bGFyLWVzbGludC9uby1vdXRwdXQtb24tcHJlZml4XG5cdEBPdXRwdXQoJ2x1VG9vbHRpcE9uT3BlbicpIG9uT3BlbiA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcblx0LyoqIEV2ZW50IGVtaXR0ZWQgd2hlbiB0aGUgYXNzb2NpYXRlZCBwb3BvdmVyIGlzIGNsb3NlZC4gKi9cblx0Ly8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEBhbmd1bGFyLWVzbGludC9uby1vdXRwdXQtb24tcHJlZml4XG5cdEBPdXRwdXQoJ2x1VG9vbHRpcE9uQ2xvc2UnKSBvbkNsb3NlID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuXG5cdEBIb3N0TGlzdGVuZXIoJ21vdXNlZW50ZXInKVxuXHRvdmVycmlkZSBvbk1vdXNlRW50ZXIoKSB7XG5cdFx0c3VwZXIub25Nb3VzZUVudGVyKCk7XG5cdH1cblx0QEhvc3RMaXN0ZW5lcignbW91c2VsZWF2ZScpXG5cdG92ZXJyaWRlIG9uTW91c2VMZWF2ZSgpIHtcblx0XHRzdXBlci5vbk1vdXNlTGVhdmUoKTtcblx0fVxuXHRASG9zdExpc3RlbmVyKCdmb2N1cycpXG5cdG92ZXJyaWRlIG9uRm9jdXMoKSB7XG5cdFx0c3VwZXIub25Gb2N1cygpO1xuXHR9XG5cdEBIb3N0TGlzdGVuZXIoJ2JsdXInKVxuXHRvdmVycmlkZSBvbkJsdXIoKSB7XG5cdFx0c3VwZXIub25CbHVyKCk7XG5cdH1cblx0cHJpdmF0ZSBfaGFuZGxlVGFiaW5kZXggPSBmYWxzZTtcblx0Ly8gQEhvc3RCaW5kaW5nKCdhdHRyLnRhYmluZGV4JykgdGFiaW5kZXg7XG5cdC8vIHByaXZhdGUgc2V0IHRhYmluZGV4KGk6IG51bWJlciA9IG51bGwpIHtcblxuXHQvLyB9XG5cblx0LyoqIGFjY2Vzc2liaWxpdHkgYXR0cmlidXRlIC0gZG9udCBvdmVycmlkZSAqL1xuXHRASG9zdEJpbmRpbmcoJ2F0dHIuaWQnKSBnZXQgX2F0dHJJZCgpIHtcblx0XHRyZXR1cm4gdGhpcy5fdHJpZ2dlcklkO1xuXHR9XG5cdC8qKiBhY2Nlc3NpYmlsaXR5IGF0dHJpYnV0ZSAtIGRvbnQgb3ZlcnJpZGUgKi9cblx0QEhvc3RCaW5kaW5nKCdhdHRyLmFyaWEtZGVzY3JpYmVkYnknKSBnZXQgX2F0dHJBcmlhRGVzY3JpYmVkQnkoKSB7XG5cdFx0cmV0dXJuIHRoaXMuX3BhbmVsSWQ7XG5cdH1cblxuXHRwcm90ZWN0ZWQgb3ZlcnJpZGUgX3BvcnRhbDogQ29tcG9uZW50UG9ydGFsPEx1VG9vbHRpcFBhbmVsQ29tcG9uZW50Pjtcblx0cHJvdGVjdGVkIF90b29sdGlwQ29udGVudDogc3RyaW5nIHwgU2FmZUh0bWwgPSAnJztcblxuXHRjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgb3ZlcnJpZGUgX292ZXJsYXk6IE92ZXJsYXksIHByb3RlY3RlZCBvdmVycmlkZSBfZWxlbWVudFJlZjogRWxlbWVudFJlZjxIVE1MRWxlbWVudD4sIHByb3RlY3RlZCBvdmVycmlkZSBfdmlld0NvbnRhaW5lclJlZjogVmlld0NvbnRhaW5lclJlZikge1xuXHRcdHN1cGVyKF9vdmVybGF5LCBfZWxlbWVudFJlZiwgX3ZpZXdDb250YWluZXJSZWYpO1xuXHRcdHRoaXMudGFyZ2V0ID0gbmV3IEx1UG9wb3ZlclRhcmdldCgpO1xuXHRcdHRoaXMudGFyZ2V0LmVsZW1lbnRSZWYgPSB0aGlzLl9lbGVtZW50UmVmO1xuXHRcdHRoaXMuX3RyaWdnZXJJZCA9IHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2lkJykgfHwgdGhpcy5fdHJpZ2dlcklkO1xuXHRcdHRoaXMudHJpZ2dlckV2ZW50ID0gJ2hvdmVyJztcblx0XHR0aGlzLnRhcmdldC5wb3NpdGlvbiA9ICdhYm92ZSc7XG5cdFx0dGhpcy5lbnRlckRlbGF5ID0gMzAwO1xuXHRcdHRoaXMubGVhdmVEZWxheSA9IDEwMDtcblxuXHRcdHRoaXMuX2hhbmRsZVRhYmluZGV4ID0gdGhpcy5fc2hvdWxkSGFuZGxlVGFiaW5kZXgoKTtcblxuXHRcdGlmICh0aGlzLl9oYW5kbGVUYWJpbmRleCkge1xuXHRcdFx0dGhpcy5fc2V0VGFiaW5kZXgoMCk7XG5cdFx0fVxuXHR9XG5cblx0bmdBZnRlclZpZXdJbml0KCkge1xuXHRcdHRoaXMuX2NoZWNrVGFyZ2V0KCk7XG5cdH1cblx0bmdPbkRlc3Ryb3koKSB7XG5cdFx0dGhpcy5fY2xlYW5VcFN1YnNjcmlwdGlvbnMoKTtcblx0XHRpZiAodGhpcy5fcG9wb3Zlck9wZW4pIHtcblx0XHRcdHRoaXMuY2xvc2VQb3BvdmVyKCk7XG5cdFx0fVxuXHRcdHRoaXMuZGVzdHJveVBvcG92ZXIoKTtcblx0fVxuXHRwcm90ZWN0ZWQgX2VtaXRPcGVuKCk6IHZvaWQge1xuXHRcdHRoaXMub25PcGVuLmVtaXQoKTtcblx0fVxuXHRwcm90ZWN0ZWQgX2VtaXRDbG9zZSgpOiB2b2lkIHtcblx0XHR0aGlzLm9uQ2xvc2UuZW1pdCgpO1xuXHR9XG5cblx0cHJvdGVjdGVkIG92ZXJyaWRlIF9jcmVhdGVPdmVybGF5KCk6IE92ZXJsYXlSZWYge1xuXHRcdGlmICghdGhpcy5fb3ZlcmxheVJlZikge1xuXHRcdFx0dGhpcy5fcG9ydGFsID0gbmV3IENvbXBvbmVudFBvcnRhbChMdVRvb2x0aXBQYW5lbENvbXBvbmVudCwgdGhpcy5fdmlld0NvbnRhaW5lclJlZik7XG5cdFx0XHRjb25zdCBjb25maWcgPSB0aGlzLl9nZXRPdmVybGF5Q29uZmlnKCk7XG5cdFx0XHR0aGlzLl9zdWJzY3JpYmVUb1Bvc2l0aW9ucyhjb25maWcucG9zaXRpb25TdHJhdGVneSBhcyBGbGV4aWJsZUNvbm5lY3RlZFBvc2l0aW9uU3RyYXRlZ3kpO1xuXHRcdFx0dGhpcy5fb3ZlcmxheVJlZiA9IHRoaXMuX292ZXJsYXkuY3JlYXRlKGNvbmZpZyk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXMuX292ZXJsYXlSZWY7XG5cdH1cblxuXHRwcm90ZWN0ZWQgb3ZlcnJpZGUgX2F0dGFjaFBvcnRhbFRvT3ZlcmxheSgpOiB2b2lkIHtcblx0XHRjb25zdCBjb21wb25lbnRSZWYgPSB0aGlzLl9vdmVybGF5UmVmLmF0dGFjaCh0aGlzLl9wb3J0YWwpO1xuXHRcdHRoaXMuX3BhbmVsID0gY29tcG9uZW50UmVmLmluc3RhbmNlO1xuXHRcdHRoaXMuX3BhbmVsLmNvbnRlbnQgPSB0aGlzLl90b29sdGlwQ29udGVudDtcblx0fVxuXG5cdHByb3RlY3RlZCBvdmVycmlkZSBfZ2V0UGFuZWxTY3JvbGxTdHJhdGVneSgpOiBMdVBvcG92ZXJTY3JvbGxTdHJhdGVneSB7XG5cdFx0cmV0dXJuICdjbG9zZSc7XG5cdH1cblxuXHRwcml2YXRlIF9zaG91bGRIYW5kbGVUYWJpbmRleCgpOiBib29sZWFuIHtcblx0XHRjb25zdCB0YWcgPSB0aGlzLl9lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQudGFnTmFtZT8udG9Mb3dlckNhc2UoKTtcblx0XHQvLyBodHRwczovL2FsbHlqcy5pby9kYXRhLXRhYmxlcy9mb2N1c2FibGUuaHRtbFxuXHRcdC8vIGknbSBjaG9vc2luZyB0byBub3Qgc3VwcG9ydCBhcmVhIGFuZCBpZnJhbWUsIGRvbnQgQCBtZVxuXHRcdGNvbnN0IG5hdGl2ZWx5Rm9jdXNhYmxlVGFncyA9IFsnYScsICdidXR0b24nLCAnaW5wdXQnLCAnc2VsZWN0JywgJ3RleHRhcmVhJ107XG5cdFx0Y29uc3QgaXNOYXRldmVseUZvY3VzYWJsZVRhZyA9IG5hdGl2ZWx5Rm9jdXNhYmxlVGFncy5pbmNsdWRlcyh0YWcpO1xuXG5cdFx0Y29uc3QgaGFzQVRhYkluZGV4ID0gdGhpcy5fZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmdldEF0dHJpYnV0ZSgndGFiaW5kZXgnKSAhPT0gbnVsbDtcblxuXHRcdHJldHVybiAhaXNOYXRldmVseUZvY3VzYWJsZVRhZyAmJiAhaGFzQVRhYkluZGV4O1xuXHR9XG5cblx0cHJpdmF0ZSBfc2V0VGFiaW5kZXgoaTogbnVtYmVyID0gbnVsbCk6IHZvaWQge1xuXHRcdHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgYCR7aX1gKTtcblx0fVxufVxuIl19